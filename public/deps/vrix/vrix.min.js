!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vrix=t()}(this,function(){"use strict";function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(n,!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n){return(d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&s(o,n.prototype),o}).apply(null,arguments)}function t(e){var i="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,n)}function n(){return d(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?f(e):t}function p(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=p(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function m(e,t,n,i){return(m="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var o,s=p(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(i,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(i,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(i,t,o)}else r(i,t,n);return!0})(e,t,n,i)}function n(e,t,n,i,o){if(!m(e,t,n,i||e)&&o)throw new Error("failed to set property");return n}var y={collection:{},formatter:{number:{nullTo:"",nanTo:"",thousandsSeparator:",",roundFunction:Math.round,fractionDigits:void 0,trailingZeros:!1,abbreviations:void 0,positiveSign:null,negativeSign:"-"}},net:{url:{pathVars:{varOpen:"{",varClose:"}"}},http:{baseUrl:"",method:"GET",responseType:"json",useHiddenMethod:!0,hiddenMethodParamName:"_method",contentTypeResolver:function(e){if(null!=e&&!(e instanceof FormData)&&"object"===_(e))return"application/json"},bodyTransformer:function(e,t){return"object"===_(e)&&null!=t&&0<=t.toLowerCase().indexOf("json")?JSON.stringify(e):e}},WebSocket:{reconnectInterval:1500,reconnectAttempt:-1}}},k=/[\\^$.*+?()[\]{}|]/g,b=RegExp(k.source);function I(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return b.test(e)?e.replace(k,"\\$&"):e}function C(e,t){if(null==e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){var n=String(e),i=n.lastIndexOf("/");return new RegExp(n.slice(1,i),n.slice(i+1))}if(Array.isArray(e)){for(var o=e.length,s=new Array(o),r=o-1;0<=r;r--)s[r]=t?C(e[r],t):e[r];return s}if("object"!==_(e))return e;var l={};for(var a in e)l[a]=t?C(e[a],t):e[a];return l}function E(){var e=arguments.length,t=arguments.length<=0?void 0:arguments[0];if(e<2)return t;var n=e,i=e-1<0||arguments.length<=e-1?void 0:arguments[e-1];i&&Object.keys(i).length<=3&&("overwrite"in i||"copy"in i||"deep"in i)?n=e-1:i={overwrite:!0,copy:!1,deep:!1};for(var o=!!i.overwrite,s=!!i.copy,r=!!i.deep,l=1;l<n;++l){var a=l<0||arguments.length<=l?void 0:arguments[l];if("object"!==_(a)||Array.isArray(a))console.warn("`source` is not an object.",a);else for(var c in a){var u=t[c];if(void 0===u||o){var h=s?C(a[c],!0):a[c];r&&"object"===_(u)&&"object"===_(h)?E(u,h,i):t[c]=h}}}return t}function e(e){for(var n=e.prototype,t=arguments.length,i=new Array(1<t?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return i.forEach(function(t){Object.getOwnPropertyNames(t).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}),e}function S(n){var i={};return function(e){var t=i[e];return t||(t=n(e)),t}}var w=S(function(e){return e&&(-1!==e.indexOf(".")&&e.split(".")||[e])});function x(e){if(Array.isArray(e));else{var t=_(e);switch(t){case"number":e+="";case"string":e=w(e);break;default:throw new TypeError("path must be a Number/String/Array, received ".concat(t," instead."))}}return e}function O(e,t){for(var n=(t=x(t))&&t.length||0,i=e,o=0;o<n;o++){var s=t[o];if(!(s in i))return null;i=i[s]}return i}function T(e,t,n){for(var i=(t=x(t))&&t.length||0,o=e,s=0;s<i-1;s++){var r=t[s];if(!(r in o)){o=null;break}o=o[r]}return!!(o&&0<i&&o[t[s]]!==n)&&(o[t[s]]=n,!0)}var L=Object.freeze({escapeRegExp:I,copy:C,clone:function(e){return C(e,!0)},compareArray:function(e,t){var n=e&&e.length||0;if(n!==(t&&t.length||0))return!1;for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0},mixin:E,withBehavior:e,cacheFunction:S,debounceFunction:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,o=null;return function(){o&&clearTimeout(o);var e=arguments;o=setTimeout(function(){t.apply(n,e)},i)}},throttleFunction:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,i=!0;return function(){i&&(i=!1,e.apply(t,arguments),setTimeout(function(){i=!0},n))}},parsePath:x,getValue:O,setValue:T}),M=("undefined"==typeof global?"undefined":_(global))===_(null)?global:self,P=[].findIndex||function(e,t){for(var n=this.length;n--;)if(e.call(t,this[n]))return n;return n},z=Object.defineProperty,N="__event-target__"+Math.random(),A=M.WeakMap||function(){return{get:function(e){return e[N]},set:function(e,t){z(e,N,{configurable:!0,value:t})}}},F=M.EventTarget;try{new F}catch(e){F=function(){var n=new A,s=function(e){return n.get(e)||t(e)},t=function(e){var t=new a;return n.set(e,t),t},i=function(e,t){for(var n in t)z(e,n,{configurable:!0,value:t[n]})};function e(){}function o(e){var t=e.options;t&&t.once&&l.call(e.target,this.type,e.listener,e.options),"function"==typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this)}function r(e){return this===e.listener}function l(e,t,n){var i=s(this)[e];if(i){var o=P.call(i,r,t);-1<o&&i.splice(o,1)}}function a(){}return i(e.prototype,{addEventListener:function(e,t,n){var i=s(this),o=i[e]||(i[e]=[]);P.call(o,r,t)<0&&o.push({target:this,listener:t,options:n})},dispatchEvent:function(e){var t=s(this)[e.type];t&&(i(e,{currentTarget:this,target:this}),t.forEach(o,e),delete e.currentTarget,delete e.target);return!0},removeEventListener:l}),a.prototype=Object.create(null),e}()}var H,R,V,D,W,j,B,U,G,q=F,K=function(){function r(e){return e}function l(e){return"string"==typeof e?e.toLowerCase():e}function s(e,t){var n="function"==typeof this&&!this.firstBy&&this,i=function(n,e){if(e="number"==typeof e?{direction:e}:e||{},"function"!=typeof n){var t=n;n=function(e){return e[t]?e[t]:""}}if(1===n.length){var i=n,o=e.ignoreCase?l:r,s=e.cmp||function(e,t){return e<t?-1:t<e?1:0};n=function(e,t){return s(o(i(e)),o(i(t)))}}return-1===e.direction?function(e,t){return-n(e,t)}:n}(e,t),o=n?function(e,t){return n(e,t)||i(e,t)}:i;return o.thenBy=s,o}return s.firstBy=s}(),X=(H=Object,R=H.getPrototypeOf||function(e){return e.__proto__},V=H.setPrototypeOf||function(e,t){return e.__proto__=t,e},D="object"===("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect.construct:function(e,t,n){var i,o=[null];return o.push.apply(o,t),i=e.bind.apply(e,o),V(new i,n.prototype)},function(e){var t=R(e);return V(e,V(function(){return D(t,arguments,R(this).constructor)},t))}),Z=function(){function e(){l(this,e),this.count=0,2<=arguments.length?(this.startCallback=arguments[0],this.endCallback=arguments[1]):1===arguments.length&&(this.endCallback=arguments[0])}return a(e,[{key:"start",value:function(){var e=null;return this.count<=0&&this.startCallback&&(e=this.startCallback.apply(null,arguments)),this.count++,e}},{key:"end",value:function(){var e=null;return this.count--,this.count<=0&&this.endCallback&&(e=this.endCallback.apply(null,arguments),this.count=0),e}},{key:"cancel",value:function(){this.count--}},{key:"counting",get:function(){return 0<this.count}}]),e}(),Y=(W=["push","pop","shift","unshift","splice","sort","reverse"],function(e,r){W.forEach(function(o){var s=e[o];e[o]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=s.apply(this,t);return r(o,t,i),i},e[o].__original=s})}),$=X(function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this)))._source=null,t._active=null,t._sortFunction=null,t._filterFunction=null,t._eventCounter=new Z(t._dispatchCollectionEvent.bind(f(t))),t}return c(n,q),a(n,[{key:"eventStart",value:function(){this._eventCounter.start()}},{key:"eventEnd",value:function(){this._eventCounter.end()}},{key:"get",value:function(e){return 0<=e&&e<this.length?this.localItems[e]:null}},{key:"indexOf",value:function(e,t){return this.localItems.indexOf(e,t)}},{key:"lastIndexOf",value:function(e,t){return this.localItems.lastIndexOf(e,t)}},{key:"contains",value:function(e){for(var t,n=Array.isArray(e)?e.slice(0):[e],i=n.length;t<i;t++)if(this.indexOf(n[t])<0)return!1;return!0}},{key:"setValue",value:function(e,t,n){return this._internalSetValue(this.get(e),t,n)}},{key:"setItemValue",value:function(e,t,n){return this._internalSetValue(e,t,n)}},{key:"sort",value:function(e){var t=e&&e.length||0;if(0<t){for(var n=e[0],i=K(n.sortFunction,n.descending?0:-1),o=1;o<t;o++)n=e[o],i=i.thenBy(n.sortFunction,n.descending?0:-1);this._sortFunction=i}else this._sortFunction=null}},{key:"refresh",value:function(){this._eventCounter.start(),this._internalRefresh(),this._eventCounter.end("refresh")}},{key:"clear",value:function(){this.source=[]}},{key:"toArray",value:function(){return this.localItems&&this.localItems.slice(0)||[]}},{key:"subList",value:function(e,t){var n=this.localItems.slice(e,t);return new this.constructor(n)}},{key:"_reset",value:function(){this._eventCounter.start(),this._internalRefresh(),this._eventCounter.end("reset")}},{key:"_internalSetValue",value:function(e,t,n){if(e&&null!=t){var i=O(e,t);if(n!==i)return this._eventCounter.start(),T(e,t,n),this._eventCounter.end("update",{source:e,index:this.indexOf(e),property:t,newValue:n,oldValue:i}),!0}return!1}},{key:"_internalRefresh",value:function(){}},{key:"_dispatchCollectionEvent",value:function(e,t,n,i){var o=t&&!Array.isArray(t)&&[t]||t,s={collection:this,kind:e,index:n};o&&(s.items=o),null!=i&&(s.oldIndex=i),this.dispatchEvent(new CustomEvent("collection-change",{bubbles:!1,cancelable:!1,detail:s}))}},{key:"source",get:function(){return this._source},set:function(o){var s=this;if(this._source!==o&&(this._source=o,this._reset(),Array.isArray(o)&&!Object.isFrozen(o))){var r=this._dispatchCollectionEvent.bind(this);Y(o,function(e,t,n){if(!s._eventCounter.counting)switch(e){case"push":r("add",t,o.length-t.length);break;case"unshift":r("add",t,0);break;case"pop":r("remove",n,o.length);break;case"shift":r("remove",n,0);break;case"splice":0<t[1]&&r("remove",n,t[0]);var i=t.slice(2);0<i.length&&r("add",i,t[0]);break;case"sort":case"reverse":s.refresh()}})}}},{key:"length",get:function(){return this._active&&this._active.length||0}},{key:"isEmpty",get:function(){return 0===this.length}},{key:"filterFunction",get:function(){return this._filterFunction},set:function(e){this._filterFunction!==e&&(this._filterFunction=e,this.refresh())}},{key:"sortFunction",get:function(){return this._sortFunction}},{key:"localItems",get:function(){return this._active||[]}}]),n}()),J=function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this))).source=e||[],t}return c(n,$),a(n,[{key:"add",value:function(e){return this.addAt(this.length,e)}},{key:"addAt",value:function(e,t){if(0<=e){if(e>=this.length&&(e=this.length),this._eventCounter.start(),this.source!==this._active){var n=e,i=0;if(this.sortFunction?n=this.source.length:this.filterFunction&&(n=n>=this._active.length?this.source.length:this.source.indexOf(this._active[e])),this.source.splice(n,0,t),!this.filterFunction||this.filterFunction(t,e,this.source))if(this.sortFunction)i=this._findInsertIndex(this._active,t);else{for(var o=n-1;0<=o;){var s=this.source[o];if(this.filterFunction(s,o,this.source)&&0<=(i=this._active.indexOf(s))){i+=1;break}o--}i<0&&(i=0)}else i=-1;0<=i&&this._active.splice(i,0,t),e=i}else this._active.splice(e,0,t);return this._eventCounter.end("add",t,e),!0}return!1}},{key:"addAll",value:function(e){this.addAllAt(this.length,e)}},{key:"addAllAt",value:function(e,t){var n=t&&t.length||0;if(0<n&&0<=e){this._eventCounter.start();for(var i=0;i<n;i++)this.addAt(e+i,t[i]);this._eventCounter.end("add",t,e)}}},{key:"remove",value:function(e){return this.removeAt(this.indexOf(e))===e}},{key:"removeAll",value:function(e){this._eventCounter.start(),e=e&&e.slice(0)||[];var t=[];e.forEach(function(e){this.remove(e)&&t.push(e)}.bind(this)),0<t.length?this._eventCounter.end("remove",t,-1):this._eventCounter.cancel()}},{key:"removeAt",value:function(e){var t;return 0<=e&&e<this.length&&(this._eventCounter.start(),t=this._active.splice(e,1)[0],this.source!==this._active&&this.source.splice(this.source.indexOf(t),1),this._eventCounter.end("remove",t,e)),t}},{key:"set",value:function(e,t){return 0<=e&&e<this.length&&(this._eventCounter.start(),this.removeAt(e),this.addAt(e,t),this._eventCounter.end("set",t,e),!0)}},{key:"move",value:function(e,t){if(e!==t&&0<=e&&e<this.length&&0<=t){this._eventCounter.start();var n=this.removeAt(e);return this.addAt(t,n),this._eventCounter.end("move",n,this.indexOf(n),e),!0}return!1}},{key:"_internalRefresh",value:function(){if(0<(this.source&&this.source.length||0)&&(this.sortFunction||this.filterFunction)){var e=this.source&&this.source.slice(0)||0;this.filterFunction&&(e=e.filter(this.filterFunction)),this.sortFunction&&(e=e.sort(this.sortFunction)),this._active=e}else this._active=this.source}},{key:"_findInsertIndex",value:function(e,t){for(var n=0,i=0,o=e.length-1,s=null,r=1;i<=o;)if(s=e[n=Math.round((i+o)/2)],(r=this.sortFunction&&this.sortFunction(t,s))<=-1)o=n-1;else{if(!(1<=r))break;i=n+1}return 0<r?n+1:n}}]),n}(),Q=(j=Object,B=j.getPrototypeOf||function(e){return e.__proto__},U=j.setPrototypeOf||function(e,t){return e.__proto__=t,e},G="object"===("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect.construct:function(e,t,n){var i,o=[null];return o.push.apply(o,t),i=e.bind.apply(e,o),U(new i,n.prototype)},function(e){var t=B(e);return U(e,U(function(){return G(t,arguments,B(this).constructor)},t))})(function(e){function t(){var e;return l(this,t),(e=g(this,u(t).call(this))).useIndexProperty=!0,e._items=[],e._collectionFactory=function(){return new J},e._minSelection=0,e._maxSelection=1,e._selectionValidator=null,e._selectedIndex=-1,e._selectedIndices=[],e._selectedItem=null,e._selectedItems=[],e._precedents={},e._isItemsChanging=!1,e._isSelectionsChanged=!1,e}return c(t,q),a(t,[{key:"items",get:function(){return this._items},set:function(e){if(null==e&&(e=[]),this._items!==e&&this._items.length+e.length!==0){if(Array.isArray(e)||(console.warn("`items` must be an array."),e=[e]),this._isItemsChanging=!0,this._items=e,this._collection=this.collectionFactory(),this._collection.source=e,this.dispatchEvent(new CustomEvent("items-change",{detail:{itemsFrom:this._items,itemsTo:e}})),!this._isSelectionsChanged||this.selectedItems.length<=0){var t=[],n=this.minSelection;if(0<n)for(var i=e.length,o=0;o<n&&o<i;++o)t.push(e[o]);this.selectedItems=t}this._isItemsChanging=!1,this._isSelectionsChanged=!1}}},{key:"collection",get:function(){return this._collection}},{key:"collectionFactory",get:function(){return this._collectionFactory},set:function(e){if("function"!=typeof e)throw new TypeError("`collectionFactory` must be a function.");this._collectionFactory!==e&&(this._collectionFactory=e)}},{key:"minSelection",get:function(){return this._minSelection},set:function(e){if(null==e&&(e=0),e=Number(e),isNaN(e)&&(e=0),0<e&&0<this.maxSelection&&e>this.maxSelection)console.warn("`minSelection` should be less than or equals to `maxSelection`.");else if(this._minSelection!==e){this._minSelection=e;var t=this.selectedItems||[],n=(t=t.concat()).length;if(n<e){for(var i,o=this.collection,s=o&&o.length||0,r=n,l=0;r<e&&l<s;++l)i=o.get(l),t.indexOf(i)<0&&(t.push(i),++r);r!==n&&(this.selectedItems=t)}}}},{key:"maxSelection",get:function(){return this._maxSelection},set:function(e){if(null==e&&(e=0),e=Number(e),isNaN(e)&&(e=0),0<e&&0<this.minSelection&&e<this.minSelection)console.warn("`maxSelection` should be greater than or equals to `minSelection`.");else if(this._maxSelection!==e){this._maxSelection=e;var t=this.selectedItems||[],n=(t=t.concat()).length;0<e&&e<n&&(t.splice(0,n-e),this.selectedItems=t)}}},{key:"selectionValidator",get:function(){return this._selectionValidator},set:function(e){null!=e&&"function"!=typeof e&&(e=null),this._selectionValidator!==e&&(this._selectionValidator=e)}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){this.useIndexProperty?(null==e&&(e=-1),e=Number(e),(isNaN(e)||e<-1)&&(e=-1),e<0&&0<this.minSelection||(e>=this.collection.length?console.warn("Could not select index "+e+" cause not enough elements."):this._selectedIndex!==e&&(this._precedents={selectedIndex:e,selectedIndices:0<=e?[e]:[]},this.selectedItems=0<=e?[this.collection.get(e)]:[]))):console.warn("selectedIndex are not used.")}},{key:"selectedIndices",get:function(){return null!==this._selectedIndices?this._selectedIndices.concat():[]},set:function(e){if(this.useIndexProperty)if(null==e&&(e=[]),Array.isArray(e)){var t=e.length;if(this.selectedIndices.length||t){for(var n,i=[],o=this.collection.length,s=0;s<t;++s){if(null==e[s])return void console.warn("Element of `selectedIndices` must be a number.");if(n=Number(e[s]),isNaN(n))return void console.warn("Element of `selectedIndices` must be a number.");if(n<0)return void console.warn("Element of `selectedIndices` should be greater than or equals to zero.");if(o<=n)return void console.warn("Element of `selectedIndices` should be less than length of `list`.");i.push(this._collection.get(n))}this._precedents={selectedIndex:e[e.length-1],selectedIndices:e},this.selectedItems=i}}else console.warn("`selectedIndices` must be an array.");else console.warn("selectedIndices are not used.")}},{key:"selectedItem",get:function(){return this._selectedItem},set:function(e){null!=e&&this.collection.indexOf(e)<0&&(e=null),null==e&&0<this.minSelection||this._selectedItem!==e&&(this._precedents={selectedItem:e},this.selectedItems=null==e?[]:[e])}},{key:"selectedItems",get:function(){return null!=this._selectedItems?this._selectedItems.concat():[]},set:function(e){if(null==e&&(e=[]),Array.isArray(e)){if(this.collection){this._isItemsChanging&&(this._isSelectionsChanged=!0);var t={selectedIndex:this.selectedIndex,selectedIndices:this.selectedIndices,selectedItem:this.selectedItem,selectedItems:this.selectedItems},n=e.length,i=this.collection,o=i.length;if(n||t.selectedItems.length)if(0<this.minSelection&&n<this.minSelection&&n<o)this._precedents={};else if(0<this.maxSelection&&n>this.maxSelection)this._precedents={};else{if(0<n&&this.selectionValidator){for(var s=n-1;0<=s;s--)this.selectionValidator(e[s],this)||e.splice(s,1);n=e.length}var r=this._precedents=this._precedents||{};if(null==r.selectedIndices)if(this.useIndexProperty){for(var l=[],a=0;a<n;++a)if(l[a]=i.indexOf(e[a]),l[a]<0)return console.warn("Element of `selectedItems` must be in `list`."),void(this._precedents={});r.selectedIndices=l}else if(!i.contains(e))return console.warn("Element of `selectedItems` must be in `list`."),void(this._precedents={});this.useIndexProperty&&null==r.selectedIndex&&(r.selectedIndex=n?r.selectedIndices[n-1]:-1),null==r.selectedItem&&(r.selectedItem=n?e[n-1]:null);var c=h({selectedItemFrom:t.selectedItem,selectedItemsFrom:t.selectedItems,selectedItemTo:r.selectedItem,selectedItemsTo:e},this.useIndexProperty?{selectedIndexTo:r.selectedIndex,selectedIndicesTo:r.selectedIndices,selectedIndexFrom:t.selectedIndex,selectedIndicesFrom:t.selectedIndices}:{});this._precedents={};var u=new CustomEvent("selection-changing",{cancelable:!0,detail:c});this.dispatchEvent(u),u.defaultPrevented||(this.useIndexProperty&&(this._selectedIndex=r.selectedIndex,this._selectedIndices=r.selectedIndices),this._selectedItem=r.selectedItem,this._selectedItems=e,this.dispatchEvent(new CustomEvent("selection-change",{detail:c})))}else this._precedents={}}}else console.warn("`selectedItems` must be an array.")}}]),t}()),ee={get selector(){return this._selector||(this._selector=new Q),this._selector},get items(){return this._selector.items},set items(e){this._selector.items=e},get collection(){return this._selector.collection},get minSelection(){return this._selector.minSelection},set minSelection(e){this._selector.minSelection=e},get maxSelection(){return this._selector.maxSelection},set maxSelection(e){this._selector.maxSelection=e},get selectionValidator(){return this._selector.selectionValidator},set selectionValidator(e){this._selector.selectionValidator=e},get selectedIndex(){return this._selector.selectedIndex},set selectedIndex(e){this._selector.selectedIndex=e},get selectedIndices(){return this._selector.selectedIndices},set selectedIndices(e){this._selector.selectedIndices=e},get selectedItem(){return this._selector.selectedItem},set selectedItem(e){this._selector.selectedItem=e},get selectedItems(){return this._selector.selectedItems},set selectedItems(e){this._selector.selectedItems=e},hasSelectedItem:function(e){return!!(this.selectedItems&&0<=this.selectedItems.indexOf(e))},addSelectedItem:function(e){if(this.hasSelectedItem(e))return!1;if(1===this.maxSelection)this.selectedItem=e;else{var t=this.selectedItems&&this.selectedItems.slice(0)||[];t.push(e),2<=this.maxSelection&&t.length>this.maxSelection&&t.splice(0,t.length-this.maxSelection),this.selectedItems=t}return!0},removeSelectedItem:function(e){if(this.hasSelectedItem(e)){if(1===this.maxSelection)this.selectedItem=null;else{var t=this.selectedItems.slice(0);t.splice(t.indexOf(e),1),this.selectedItems=t}return!0}return!1},toggleSelectedItem:function(e){return this.hasSelectedItem(e)?this.removeSelectedItem(e):this.addSelectedItem(e)}},te=function(e){function s(e){var i,n,o;return l(this,s),(i=g(this,u(s).call(this,function(e,t){n=e,o=t})))._resolve=n,i._reject=o,i._progressHandlers=[],i._pendingResult=[],i._inited=!1,e(n,o,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(i._inited)try{return i._progressHandlers.forEach(function(e){return e.apply(null,t)})}catch(e){i._reject(e)}else i._pendingResult.push(t)}),i._inited=!0,i}return c(s,t(Promise)),a(s,[{key:"then",value:function(e,t){return v(u(s.prototype),"then",this).call(this,e,t),this}},{key:"catch",value:function(e){return v(u(s.prototype),"catch",this).call(this,e),this}},{key:"progress",value:function(t){if("function"!=typeof t)throw new TypeError("not a function");try{this._pendingResult.forEach(function(e){t.apply(null,e)})}catch(e){this._reject(e)}return this._progressHandlers.push(t),this}}],[{key:"all",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new s(function(n,i,o){var s=new Array(t.length),r=t.length,l=0;t.forEach(function(e,t){e.then(function(e){return s[t]=e,o(++l,r),l===r&&n(s),e}).catch(i)})})}},{key:"next",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=new ne(function(){t&&Promise.resolve().then(function(){return n.run()})});return n.next(e)}}]),s}(),ne=function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this,e))).tokens=[],t.results=[],t.running=!1,t}return c(n,te),a(n,[{key:"next",value:function(e){return this.tokens.push(e),this}},{key:"run",value:function(){var n=this;if(!(this.running||this.tokens.length<=0)){this.running=!0;var i=this.tokens.slice(0),o=[],s=function(e){o.push(e),n._progressHandlers.forEach(function(e){return e.apply(null,[o.length,n.tokens.length])})};!function t(){var e=i.shift();e?e(o.slice(0)).then().then(function(e){return s(e),t(),e}).catch(function(e){return s(e),t(),e}):n._resolve(o)}()}}}]),n}();function ie(e,t,n){e.splice(t,n.length)}function oe(e,t,n,i,o){var s,r,l,a=t&&t.length||0,c=[];for(l=0;l<a;++l){if(s=t[l],!i&&n(s,e,t)&&(c.push(s),o))return c;if((r=this.getChildren(s))&&0<r.length&&0<(c=c.concat(oe.call(this,s,r,n,i,o))).length&&o)return c;if(i&&n(s,e,t)&&(c.push(s),o))return c}return c}var se="noParent",re="parentToAbove",le=function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this)))._rootNode=null,t._displayableNodes=[],t._openNodesMap=new Map,t._parentMap=new Map,t._childrenMap=new Map,t._childrenField="children",t._displayPolicy=re,t.source=e||[],t}return c(n,$),a(n,[{key:"getParentNode",value:function(e){var t=this._internalGetParentNode(e);return t===this._rootNode&&(t=null),t}},{key:"getAncestorNodes",value:function(e){for(var t=[],n=this.getParentNode(e);n;)t.unshift(n),n=this.getParentNode(n);return t}},{key:"getDescendantNodes",value:function(t){return this.find(function(e){return!!e&&t!==e},t)}},{key:"_internalGetParentNode",value:function(e){var t=this._parentMap.get(e);if(!t&&this._rootNode){var n=this.getNativeChildren(this._rootNode);if(n&&0<=n.indexOf(e))return null;this._addAllParentMapping(),t=this._parentMap.get(e)}return t}},{key:"getChildren",value:function(e){null==e&&(e=this._rootNode);var t=null;return this._childrenMap.has(e)||(e==this._rootNode||this.childrenField in e)&&(t=this.getNativeChildren(e),this._addChildrenMapping(e,t)),t=this._childrenMap.get(e)}},{key:"getNativeChildren",value:function(e){return e||(e=this._rootNode),e&&this.childrenField in e?e[this.childrenField]:null}},{key:"getDisplayableChildren",value:function(e){return this._internalGetDisplayableChildren(e,!1)}},{key:"getSiblingNodes",value:function(e){var t=this.getParentNode(e);return this.getChildren(t)}},{key:"getNodeIndex",value:function(e){return(this.getSiblingNodes(e)||[]).indexOf(e)}},{key:"_internalGetDisplayableChildren",value:function(e,t){var n=[];if(this.isOpenNode(e)){var i,o,s=this.getChildren(e),r=s&&s.length||0;for(i=0;i<r;i++)o=s[i],t&&this._addParentMapping(e,o),this._displayPolicy===se?this.isOpenNode(o)&&this.hasChildren(o)||n.push(o):this._displayPolicy===re&&n.push(o),n=n.concat(this._internalGetDisplayableChildren(o,t)||[])}return n}},{key:"hasChildren",value:function(e){var t=this.getChildren(e);return t&&0<t.length||!1}},{key:"addNode",value:function(e,t){var n=this.getNativeChildren(e),i=n&&n.length||0;return this.addNodeAt(e,t,i)}},{key:"addNodeAt",value:function(e,t,n){return this.addNodesAt(e,[t],n)}},{key:"addNodes",value:function(e,t){var n=this.getNativeChildren(e),i=n&&n.length||0;return this.addNodesAt(e,t,i)}},{key:"addNodesAt",value:function(e,t,n){if(!t||t.length<=0)return!1;var i,o;e||(e=this._rootNode),n=Math.max(n,0),i=e,o=this.childrenField,!i||o in i||(i[o]=[]);var s,r,l=this.getChildren(e),a=this.getNativeChildren(e),c=a&&a.length||0,u=t.length;for(l!==a&&(r=l[n],(n=a.indexOf(r))<0&&(n=c)),n=Math.min(n,c),this._internalCloseNode(e,!0),s=0;s<u;s++)r=t[s],this._removeParentMapping(r),a.splice(n+s,0,r),this._addParentMapping(e,r);return this._removeChildrenMapping(e),this._internalOpenNode(e,!0),this._dispatchNodeEvent("node-add",!1,!1,t,e),!0}},{key:"removeNode",value:function(e,t){var n=this;e||(e=this._rootNode);var i=this.getNativeChildren(e),o=i?i.indexOf(t):-1;if(o<0)return!1;var s=this.find(function(e){return!0},t);return this._internalCloseNode(e,!0),this._removeChildrenMapping(e),s&&s.forEach(function(e){n._removeOpenNodeMapping(e),n._removeChildrenMapping(e),n._removeParentMapping(e)}),i.splice(o,1),this._internalOpenNode(e,!0),this._dispatchNodeEvent("node-remove",!1,!1,t,e),!0}},{key:"contains",value:function(t){if(Array.isArray(t)){var n=t.slice(0);return this.find(function(e){var t=n.indexOf(e);0<=t&&n.splice(t,1)}),0===n.length}return!!this.findOne(function(e){return t===e})}},{key:"isOpenNode",value:function(e){return e===this._rootNode||this._openNodesMap.has(e)}},{key:"isDisplayableNode",value:function(e){for(var t=e;t;){if(!this.isOpenNode(t))return!1;t=this.getParentNode(t)}return!0}},{key:"openNode",value:function(e){return!(null===e||this.isOpenNode(e)||!this._dispatchNodeEvent("node-opening",!1,!0,e))&&(this._addOpenNodeMapping(e),this._internalOpenNode(e,!0),this._dispatchNodeEvent("node-open",!1,!1,e),!0)}},{key:"_internalOpenNode",value:function(e,t){if(this.isDisplayableNode(e)){var n=this._internalGetDisplayableChildren(e,!0);if(n&&0<n.length){var i=this._displayableNodes,o=e===this._rootNode?i.length:i.indexOf(e);0<=o&&(s=i,r=o+=1,l=n,Array.prototype.splice.apply(s,[r,0].concat(l)),t&&this._dispatchCollectionEvent("add",n,o),this._displayPolicy===se&&e&&e!==this._rootNode&&(ie(i,o-1,[e]),this._dispatchCollectionEvent("remove",[e],o-1)))}}var s,r,l}},{key:"closeNode",value:function(e){return!(null===e||!this.isOpenNode(e)||!this._dispatchNodeEvent("node-closing",!1,!0,e))&&(this._internalCloseNode(e,!0),this._removeOpenNodeMapping(e),this._dispatchNodeEvent("node-close",!1,!1,e),!0)}},{key:"_internalCloseNode",value:function(e,t){if(this.isDisplayableNode(e)){var n=this._internalGetDisplayableChildren(e,!1);if(n&&0<n.length){var i=this._displayableNodes.indexOf(n[0]);0<=i&&(ie(this._displayableNodes,i,n),t&&this._dispatchCollectionEvent("remove",n,i))}}}},{key:"openNodes",value:function(e){var t,n,i=e&&e.length;for(this._openNodesMap.clear(),n=0;n<i;n++)t=e[n],this._addOpenNodeMapping(t);this._resetDisplayableNodes(),this._active=this._displayableNodes,this._dispatchCollectionEvent("refresh")}},{key:"getOpenedNodes",value:function(){var n=[];return this._openNodesMap.forEach(function(e,t){n.push(t)}),n}},{key:"getNodeLevel",value:function(e){if(null===e)return-1;for(var t=-1,n=this._internalGetParentNode(e);n;)n=this._internalGetParentNode(n),t++;return t}},{key:"getNodeDepth",value:function(e){return(e?[e]:this.toArray()).reduce(function(e,t){return Math.max(e,function t(e){var n=1;return e&&e.children&&e.children.forEach(function(e){n=Math.max(n,t(e)+1)}),n}(t))},1)}},{key:"find",value:function(e,t,n){if(this.source&&e){var i=t&&this.getParentNode(t)||null,o=t&&[t]||this.getNativeChildren(i);return oe.call(this,i,o,e,n,!1)}return null}},{key:"findOne",value:function(e,t,n){if(this.source&&e){var i=t&&this.getParentNode(t)||null,o=t&&[t]||this.getNativeChildren(i),s=oe.call(this,i,o,e,n,!0);if(s&&0<s.length)return s[0]}return null}},{key:"expandAll",value:function(){this.openNodes(this._getParentsInNodes(this.getNativeChildren(null)))}},{key:"collapseAll",value:function(){this.openNodes([])}},{key:"_resetDisplayableNodes",value:function(){this._displayableNodes=[],this._internalOpenNode(this._rootNode,!1)}},{key:"_internalRefresh",value:function(){var e,t,n;this._openNodesMap.clear(),this._parentMap.clear(),this._childrenMap.clear(),this._rootNode=(e=this.source,t=this.childrenField,(n=Object.create({__ROOT_NODE__:!0}))[t]=e,n),this._resetDisplayableNodes(),this._active=this._displayableNodes}},{key:"_getParentsInNodes",value:function(e){var t,n,i,o=e&&e.length||0,s=[];for(i=0;i<o;i++)t=e[i],(n=this.getChildren(t))&&0<n.length&&(s.push(t),s=s.concat(this._getParentsInNodes(n)));return s}},{key:"_addOpenNodeMapping",value:function(e){this._openNodesMap.set(e,!0)}},{key:"_removeOpenNodeMapping",value:function(e){this._openNodesMap.delete(e)}},{key:"_addAllParentMapping",value:function(){var n=this;this._lockAllParentMapping||(this._lockAllParentMapping=!0,this.find(function(e,t){t||(t=n._rootNode),n._addParentMapping(t,e)},null,!1),this._lockAllParentMapping=!1)}},{key:"_addParentMapping",value:function(e,t){this._parentMap.set(t,e),e||console.warn("HierarchyList._addParentMapping !!!",t)}},{key:"_removeParentMapping",value:function(e){this._parentMap.delete(e)}},{key:"_addChildrenMapping",value:function(e,t){this._childrenMap.set(e,t)}},{key:"_removeChildrenMapping",value:function(e){this._childrenMap.delete(e)}},{key:"_dispatchNodeEvent",value:function(e,t,n,i,o){i?Array.isArray(i)||(i=[i]):i=[];var s=0<i.length?i[0]:null;null===s||o||(o=this.getParentNode(s));var r=new CustomEvent(e,{bubbles:t,cancelable:n,detail:{collection:this,nodes:i,node:s,parent:o}});return this.dispatchEvent(r)}},{key:"displayableNodes",get:function(){return this._displayableNodes}},{key:"childrenField",get:function(){return this._childrenField},set:function(e){this._childrenField!==e&&(this._childrenField=e,this._reset())}},{key:"displayPolicy",get:function(){return this._displayPolicy},set:function(e){this._displayPolicy!==e&&(this._displayPolicy=e,this.reset())}}]),n}();function ae(e,t,n){var i=e.charAt(e.length-1);return"?"!==i&&"&"!==i&&(e+="&"),e+=t,void 0!==n&&(e=e+"="+n),e}function ce(t,e,n){if(null==t)return"";if("string"!=typeof t&&"function"!=typeof t)throw new TypeError("`url` argument must be `string` or `function` type.");for(;"function"==typeof t;)t=t();if(null==t)return"";if("string"!=typeof t)throw new TypeError("`url()` result is invalid type.");if(t.trim().length<=0)return"";if("string"!=typeof e&&"object"!==_(e)&&"function"!=typeof e)throw new TypeError("`paramsOrKey` argument is invalid type.");for(;"function"==typeof e;)e=e();if(null==e)return t;var i="string"==typeof e?encodeURIComponent(e.trim()):null,o="object"===_(e)?e:null;if(null==i&&null==o)throw new TypeError("Invalid `paramsOrKey` argument.");if(t.indexOf("?")<0&&(t+="?"),null!=i){if(i.length<=0)throw new Error("Key must not be empty.");if(void 0===n)t=ae(t,i);else if(null!=n){for(;"function"==typeof n;)n=n();if(null!=n)if(Array.isArray(n))n.forEach(function(e){if(null!=e){if(Array.isArray(e))throw new Error("Array in array is not supported. key="+i);if("object"===_(e))throw new Error("`object` type in array is not supported. key="+i);t=ae(t,i,encodeURIComponent(e))}});else{if("object"===_(n))throw new Error("`object` type is not supported. key="+i);t=ae(t,i,encodeURIComponent(n))}else console.warn("No `value()` result.")}}else for(var s in o){var r=o[s];if(null!=r){if(!Array.isArray(r)&&"object"===_(r))throw new TypeError("`object` type is not supported. key="+i);t=ce(t,s,r)}}return"?"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t}var ue={};document&&document.cookie&&decodeURIComponent(document.cookie).split(";").forEach(function(e){var t=(e=e.trim()).indexOf("=");if(t<0)ue[e]=!0;else{var n=e.substring(0,t).trim();0<n.length&&(ue[n]=e.substring(t+1).trim())}});"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var he,de=(function(e,t){e.exports=function(){var e=arguments.length;if(0===e)throw new Error("resolveUrl requires at least one argument; got none.");var t=document.createElement("base");if(t.href=arguments[0],1===e)return t.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(t,n.firstChild);for(var i,o=document.createElement("a"),s=1;s<e;s++)o.href=arguments[s],i=o.href,t.href=i;return n.removeChild(t),i}}(he={exports:{}},he.exports),he.exports);function fe(r,e,l,a,t){if(t=E({},vrix.defaults.net.http,t||{}),null==r&&(r="/"),2===arguments.length&&Object.keys(arguments[1]).find(function(e){return"params"===e||"method"===e||"body"===e||"responseType"===e})){var n=arguments[1];e=n.params||{},"method"in n&&(l=n.method),"body"in n&&(a=n.body),"responseType"in n&&(t.responseType=n.responseType)}t.baseUrl&&(r=de(t.baseUrl,r)),null!=t.pathVars&&(r=function(e,t,n,i){if(null==e||e.trim().length<=0)return"";if("string"!=typeof e&&"function"!=typeof e)throw new TypeError("`uri` argument must be `string` or `function` type.");for(;"function"==typeof e;)e=e();if(null==e||"string"!=typeof e)throw new TypeError("Invalid `uri`.");if("object"!==_(t)&&"function"!=typeof t)throw new TypeError("`pathVars` argument must be `object` or `function` type.");for(;"function"==typeof t;)t=t();if(null==t)return e;if("object"!==_(t))throw new TypeError("Invalid `pathVars`.");if(null==n&&(n=vrix.defaults.net.url.pathVars.varOpen),"string"!=typeof n)throw new TypeError("`varOpen` argument must be `string` type.");if(n.trim().length<=0)throw new TypeError("`varOpen` argument must be not empty.");if(null==i&&(i=vrix.defaults.net.url.pathVars.varClose),"string"!=typeof i)throw new TypeError("`varClose` argument must be `string` type.");if(i.trim().length<=0)throw new TypeError("`varClose` argument must be not empty.");for(var o,s,r,l,a=n.length,c=i.length,u=0;0<=(o=e.indexOf(n,u));){if((s=e.indexOf(i,u))<0)throw new Error("Could not found varClose(`"+i+"`).");if(s<o)throw new Error("Could not found varOpen(`"+n+"`).");if(0<=(r=e.indexOf(n,o+a))&&r<s)throw new Error("Duplicated varOpen. location=..."+e.substring(o,s)+"...");if(null==(l=t[e.substring(o+a,s)]))throw new Error("Could not found path-variable-value in pathVars. key="+e.substring(o+a,s));l=encodeURIComponent(l),e=e.substring(0,o)+l+e.substring(s+c),u=o+l.length}return e}(r,t.pathVars,t.varOpen,t.varClose)),l=l||t.method,t.useHiddenMethod&&"GET"!==l.toUpperCase()&&"POST"!==l.toUpperCase()&&((e=e||{})[t.hiddenMethodParamName]=l,l="POST"),null!=e&&(r=ce(r,e));var i,c=t.headers||{};for(var o in c)if("content-type"===o.toLowerCase()){i=c[o];break}var s=t.contentTypeResolver;if(null==i&&null!=s){if("function"!=typeof s)throw new TypeError("`contentTypeResolver` is not a `function`.");if(null!=(i=s(a))){if("string"!=typeof i)throw new TypeError("`contentTypeResolver()` result is not `string` type.");c["Content-Type"]=i}}var u=t.bodyTransformer;if(null!=u){if("function"!=typeof u)throw new TypeError("`bodyTransformer` is not a `function`.");a=u(a,i)}var h=t.responseType,d=t.user;if(null!=d&&"string"!=typeof d)throw new TypeError("`options.user` is not a `string`.");var f=t.password;if(null!=f&&"string"!=typeof f)throw new TypeError("`options.password` is not a `string`.");var g=new XMLHttpRequest,p={},v=new te(function(i,o,t){var s=!1;p.upload=new te(function(e,t,n){g.upload?(g.upload.onprogress=function(e){n(e.loaded,e.total)},g.upload.onload=e,g.upload.onerror=g.upload.ontimeout=g.upload.onabort=t):t(new TypeError("Could not found `XMLHttpRequest#upload`."))}),p.upload.catch(function(e){console.warn("Error in uploading...",e)}),p.abort=function(){s&&g.abort()},g.onprogress=function(e){t(e.loaded,e.total)},g.onload=function(t){s=!1;var e=g.status;if(200<=e&&e<300)try{var n=g.response;null!=n&&(n="json"===h&&"string"==typeof n&&0<n.length?JSON.parse(n):n),i(n)}catch(e){o({event:t,xhr:g,error:e})}else o({event:t,xhr:g})},g.onerror=g.ontimeout=g.onabort=function(e){s=!1,o({event:e,xhr:g})},null!=d&&0<d.length?null!=f&&0<f.length?g.open(l,r,!0,d,f):g.open(l,r,!0,d):g.open(l,r,!0),g.responseType=h;var e=function(e){if(void 0===e)return ue;if("function"==typeof e&&(e=e()),null==e)return null;if("string"!=typeof e)throw new TypeError("`key` is not `string` type.");return ue[e.trim()]}("XSRF-TOKEN");if(e&&e.length&&g.setRequestHeader("X-XSRF-TOKEN",e),c)for(var n in c)null!=c[n]&&g.setRequestHeader(n,c[n]);s=!0,g.send(a)});return v.upload=p.upload,v.xhr=g,v.abort=p.abort,v}function ge(e){var t,n;return e=(e||"").replace(/(\t|\n$)/g,""),"undefined"==typeof HTMLTemplateElement?((n=document.createElement("div")).innerHTML=e,(t=document.createDocumentFragment()).appendChild(n.firstChild)):((n=document.createElement("template")).innerHTML=e,t=n.content),t}function pe(e){if(e instanceof HTMLElement)return e.cloneNode();if(e instanceof Function){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(null,n)}if("string"==typeof e){var o=ge(e);if(o)return document.importNode(o,!0).querySelector("*")}return null}function ve(e,t,n,i){if(e.__x!==t||e.__y!==n||i){var o=e.style;return o.left=t+"px",o.top=n+"px",e.__x=t,e.__y=n,!0}return!1}function _e(e,t){return e.__width!==t&&(e.__width=t,e.style.width=isNaN(t)?t:t+"px",!0)}function me(e,t){return e.__height!==t&&(e.__height=t,e.style.height=isNaN(t)?t:t+"px",!0)}function ye(e,t,n){var i=_e(e,t),o=me(e,n);return i||o}var ke={setPosition:ve,setTranslate:function(e,t,n,i){if(e.__x!==t||e.__y!==n||i){var o=e.style;e.style.transform=o.webkitTransform="translate("+t+"px,"+n+"px)",e.__x=t,e.__y=n}},setWidth:_e,setHeight:me,setMaxHeight:function(e,t){return e.__maxHeight!==t&&(e.__maxHeight=t,e.style.maxHeight=isNaN(t)?t:t+"px",!0)},setSize:ye,addClass:function(e,t){var n=e.classList;return!(!n||n.contains(t)||(n.add(t),0))},removeClass:function(e,t){var n=e.classList;return!(!n||!n.contains(t)||(n.remove(t),0))}},be=128;function Ie(e){return e>>7}function Ce(e){return 127&e}var Ee=function(){function t(e){l(this,t),this._index=e,this._items=new Array(be),this._total=0,this._empty=be}return a(t,[{key:"getTotal",value:function(){return this._total}},{key:"getItem",value:function(e){return this._items[e]}},{key:"addSize",value:function(e,t){var n=this.getSize(127);this._items.splice(e,0,null),null!=t&&this.setSize(e,t),this._total-=n||0,this._items.length=be}},{key:"removeSize",value:function(e){var t=this.getSize(e);return this._items.splice(e,1),null!=t&&(this._total-=t||0,this._empty=Math.min(be,this._empty+1)),t}},{key:"getSize",value:function(e){var t=this._items[e];if(t)return t.value}},{key:"setSize",value:function(e,t){var n=this.getItem(e);if(n||(n={},this._items[e]=n,this._empty--),n.value===t)return!1;var i=n.value||0;return n.value=t,this._total+=t-i,!0}},{key:"empty",get:function(){return this._empty}}]),t}(),Se=function(){function e(){l(this,e),this._length=0,this._maxIndex=-1}return a(e,[{key:"clear",value:function(){}},{key:"length",get:function(){return Math.max(0<this._length?this._length:this._maxIndex+1,0)},set:function(e){this._length!==e&&(this._length=e,this._length<=this._maxIndex&&(this._maxIndex=this._length-1))}},{key:"maxIndex",get:function(){return this._maxIndex}}]),e}(),we=function(e){function t(){var e;return l(this,t),(e=g(this,u(t).call(this)))._defaultSize=30,e._blocks=[],e._gap=0,e}return c(t,Se),a(t,[{key:"clear",value:function(){this._blocks=[],this._maxIndex=-1}},{key:"setSize",value:function(e,t){this._maxIndex=Math.max(e,this._maxIndex);var n=Ie(e),i=Ce(e);return this._getBlock(n).setSize(i,t)}},{key:"getSize",value:function(e){return this._getItemValue(this._getItem(e))}},{key:"indexOf",value:function(e){for(var t,n=0,i=0,o=Ie(n),s=Ce(n),r=this._getBlock(o),l=0,a=0;i<e&&(t=r.getItem(s),!(e<i+(a=this._getItemValue(t)+this.gap)));){if(i+=a,be<=++s){for(s=0,o+=1,l=this._getBlockTotalAt(o);l+i<e;)i+=l,n+=be,o+=1,l=this._getBlockTotalAt(o);r=this._getBlock(o)}n++}return n}},{key:"getPartSize",value:function(e,t){for(var n,i=0,o=e;o<=t;){for(;0===Ce(o)&&o+be<t;)n=Ie(o),i+=this._getBlockTotalAt(n),o+=be;i+=this.getSize(o)+this.gap,o++}return i}},{key:"getTotal",value:function(){return this.getPartSize(0,this.length-1)-(0<this.length&&this.gap||0)}},{key:"addSize",value:function(e,t){for(var n,i,o=this._blocks.length,s=Ie(e),r=Ce(e),l=s;l<o;l++)i=(n=this._getBlock(l)).removeSize(127),n.addSize(r,t),t=i,r=0;null!=i&&(n=this._getBlock(o)).addSize(0,i),this.length++,this._maxIndex++}},{key:"removeSize",value:function(e){var t,n,i,o=this._blocks.length,s=Ie(e),r=Ce(e),l=null;for((n=this._getBlock(s)).removeSize(r),t=o-1;s<=t;t--)i=(n=this._getBlock(t)).removeSize(0),null!=l&&n.setSize(127,l),l=i;this.length--,this._maxIndex--}},{key:"_getBlock",value:function(e){var t=this._blocks[e];return t||(t=this._blocks[e]=new Ee(e)),t}},{key:"_getItem",value:function(e){var t=Ie(e),n=Ce(e);return 0<=t&&t<this._blocks.length?this._getBlock(t).getItem(n):null}},{key:"_getBlockTotal",value:function(e){return e.getTotal()+e.empty*this.defaultSize+this.gap*be}},{key:"_getBlockTotalAt",value:function(e){return this._getBlockTotal(this._getBlock(e))}},{key:"_getItemValue",value:function(e){return e&&e.value||this.defaultSize}},{key:"gap",get:function(){return this._gap},set:function(e){this._gap=e}},{key:"defaultSize",get:function(){return this._defaultSize},set:function(e){this._defaultSize=e}}]),t}(),xe=function(){function t(e){l(this,t),this._listInstance=e,this._linearVector=new we}return a(t,[{key:"clear",value:function(){this._linearVector.clear()}},{key:"setItemSize",value:function(e,t){return this._linearVector.setSize(e,t)}},{key:"getItemSize",value:function(e){return this._linearVector.getSize(e)}},{key:"getItemStart",value:function(e){return this._linearVector.getPartSize(0,e-1)}},{key:"getPartSize",value:function(e,t){return this._linearVector.getPartSize(e,t)}},{key:"getTotalSize",value:function(){return this._linearVector.getTotal()}},{key:"getItemIndexOf",value:function(e){return this._linearVector.indexOf(e)}},{key:"beginUpdate",value:function(){this._oldElements=this._listInstance.getVisibleElements(),this.updateLinearVector()}},{key:"doUpdate",value:function(e,t,n,i,o,s){}},{key:"endUpdate",value:function(){this.updateLinearVector(),this.updateListSize()}},{key:"updateLinearVector",value:function(){}},{key:"updateListSize",value:function(){}},{key:"positionToItemIndex",value:function(e,t){return-1}},{key:"itemIndexToRowIndex",value:function(e){return e}},{key:"itemsAdded",value:function(e,t){}},{key:"itemsRemoved",value:function(e,t){}},{key:"gap",get:function(){return this._linearVector._gap},set:function(e){this._linearVector._gap=e}}]),t}(),Oe=function(e){function t(e){return l(this,t),g(this,u(t).call(this,e))}return c(t,xe),a(t,[{key:"doUpdate",value:function(e,t,n,i,o,s){for(var r=this._listInstance,l=r.autoSize,a=r.collection,c=r.rowHeight,u=r.numItems-1,h=this.getItemIndexOf(t),d=this.getItemStart(h),f=this.gap,g=h,p=d,v=this.calculateViewportHeight();g<=u&&p<t+v;){var _=a.get(g),m=r.createItemElement(g),y=this.getItemSize(g);m&&(r.updateItemElement(m,_,g),l&&(y=Math.max(c,r.calculateElementHeight(m,_,g))),r.setLayoutElement(m,0,p,void 0,y),r.pushVisibleElements(m,_,g)),this.setItemSize(g,y),p+=y+f,g++,0===i&&(v=this.calculateViewportHeight())}}},{key:"updateLinearVector",value:function(){var e=this._listInstance,t=this._linearVector;t.defaultSize=e.rowHeight,t.gap=e.verticalGap,t.length=e.numItems}},{key:"updateListSize",value:function(){var e=this._listInstance,t=e.contentLayer,n=this.calculateContentWidth();ke.setSize(t,"auto",this.calculateContentHeight()),n!==this.calculateContentWidth()||ke.setSize(t,"auto",this.calculateContentHeight()),0<e.rowCount&&ke.setHeight(e.scrollTarget,this.calculateViewportHeight())}},{key:"calculateViewportWidth",value:function(){return this._listInstance.getViewportRect().width}},{key:"calculateViewportHeight",value:function(){var e=this._listInstance,t=e.getViewportRect(),n=e.getContentRect(),i=0;if(t&&n)if(0<e.rowCount)i=this.getPartSize(0,e.normalizedRowCount-1);else if(t.height<=0)i=this.calculateContentHeight()-e.verticalScrollPosition;else{var o=n.top-t.top;i=Math.max(0,Math.min(t.height-o,t.height,this.calculateContentHeight()-e.verticalScrollPosition))}return i}},{key:"calculateContentWidth",value:function(){return this.calculateViewportWidth()}},{key:"calculateContentHeight",value:function(){return this.getTotalSize()}},{key:"positionToItemIndex",value:function(e,t){return this.getItemIndexOf(t)}},{key:"itemsAdded",value:function(n,e){var i=this._linearVector,o=i.defaultSize;e.forEach(function(e,t){i.addSize(n+t,o)})}},{key:"itemsRemoved",value:function(n,e){var i=this._linearVector;e.forEach(function(e,t){i.removeSize(n)})}}]),t}(),Te=function(e){function t(e){return l(this,t),g(this,u(t).call(this,e))}return c(t,xe),a(t,[{key:"doUpdate",value:function(e,t,n,i,o,s){for(var r=this._listInstance,l=r.collection,a=r.autoSize,c=r.columnWidth,u=r.rowHeight,h=this.getItemIndexOf(e),d=r.numItems-1,f=this.getItemStart(h),g=this.gap,p=h,v=f,_=this.calculateViewportWidth();p<=d&&v<e+_;){var m=l.get(p),y=r.createItemElement(p),k=this.getItemSize(p);y&&(r.updateItemElement(y,m,p),a&&(k=Math.max(c,r.calculateElementWidth(y,m,p))),r.setLayoutElement(y,v,0,k,u),r.pushVisibleElements(y,m,p)),this.setItemSize(p,k),v+=k+g,p++,0===n&&(_=this.calculateViewportWidth())}}},{key:"updateLinearVector",value:function(){var e=this._listInstance,t=this._linearVector;t.defaultSize=e.columnWidth,t.gap=e.horizontalGap,t.length=e.numItems}},{key:"updateListSize",value:function(){var e=this._listInstance,t=e.contentLayer,n=this.calculateContentHeight();ke.setSize(t,this.calculateContentWidth(),n),n!==this.calculateContentHeight()||ke.setSize(t,this.calculateContentWidth(),this.calculateContentHeight()),0<e.columnCount&&ke.setHeight(e.scrollTarget,this.calculateViewportWidth())}},{key:"calculateViewportWidth",value:function(){var e=this._listInstance,t=e.getViewportRect(),n=e.getContentRect(),i=0;if(t&&n)if(0<e.columnCount)i=this.getPartSize(0,e.normalizedRowCount-1);else if(t.width<=0)i=this.calculateContentWidth()-e.horizontalScrollPosition;else{var o=n.left-t.left;i=Math.max(0,Math.min(t.width-o,t.width,this.calculateContentWidth()-e.horizontalScrollPosition))}return i}},{key:"calculateViewportHeight",value:function(){return this._listInstance.rowHeight}},{key:"calculateContentWidth",value:function(){return this.getTotalSize()}},{key:"calculateContentHeight",value:function(){return this.calculateViewportHeight()}},{key:"positionToItemIndex",value:function(e,t){return this.getItemIndexOf(e)}},{key:"itemsAdded",value:function(e,t){Oe.prototype.itemsAdded.apply(this,arguments)}},{key:"itemsRemoved",value:function(e,t){Oe.prototype.itemsRemoved.apply(this,arguments)}}]),t}(),Le=function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this,e)))._numColumns=0,t}return c(n,xe),a(n,[{key:"doUpdate",value:function(e,t,n,i,o,s){for(var r=this._listInstance,l=r.collection,a=r.autoSize,c=(r.rowCount,r.rowHeight),u=this.columnWidth,h=this.numColumns,d=r.numItems,f=r.verticalGap,g=r.horizontalGap,p=this.getItemIndexOf(t),v=Math.ceil(d/h),_=p,m=p*h,y=this.getItemStart(p),k=this.calculateViewportHeight();_<=v&&y<t+k;){for(var b=this.getItemSize(_),I=c,C=0,E=0;E<h&&m<d;E++){var S=l.get(m),w=r.createItemElement(m);w&&(r.updateItemElement(w,S,m),a?I<(b=Math.max(c,r.calculateElementHeight(w,S,m)))&&(I=b):I=b,r.setLayoutElement(w,C,y,u,b),r.pushVisibleElements(w,S,m)),C+=u+g,m++}this.setItemSize(_,I),y+=I+f,_++,0===i&&(k=this.calculateViewportHeight())}}},{key:"updateLinearVector",value:function(){var e=this._listInstance,t=this._linearVector,n=e.verticalGap,i=e.horizontalGap,o=e.columnCount,s=e.columnWidth,r=this.calculateViewportWidth();0<o&&s<=0&&(s=Math.floor((r-1-o*i)/o));var l=o;l<=0&&(l=Math.max(1,Math.floor(r/(s+i)))),this._columnWidth=s,this._numColumns!==l&&(this._numColumns=l,t.clear()),t.defaultSize!==e.rowHeight&&(t.defaultSize=e.rowHeight,t.clear()),t.defaultSize=e.rowHeight,t.gap=n,t.length=Math.ceil(e.numItems/l)}},{key:"updateListSize",value:function(){var e=this._listInstance,t=e.contentLayer;ke.setSize(t,"auto",this.calculateContentHeight()),ke.setSize(t,"auto",this.calculateContentHeight()),0<e.rowCount&&ke.setHeight(e.scrollTarget,this.calculateViewportHeight()),t.style.maxWidth=this.calculateContentWidth()+"px",ke.setTranslate(t,Math.max(0,Math.floor((e.root.offsetWidth-this.calculateContentWidth())/2)),0)}},{key:"calculateViewportWidth",value:function(){return Oe.prototype.calculateViewportWidth.apply(this,arguments)}},{key:"calculateViewportHeight",value:function(){return Oe.prototype.calculateViewportHeight.apply(this,arguments)}},{key:"calculateContentWidth",value:function(){return this.columnWidth*this.numColumns+(this.numColumns-1)*this._listInstance.horizontalGap}},{key:"calculateContentHeight",value:function(){return this.getTotalSize()}},{key:"positionToItemIndex",value:function(e,t){var n=this._listInstance,i=n.contentLayer,o=n.horizontalGap,s=this.columnWidth,r=this.numColumns;e-=i.offsetLeft;for(var l=-1,a=0,c=0,u=s;a<r;a++){if(c<=e&&e<=u){l=a;break}u=(c=u+o)+s}var h=this.getItemIndexOf(t);return 0<=l&&0<=h?h*r+l:-1}},{key:"itemIndexToRowIndex",value:function(e){return parseInt(e/this.numColumns)}},{key:"numColumns",get:function(){return this._numColumns}},{key:"columnWidth",get:function(){return this._columnWidth}}]),n}(),Me=function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this,e)))._clearRowInfos(),t}return c(n,xe),a(n,[{key:"doUpdate",value:function(e,t,n,i,o,s){var r,l,a=this._listInstance,c=a.collection,u=a.autoSize,h=a.rowHeight,d=a.numItems,f=a.verticalGap,g=a.horizontalGap,p=this._rowInfos,v=this.calculateViewportWidth(),_="normal"!==this.virtualScrollMode;if(o)l=r=0,this._clearRowInfos();else{var m=this.getItemIndexOf(t),y=p[m];if(r=m,y)l=y.start;else{for(;0<=r&&!p[r];r--);r<=0?r=l=0:(l=p[r].end+1,r+=1)}}for(var k,b,I,C,E,S,w,x,O,T,L=this.getItemStart(r),M=this.calculateViewportHeight();r<d&&l<d&&L<t+M;){for(S=E=l,I=this.getItemSize(r),C=h,k=0,T=[];l<d;l++){if(w=c.get(l),x=O||a.createItemElement(l),O=null,x){if(a.updateItemElement(x,w,l),b=a.calculateElementWidth(x,w,l),E<l&&v<k+b){O=x;break}u?C<(I=a.calculateElementHeight(x,w,l))&&(C=I):(C=I,ke.setHeight(x,I)),ke.setTranslate(x,k,L),k+=b+g}T.push(x),S=l}this.setItemSize(r,C),this._updateRowInfos(r,E,S),L+C<t&&!_?a.freeElements(T):T.forEach(function(e,t){if(e){var n=E+t,i=c.get(n);a.pushVisibleElements(e,i,n)}}),L+=C+f,r++}O&&a.freeElements([O])}},{key:"updateLinearVector",value:function(){var e=this._listInstance,t=this._linearVector;t.defaultSize=e.rowHeight,t.gap=e.verticalGap;var n,i=e.numItems,o=this._rowInfos,s=o.length;0<s?n=o[s-1].end===i-1?s:Math.ceil(i/(this._totalItems/o.length)):n=i;t.length=n}},{key:"updateListSize",value:function(){var e=this._listInstance.contentLayer;ke.setSize(e,this.calculateContentWidth(),this.calculateContentHeight()),ke.setSize(e,this.calculateContentWidth(),this.calculateContentHeight())}},{key:"calculateViewportWidth",value:function(){return Oe.prototype.calculateViewportWidth.apply(this,arguments)}},{key:"calculateViewportHeight",value:function(){return Oe.prototype.calculateViewportHeight.apply(this,arguments)}},{key:"calculateContentWidth",value:function(){return this.calculateViewportWidth()}},{key:"calculateContentHeight",value:function(){return this.getTotalSize()}},{key:"positionToItemIndex",value:function(e,t){this._listInstance.contentLayer,this.getItemIndexOf(t);return-1}},{key:"itemIndexToRowIndex",value:function(e){for(var t,n=this._rowInfos,i=n.length||0,o=0;o<i;o++)if((t=n[o])&&e<=t.end)return o;return-1}},{key:"itemsAdded",value:function(e,t){this._deleteRowInfos(e)}},{key:"itemsRemoved",value:function(e,t){this._deleteRowInfos(e)}},{key:"_deleteRowInfos",value:function(e){for(var t=this._rowInfos,n=Math.max(0,this.itemIndexToRowIndex(location));n<t.length;){var i=t.pop();this._totalItems-=i.end-i.start+1}}},{key:"_updateRowInfos",value:function(e,t,n){var i=this._rowInfos,o=i[e];o||(o=i[e]={});var s=o.end-o.start;o.start!==t&&(o.start=t),o.end!==n&&(o.end=n),isNaN(s)||(this._totalItems-=s+1),this._totalItems+=n-t+1}},{key:"_clearRowInfos",value:function(){this._rowInfos=[],this._totalItems=0,this.updateLinearVector()}}]),n}();function Pe(e){if(!e.hasOwnProperty("__dom__")){var t=ge(e.__template__()),n=function e(t){var n=[];if(t.attributes){var i,o,s=Array.prototype.slice.call(t.attributes),r=s.length;for(o=0;o<r;o++)"id"===(i=s[o]).name&&i.value&&n.push(i.value)}if(t.firstChild)for(var l=t.firstChild;l;)n=n.concat(e(l)),l=l.nextSibling;return n}(t)||[];Object.defineProperty(e,"__dom__",{value:{template:t,idList:n},writable:!1,configurable:!1,enumerable:!1})}}var ze,Ne,Ae,Fe,He,Re,Ve,De,We=function(){function e(){l(this,e),this._reasonsMask=0,this._invalidateFlag=!1,function(e){var t=e.constructor.__dom__,n=document.importNode(t.template,!0);if(n){var i=(n=n.querySelector("*")).parentNode||n.parentElement;i&&i.removeChild(n);var o={};t.idList.forEach(function(e){var t=n.querySelector('[id="'+e+'"]');t||n.getAttribute("id")!==e||(t=n),o[e]=t,o[e].removeAttribute("id")}),(n.__instance__=e).DOM=o,e.root=n}}(this)}return a(e,[{key:"addEventListener",value:function(e,t,n){this.root.addEventListener.apply(this.root,arguments)}},{key:"removeEventListener",value:function(e,t,n){this.root.removeEventListener.apply(this.root,arguments)}},{key:"dispatchEvent",value:function(e){return this.root.dispatchEvent.apply(this.root,arguments)}},{key:"doLayout",value:function(){}},{key:"validateNow",value:function(){return!!this._invalidateFlag&&(this.doLayout(),this._reasonsMask=0,!(this._invalidateFlag=!1))}},{key:"invalidate",value:function(){this._invalidateFor()}},{key:"_invalidateFor",value:function(e){var t=this;this._reasonsMask|=0|e,this._invalidateFlag||(this._invalidateFlag=!0,window.requestAnimationFrame(function(){t.validateNow()}))}},{key:"_isInvalidateReason",value:function(e){return(this._reasonsMask&e)===e}}],[{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Pe(this);var n,i=(n=e)instanceof HTMLElement?n:"string"==typeof n?document.querySelector(n):null;if(i){var o=E(new this(i,E({parent:i},t)),t);return i.appendChild(o.root),o}throw Error("Invalid container")}}]),e}(),je=(ze=Object,Ne=ze.getPrototypeOf||function(e){return e.__proto__},Ae=ze.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fe="object"===("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect.construct:function(e,t,n){var i,o=[null];return o.push.apply(o,t),i=e.bind.apply(e,o),Ae(new i,n.prototype)},function(e){var t=Ne(e);return Ae(e,Ae(function(){return Fe(t,arguments,Ne(this).constructor)},t))}),Be=je(function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this)))._target=e,t._init(),t}return c(n,q),a(n,[{key:"start",value:function(e){var t=this;isNaN(e)&&(e=250),this._intervalId||(this._intervalId=setInterval(function(){t._doCheck()&&t.dispatchEvent(new CustomEvent("size-change",{bubbles:!1,cancelable:!1,detail:{element:t._target,width:t._width,height:t._height}}))},e))}},{key:"stop",value:function(){this._intervalId&&(clearInterval(this._intervalId),this._init())}},{key:"_init",value:function(){this._intervalId=null,this._width=-1,this._height=-1}},{key:"_doCheck",value:function(){var e,t;return t=this._isVisible()?(e=this._getTargetWidth(),this._getTargetHeight()):e=0,(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,0<e&&0<t)}},{key:"_getTargetWidth",value:function(){return this._target.clientWidth}},{key:"_getTargetHeight",value:function(){return this._target.clientHeight}},{key:"_isVisible",value:function(){var e=this._target.getBoundingClientRect();return 0<e.width&&0<e.height}}]),n}()),Ue={mousedown:"item-down",mouseup:"item-up",click:"item-click",dblclick:"item-double-click"},Ge=["none","normal","lazy"],qe=2,Ke=4,Xe=8,Ze=16,Ye=32,$e=64,Je=128,Qe=256,et=512,tt=e(function(e){function o(e,t){var n;l(this,o),(n=g(this,u(o).call(this))).elementCacheCount=0,n._container=e,n._contentLayer=n.DOM.contentLayer,n._renderMode="normal",n._collection=null,n._rowHeight=30,n._autoHeight=!1,n._columnWidth=0,n._numColumns=1,n._horizontalScrollPosition=0,n._verticalScrollPosition=0,n._displayedElements=[],n._visibleElements=[],n._visibleIndices=[],n._freedElements=[],n._typicalMeta=null,n._horizontalGap=0,n._verticalGap=0,n._columnCount=0,n._rowCount=0,n._minRowCount=0,n._maxRowCount=0,n._caretIndex=-1,n._triggerEvent=null,n._boundCollectionChange=n._onCollectionChange.bind(f(n)),n._boundScrollTargetScroll=n._onScrollTargetScroll.bind(f(n));var i=n._onMouseEvent.bind(f(n));return["mousedown","mouseup","click","dblclick"].forEach(function(e){n.addEventListener(e,i)}),n.scrollTarget=e,n.layout="vertical",n.selector.collectionFactory=function(){n.collection&&n.collection.removeEventListener("collection-change",n._boundCollectionChange);var e=new J;return e.addEventListener("collection-change",n._boundCollectionChange),e},n.selector.addEventListener("selection-changing",function(e){n._redispatchEvent(e)||e.preventDefault()}),n.selector.addEventListener("selection-change",function(e){n._redispatchEvent(e),n._invalidateFor(Ze)}),n.selectOnKeys=[13,32],n.selectOnClick=!0,n.useCtrlkeyOnSelection=!1,n.dispatchEventHook=null,n.measureElementWidth=null,n.measureElementHeight=null,n.addEventListener("keydown",n._onKeydown.bind(f(n))),n}return c(o,We),a(o,null,[{key:"__template__",value:function(){return'<div class="list-container" style="position:relative;">\n            <div id="contentLayer" class="list-content" style="display:block;position:relative;overflow:hidden"></div> \n        </div>'}}]),a(o,[{key:"getVisibleIndices",value:function(){return this._visibleIndices.slice(0)}},{key:"getVisibleElements",value:function(){return this._visibleElements.slice(0)}},{key:"getElementAll",value:function(){var e=[];return"normal"!==this.renderMode?e=e.concat(this._displayedElements):this._visibleElements&&(e=e.concat(this._visibleElements)),this._freedElements&&(e=e.concat(this._freedElements)),e}},{key:"clearCache",value:function(){this.verticalScrollPosition=0,this.freeElements(this.getElementAll()),this._caretIndex=-1,this._visibleIndices=[],this._visibleElements=[],this._displayedElements=[],this._freedElements=[],this._layoutControl.clear(),ye(this.contentLayer,0,0)}},{key:"clearCacheForLayout",value:function(){this.freeElements(this.getElementAll()),this._visibleIndices=[],this._visibleElements=[],this._displayedElements=[],this._freedElements=[],this._layoutControl.clear()}},{key:"destroy",value:function(){this._unregisterScroller(),this.root&&this.root.parentElement&&this.root.parentElement.removeChild(this.root),this.items=null}},{key:"getViewportRect",value:function(){var e=this._normalizedScrollTarget,t=0,n=0,i=0,o=0;if(e===window)i=window.innerWidth,o=window.innerHeight;else if(e){var s=e.getBoundingClientRect();t=s.left+e.clientLeft,n=s.top+e.clientTop,i=e.clientWidth,o=e.clientHeight}return{left:t,top:n,width:i,height:o}}},{key:"getContentRect",value:function(){return this._contentLayer.getBoundingClientRect()}},{key:"calculateViewportWidth",value:function(){return this._layoutControl.calculateViewportWidth()}},{key:"calculateViewportHeight",value:function(){return this._layoutControl.calculateViewportHeight()}},{key:"calculateContentWidth",value:function(){return this._layoutControl.calculateContentWidth()}},{key:"calculateContentHeight",value:function(){return this._layoutControl.calculateContentHeight()}},{key:"getItemStart",value:function(e){return this._layoutControl.getItemStart(e)}},{key:"getItemSize",value:function(e){return this._layoutControl.getItemSize(e)}},{key:"getItemIndexOf",value:function(e){return this._layoutControl.getItemIndexOf(e)}},{key:"setItemSize",value:function(e,t){return this._layoutControl.setItemSize(e,t)}},{key:"scrollToIndex",value:function(e){e=Math.max(0,Math.min(e,this.numItems-1));var t=this.itemIndexToRowIndex(e),n="horizontal"===this.layout,i=0;do{this._internalScrollToIndex(t);var o=void 0,s=void 0;s=n?(o=this.horizontalScrollPosition)+this.calculateViewportWidth()+1:(o=this.verticalScrollPosition)+this.calculateViewportHeight()+1;var r=this.getItemStart(t),l=r+this.getItemSize(t);if(o<=r&&l<=s)break}while(i++<10);10<=i&&console.warn("List.scrollToIndex error!!!")}},{key:"scrollToItem",value:function(e){this.collection&&this.scrollToIndex(this.collection.indexOf(e))}},{key:"scrollToTop",value:function(e){this.scrollToIndex(e);var t=this.getItemElementAt(e);if(t){var n=this.scrollTarget.getBoundingClientRect(),i=t.getBoundingClientRect().top-n.top;0<i&&(this.verticalScrollPosition+=i)}}},{key:"scrollToBottom",value:function(e){this.scrollToIndex(e);var t=this.getItemElementAt(e);if(t){var n=this.scrollTarget.getBoundingClientRect(),i=t.getBoundingClientRect(),o=n.bottom-i.bottom;0<o&&(this.verticalScrollPosition-=o)}}},{key:"positionToIndex",value:function(e,t){return this._layoutControl.positionToItemIndex(e,t)}},{key:"itemIndexToRowIndex",value:function(e){return this._layoutControl.itemIndexToRowIndex(e)}},{key:"getItemElement",value:function(e){return this.getItemElementAt(this.collection.indexOf(e))}},{key:"getItemElementAt",value:function(e){var t=this._visibleIndices.indexOf(e);return 0<=t?this._visibleElements[t]:e<this._displayedElements.length?this._displayedElements[e]:null}},{key:"invalidate",value:function(){this._invalidateFor(Qe)}},{key:"beginVisibleElements",value:function(){this._newVisibleIndices=[],this._newVisibleElements=[],this._oldVisibleElements=this._visibleElements.slice(0),this._cacheIsContinuousMode="normal"!==this.renderMode}},{key:"endVisibleElements",value:function(){this._cacheIsContinuousMode?this._hideElements(this._visibleElements):this.freeElements(this._visibleElements),this._visibleIndices=this._newVisibleIndices,this._visibleElements=this._newVisibleElements,delete this._cacheIsContinuousMode}},{key:"pushVisibleElements",value:function(e,t,n){this._cacheIsContinuousMode&&(this._displayedElements[n]=e),this._newVisibleIndices.push(n),this._newVisibleElements.push(e)}},{key:"updateItemElement",value:function(e,t,n){var i=this.renderItemCallback;i&&i(e,t,n,{selected:0<=this.selectedItems.indexOf(t),active:this.caretIndex===n})}},{key:"createItemElement",value:function(e){var t,n=this._visibleIndices,i=this._visibleElements,o=n.indexOf(e);return 0<=o&&(t=i[o],n[o]=null,i[o]=null),t||(t=this._displayedElements[e]),t||(t=this._freedElements.shift()),t||(t=pe(this.itemFactory,this.collection.get(e),e)),t instanceof HTMLElement&&(this._contentLayer!==t.parentElement&&this._contentLayer.appendChild(t),this._showElement(t)),t}},{key:"calculateElementWidth",value:function(e,t,n){return this.measureElementWidth instanceof Function?this.measureElementWidth(e,t,n):e.getMeasureWidth instanceof Function?e.getMeasureWidth(t,n):e.offsetWidth}},{key:"calculateElementHeight",value:function(e,t,n){this._isAutoHeight()&&(parseFloat(this._getTypicalMetaValue("maxHeight"))||ke.setMaxHeight(e,"none"));return this.measureElementHeight instanceof Function?this.measureElementHeight(e,t,n):e.getMeasureHeight instanceof Function?e.getMeasureHeight(t,n):e.offsetHeight}},{key:"setLayoutElement",value:function(e,t,n,i,o){this._isAutoHeight()?ke.setMaxHeight(e,o):ke.setHeight(e,o),i&&ke.setWidth(e,i),ke.setTranslate(e,t,n)}},{key:"freeElements",value:function(e){var n=this;e=e||[];var i=this._contentLayer,o=this.freeItemCallback,s=this._freedElements,r=(this._visibleElements,this._visibleIndices,this._displayedElements);e.forEach(function(e){if(e){o&&o(e);var t=r.indexOf(e);0<=t&&(r[t]=void 0),s.length<n.elementCacheCount?(s.push(e),n._hideElement(e)):e.parentElement&&i.removeChild(e)}})}},{key:"mouseEventToIndex",value:function(e){var t=this.contentLayer;if(t.contains(e.target)){var n=e.clientX,i=e.clientY,o=t.getBoundingClientRect(),s=Math.round(n-o.left),r=Math.round(i-o.top),l=this.positionToIndex(s,r);if(0<=l&&l<this.numItems)return l}return-1}},{key:"_isAutoHeight",value:function(){return this.autoSize&&("vertical"===this.layout||"grid"===this.layout)}},{key:"_internalScrollToIndex",value:function(e){var t,n,i=this._getScrollIndexDelta(e),o=!1;return i&&(t=this.verticalScrollPosition,n=this.horizontalScrollPosition,this.horizontalScrollPosition+=i.x,this.verticalScrollPosition+=i.y,this.horizontalScrollPosition===n&&this.verticalScrollPosition===t||(o=!0,this.invalidate(),this.validateNow())),o}},{key:"_getScrollIndexDelta",value:function(e){var t,n,i="horizontal"===this.layout;n=i?(t=this.horizontalScrollPosition)+this.calculateViewportWidth():(t=this.verticalScrollPosition)+this.calculateViewportHeight();var o=this.getItemStart(e),s=o+this.getItemSize(e),r=o-t,l=s-n;if(t<=o&&s<=n)return null;var a=Math.abs(r)<Math.abs(l)?r:l;return i?{x:a,y:0}:{x:0,y:a}}},{key:"_registerScroller",value:function(){var t=this;if(this.scrollTarget){this._normalizedScrollTarget.addEventListener("scroll",this._boundScrollTargetScroll);var e=this._sizeDetector=new Be(this.scrollTarget);e.addEventListener("size-change",function(e){t.dispatchEvent(new CustomEvent(e.type,{bubbles:!1,detail:e.detail})),t._invalidateFor(Xe)}),e.start()}}},{key:"_unregisterScroller",value:function(){this.scrollTarget&&(this._sizeDetector.stop(),this._normalizedScrollTarget.removeEventListener("scroll",this._boundScrollTargetScroll))}},{key:"syncScroll",value:function(){var e=this.getViewportRect(),t=this.getContentRect(),n=t.left-e.left+this.scrollTarget.scrollLeft,i=t.top-e.top+this.scrollTarget.scrollTop,o=n+this.horizontalScrollPosition,s=i+this.verticalScrollPosition;this.scrollTarget.scrollLeft===o&&this.scrollTarget.scrollTop===s||(this._lockedScroll=!0,this.scrollTarget.scrollLeft=o,this.scrollTarget.scrollTop=s,this._invalidateFor($e),this._lockedScroll=!1)}},{key:"doLayout",value:function(){if(this._isVisible()){var e=this.scrollTarget.clientWidth,t=this.scrollTarget.clientHeight,n=this._reasonsMask;if(this.dispatchEvent(new CustomEvent("render-updating",{bubbles:!1,detail:n})),this._isInvalidateReason(Ke)&&this._updateTypicalMeta(),this.autoHeight&&0<this.rowCount&&(this.rowHeight=Math.floor(Math.max((t-1)/this.rowCount,10))),this.beginVisibleElements(),0<this.numItems){var i=this._layoutControl;i.beginUpdate(),i.doUpdate(this.horizontalScrollPosition,this.verticalScrollPosition,e,t,this._oldWidth!==e,this._oldHeight!==t),i.endUpdate()}this.endVisibleElements(),this._oldWidth=this.scrollTarget.clientWidth,this._oldHeight=this.scrollTarget.clientHeight,this.dispatchEvent(new CustomEvent("render-update",{bubbles:!1,detail:n}))}}},{key:"dispatchEvent",value:function(e){if(!this.dispatchEventHook||(e=this.dispatchEventHook(e)))return v(u(o.prototype),"dispatchEvent",this).call(this,e)}},{key:"_isVisible",value:function(){var e=this.scrollTarget.getBoundingClientRect();return this._container&&0<e.width&&0<e.height}},{key:"_hideElements",value:function(e){var t=this;e&&e.forEach(function(e){e&&t._hideElement(e)})}},{key:"_showElement",value:function(e){e&&e.hidden&&(e.hidden=!1)}},{key:"_hideElement",value:function(e){e&&(e.hidden=!0)}},{key:"_updateTypicalMeta",value:function(){if(this.itemFactory){if(this.numItems<=0||this._typicalMeta&&this._typicalMeta.factory===this.itemFactory)return;try{var e=pe(this.itemFactory,this.collection.get(0),0);this._contentLayer.appendChild(e);var t=window.getComputedStyle(e);this._typicalMeta={style:{maxWidth:t.maxWidth,maxHeight:t.maxHeight},factory:this.itemFactory},this._contentLayer.removeChild(e),this.freeElements([e])}catch(e){this._typicalMeta=null}}else this._typicalMeta=null}},{key:"_getTypicalMetaValue",value:function(e){return this._typicalMeta&&this._typicalMeta.style[e]||null}},{key:"_itemsAdded",value:function(e,t){if(0<=e){var n,i,o=t&&t.length||0,s=this._visibleIndices.length;for(n=0;n<s;n++)e<=(i=this._visibleIndices[n])&&(this._visibleIndices[n]=i+o);if(0<this._displayedElements.length)for(n=0;n<o;n++)this._displayedElements.splice(e+n,0,void 0);this._layoutControl.itemsAdded(e,t),this.invalidate(et)}}},{key:"_itemsRemoved",value:function(e,t){if(0<=e){var n=t&&t.length||0,i=this._visibleIndices.indexOf(e);if(0<n&&0<=i){this._visibleIndices.splice(i,n);for(var o=this._visibleIndices.length,s=0;s<o;s++){var r=this._visibleIndices[s];e<=r&&(this._visibleIndices[s]=r-n)}this.freeElements(this._visibleElements.splice(i,n))}for(var l=0;l<n;l++)this.freeElements(this._displayedElements.splice(e,1));this._layoutControl.itemsRemoved(e,t),this._invalidateFor(et)}}},{key:"_commitSelection",value:function(e,t){var n=this.collection.get(e);1!==this.maxSelection&&t?this.toggleSelectedItem(n):this.selectedItem=n}},{key:"_dispatchItemEvent",value:function(e,t,n,i){return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!!n,detail:{index:t,item:this.collection.get(t),element:this.getItemElementAt(t),trigger:i}}))}},{key:"_redispatchEvent",value:function(e){return this.dispatchEvent(new CustomEvent(e.type,{cancelable:e.cancelable,detail:h({},e.detail,{trigger:this._triggerEvent})}))}},{key:"_commitCaret",value:function(e){return 0<=e&&e<this.numItems&&(this.caretIndex=e,this.scrollToIndex(e),!0)}},{key:"_moveArrow",value:function(e){var t="grid"===this.layout,n=this.caretIndex;switch(e.keyCode){case 37:n-=1;break;case 38:n-=t?this.numColumns:1;break;case 39:n+=1;break;case 40:n+=t?this.numColumns:1}return this.caretIndex!==n&&(this._commitCaret(n),!0)}},{key:"_onScrollTargetScroll",value:function(e){if(!this._lockedScroll){var t=this.getViewportRect(),n=this.getContentRect();this._horizontalScrollPosition=Math.round(Math.max(0,t.left-n.left)),this._verticalScrollPosition=Math.round(Math.max(0,t.top-n.top)),this._invalidateFor(qe)}}},{key:"_onCollectionChange",value:function(e){var t=e.detail;switch(t.kind){case"move":this._itemsRemoved(t.oldIndex,t.items),this._itemsAdded(t.index,t.items);break;case"add":this._itemsAdded(t.index,t.items);break;case"remove":this._itemsRemoved(t.index,t.items);break;case"set":case"update":this.invalidate();break;case"reset":this.clearCache(),this._invalidateFor(Ke);break;case"refresh":this.clearCacheForLayout(),this.invalidate()}this._redispatchEvent(e)}},{key:"_onMouseEvent",value:function(e){var t=this.mouseEventToIndex(e),n=Ue[e.type];if(0<=t&&n&&(!e.cancelable||!e.defaultPrevented)){this._triggerEvent=e;var i=this.useCtrlkeyOnSelection&&!e.ctrlKey;"item-down"===n?this._dispatchItemEvent(n,t,!0,e)?(this._downIndex=t,this._commitCaret(t),this.selectOnClick||this._commitSelection(t,i)):this._downIndex=-1:"item-click"===n?this._downIndex===t&&this._dispatchItemEvent(n,t,!0,e)&&this.selectOnClick&&this._commitSelection(t,i):this._dispatchItemEvent(n,t,!1,e),this._triggerEvent=null}}},{key:"_onKeydown",value:function(e){var t=e.keyCode,n=e.target;n instanceof HTMLElement&&(0<=["input","textarea"].indexOf(n.tagName.toLowerCase())||n.isContentEditable)||(this._triggerEvent=e,0<=this.selectOnKeys.indexOf(t)?0<=this.caretIndex&&(this.toggleSelectedItem(this.collection.get(this.caretIndex)),e.preventDefault()):this._moveArrow(e)&&e.preventDefault(),this._triggerEvent=null)}},{key:"contentLayer",get:function(){return this._contentLayer}},{key:"scrollTarget",get:function(){return this._scrollTarget},set:function(e){(e=e||this._container||this.root)!==this.scrollTarget&&(this._unregisterScroller(),this._scrollTarget=e,this._registerScroller(),this.invalidate())}},{key:"renderMode",get:function(){return this._renderMode},set:function(e){Ge.indexOf(e)<0&&(e="normal"),this._renderMode!==e&&(this._renderMode=e)}},{key:"_normalizedScrollTarget",get:function(){var e=this.scrollTarget,t=e&&e.parentElement,n=e&&e.ownerDocument||document;return e&&e.offsetParent&&t===n.documentElement?window:e}},{key:"horizontalScrollPosition",get:function(){return this._horizontalScrollPosition},set:function(e){e=Math.min(Math.max(0,e),this.maxHorizontalScrollPosition),this._horizontalScrollPosition!==e&&(this._horizontalScrollPosition=e,this.syncScroll())}},{key:"verticalScrollPosition",get:function(){return this._verticalScrollPosition},set:function(e){e=Math.min(Math.max(0,e),this.maxVerticalScrollPosition),this._verticalScrollPosition!==e&&(this._verticalScrollPosition=e,this.syncScroll())}},{key:"maxHorizontalScrollPosition",get:function(){return Math.max(this.scrollTarget.scrollWidth-this.scrollTarget.clientWidth,0)}},{key:"maxVerticalScrollPosition",get:function(){return Math.max(this.scrollTarget.scrollHeight-this.scrollTarget.clientHeight,0)}},{key:"layout",get:function(){return this._layout},set:function(e){if(this._layout!==e){var t;switch(this._layout=e){case"horizontal":t=new Te(this);break;case"grid":t=new Le(this);break;case"flow":t=new Me(this);break;case"vertical":t=new Oe(this);break;default:throw new TypeError("layout must be 'vertical/horizontal/grid/flow', received ".concat(e," instead."))}this._layoutControl=t,this.invalidate()}}},{key:"autoSize",get:function(){return this._autoSize},set:function(e){this._autoSize!==e&&(this._autoSize=e,this.invalidate())}},{key:"itemFactory",get:function(){return this._itemFactory},set:function(e){this.itemFactory!==e&&(this._itemFactory=e,this._invalidateFor(Je))}},{key:"renderItemCallback",get:function(){return this._renderItemCallback},set:function(e){this._renderItemCallback!==e&&(this._renderItemCallback=e,this.invalidate())}},{key:"freeItemCallback",get:function(){return this._freeItemCallback},set:function(e){this._freeItemCallback!==e&&(this._freeItemCallback=e,this.invalidate())}},{key:"columnWidth",get:function(){return this._columnWidth},set:function(e){this.columnWidth!==e&&(this._columnWidth=e,"horizontal"===this.layout&&this._layoutControl.clear(),this.invalidate())}},{key:"rowHeight",get:function(){return this._rowHeight},set:function(e){this._rowHeight!==e&&(this._rowHeight=e,"horizontal"!==this.layout&&this._layoutControl.clear(),this.invalidate())}},{key:"autoHeight",get:function(){return this._autoHeight},set:function(e){this._autoHeight!==e&&(this._autoHeight=e,this.invalidate())}},{key:"verticalGap",get:function(){return this._verticalGap},set:function(e){this._verticalGap!==e&&(this._verticalGap=e,this.invalidate())}},{key:"horizontalGap",get:function(){return this._horizontalGap},set:function(e){this._horizontalGap!==e&&(this._horizontalGap=e,this.invalidate())}},{key:"numItems",get:function(){return this.collection&&this.collection.length||0}},{key:"numColumns",get:function(){return this._numColumns}},{key:"maxRowCount",get:function(){return this._maxRowCount},set:function(e){this._maxRowCount!==e&&(this._maxRowCount=e,this.invalidate())}},{key:"rowCount",get:function(){return this._rowCount},set:function(e){this._rowCount!==e&&(this._rowCount=e,this.invalidate())}},{key:"columnCount",get:function(){return this._columnCount},set:function(e){this._columnCount!==e&&(this._columnCount=e,this.invalidate())}},{key:"caretIndex",get:function(){return this._caretIndex},set:function(e){this._caretIndex!==e&&(this._caretIndex=e,this._invalidateFor(Ye),this.dispatchEvent(new CustomEvent("caret-change",{bubbles:!1,cancelable:!1,detail:{index:e,item:this.collection.get(e),trigger:this._triggerEvent}})))}},{key:"normalizedRowCount",get:function(){var e=this.rowCount;return 0<this.maxRowCount&&e>this.maxRowCount&&(e=this.maxRowCount),e}}]),o}(),ee),nt=["node-add","node-remove","node-open","node-opening","node-close","node-closing"],it=function(e){function i(e,t){var n;return l(this,i),(n=g(this,u(i).call(this,e,t))).autoExpandLevel=0,n._childrenField="children",n._boundNodeEventHandler=n._onNodeEventHandler.bind(f(n)),n.selector.useIndexProperty=!1,n.selector.collectionFactory=function(){n.collection&&(n.collection.removeEventListener("collection-change",n._boundCollectionChange),nt.forEach(function(e){n.collection.removeEventListener(e,n._boundNodeEventHandler)}));var t=new le;return t.childrenField=n.childrenField,t.addEventListener("collection-change",n._boundCollectionChange),nt.forEach(function(e){t.addEventListener(e,n._boundNodeEventHandler)}),t},n}return c(i,tt),a(i,[{key:"updateItemElement",value:function(e,t,n){var i=this.renderItemCallback;i&&i(e,t,n,{selected:0<=this.selectedItems.indexOf(t),active:this.caretIndex===n,hasChildren:this.collection.hasChildren(t),level:this.collection.getNodeLevel(t),isOpened:this.collection.isOpenNode(t)})}},{key:"getParentNode",value:function(e){return this.collection&&this.collection.getParentNode(e)}},{key:"getAncestorNodes",value:function(e){return this.collection&&this.collection.getAncestorNodes(e)}},{key:"getChildren",value:function(e){return this.collection&&this.collection.getChildren(e)}},{key:"getDisplayableChildren",value:function(e){return this.collection&&this.collection.getDisplayableChildren(e)}},{key:"hasChildren",value:function(e){return this.collection&&this.collection.hasChildren(e)}},{key:"addNode",value:function(e,t){return this.collection&&this.collection.addNode(e,t)}},{key:"addNodeAt",value:function(e,t,n){return this.collection&&this.collection.addNodeAt(e,t,n)}},{key:"addNodes",value:function(e,t){return this.collection&&this.collection.addNodes(e,t)}},{key:"addNodesAt",value:function(e,t,n){return this.collection&&this.collection.addNodesAt(e,t,n)}},{key:"removeNode",value:function(e,t){return this.collection&&this.collection.removeNode(e,t)}},{key:"contains",value:function(e){return this.collection&&this.collection.contains(e)}},{key:"isOpenNode",value:function(e){return this.collection&&this.collection.isOpenNode(e)}},{key:"isDisplayableNode",value:function(e){return this.collection&&this.collection.isDisplayableNode(e)}},{key:"openNode",value:function(e){return this.collection&&this.collection.openNode(e)}},{key:"closeNode",value:function(e){return this.collection&&this.collection.closeNode(e)}},{key:"openNodes",value:function(e){return this.collection&&this.collection.openNodes(e)}},{key:"getDisplayableNodes",value:function(){return this.collection&&this.collection.displayableNodes}},{key:"getOpenedNodes",value:function(){return this.collection&&this.collection.getOpenedNodes()}},{key:"getNodeLevel",value:function(e){return this.collection&&this.collection.getNodeLevel(e)}},{key:"find",value:function(e,t,n){return this.collection&&this.collection.find(e,t,n)}},{key:"findOne",value:function(e,t,n){return this.collection&&this.collection.findOne(e,t,n)}},{key:"expandAll",value:function(){this.collection&&this.collection.expandAll()}},{key:"collapseAll",value:function(){this.collection&&this.collection.collapseAll()}},{key:"toggleNode",value:function(e){this.isOpenNode(e)?this.closeNode(e):this.openNode(e)}},{key:"_onCollectionChange",value:function(e){var t=this;v(u(i.prototype),"_onCollectionChange",this).call(this,e),"reset"===e.detail.kind&&0<this.autoExpandLevel&&this.openNodes(this.find(function(e){return t.getNodeLevel(e)<t.autoExpandLevel}))}},{key:"_onNodeEventHandler",value:function(e){var t=new CustomEvent(e.type,{bubbles:!0,cancelable:e.cancelable,detail:e.detail});switch(this.dispatchEvent(t),t.defaultPrevented&&e.preventDefault(),e.type){case"node-open":case"node-close":case"node-add":case"node-remove":this.invalidate()}}},{key:"childrenField",get:function(){return this._childrenField},set:function(e){this._childrenField!==e&&(this._childrenField=e,this.collection&&(this.collection.childrenField=this.childrenField))}}]),i}(),ot=(He=Object,Re=He.getPrototypeOf||function(e){return e.__proto__},Ve=He.setPrototypeOf||function(e,t){return e.__proto__=t,e},De="object"===("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect.construct:function(e,t,n){var i,o=[null];return o.push.apply(o,t),i=e.bind.apply(e,o),Ve(new i,n.prototype)},function(e){var t=Re(e);return Ve(e,Ve(function(){return De(t,arguments,Re(this).constructor)},t))});function st(e){return e===document.documentElement||e===window?{top:0,left:0,width:window.innerWidth,height:window.innerHeight,right:window.innerWidth,bottom:window.innerHeight}:e.getBoundingClientRect()}var rt=function(){function e(){l(this,e),this.overlayTarget=null,this.positionTarget=null,this.screenTarget=window,this.overlap=!1,this.horizontalAlign=null,this.verticalAlign=null,this.dynamicAlign=!0,this.horizontalOffset=0,this.verticalOffset=0,this._fitInfo=null}return a(e,[{key:"fit",value:function(){this._discoverInfo(),this.horizontalAlign||this.verticalAlign?this.position():(this.constrain(),this.center())}},{key:"resetFit",value:function(){var e=this._fitInfo||{};E(this.overlayTarget.style,e.overlayInlineStyle||{}),this._fitInfo=null}},{key:"refit",value:function(){var e=this.overlayTarget.scrollLeft,t=this.overlayTarget.scrollTop;this.resetFit(),this.fit(),this.overlayTarget.scrollLeft=e,this.overlayTarget.scrollTop=t}},{key:"position",value:function(){var e=this.overlayTarget.style;e.position="fixed",e.boxSizing="border-box";var t=this.targetRect,n=st(this.positionTarget||this.screenTarget),i=st(this.screenTarget),o=this._fitInfo.margin,s={width:t.width+o.left+o.right,height:t.height+o.top+o.bottom},r=this._getPosition(this.horizontalAlign,this.verticalAlign,s,n,i),l=r.left+o.left,a=r.top+o.top,c=Math.min(i.right-o.right,l+t.width),u=Math.min(i.bottom-o.bottom,a+t.height);l=Math.max(i.left+o.left,Math.min(l,c-this._fitInfo.sizedBy.minWidth)),a=Math.max(i.top+o.top,Math.min(a,u-this._fitInfo.sizedBy.minHeight)),"right"===this.horizontalAlign?(e.right=Math.max(0,i.width-c)+"px",e.removeProperty("left")):"auto"===this.horizontalAlign?e.left=Math.round(l-(t.width-n.width)/2)+"px":"none"!==this.horizontalAlign&&(e.left=l+"px"),"bottom"===this.verticalAlign?(e.bottom=Math.max(0,i.height-u)+"px",e.removeProperty("top")):"auto"===this.verticalAlign?e.top=Math.round(a-(t.height-n.height)/2)+"px":"none"!==this.verticalAlign&&(e.top=a+"px")}},{key:"constrain",value:function(){var e=this._fitInfo;e.positionedBy.vertically||(this.overlayTarget.style.position="fixed",this.overlayTarget.style.top="0px"),e.positionedBy.horizontally||(this.overlayTarget.style.position="fixed",this.overlayTarget.style.left="0px"),this.overlayTarget.style.boxSizing="border-box";var t=this.targetRect;e.sizedBy.height||this._sizeDimension(t,e.positionedBy.vertically,"top","bottom","Height"),e.sizedBy.width||this._sizeDimension(t,e.positionedBy.horizontally,"left","right","Width")}},{key:"center",value:function(){var e=this.overlayTarget.style,t=this.targetRect,n=st(this.screenTarget),i=this.verticalOffset+n.top+(n.height-t.height)/2,o=this.horizontalOffset+n.left+(n.width-t.width)/2;e.position="fixed",ve(this.overlayTarget,o,i,!0)}},{key:"_discoverInfo",value:function(){if(!this._fitInfo){var e=window.getComputedStyle(this.overlayTarget);this._fitInfo={overlayInlineStyle:{top:e.top||"",left:e.left||"",position:e.position||"",maxWidth:e.maxWidth||"",maxHeight:e.maxHeight||"",boxSizing:e.boxSizing||""},positionedBy:{vertically:null!=this.positionTarget?"auto"!==e.top?"top":"auto"!==e.bottom?"bottom":null:null,horizontally:null!=this.positionTarget?"auto"!==e.left?"left":"auto"!==e.right?"right":null:null},sizedBy:{height:"none"!==e.maxHeight,width:"none"!==e.maxWidth,minWidth:parseInt(e.minWidth,10)||0,minHeight:parseInt(e.minHeight,10)||0},margin:{top:parseInt(e.marginTop,10)||0,right:parseInt(e.marginRight,10)||0,bottom:parseInt(e.marginBottom,10)||0,left:parseInt(e.marginLeft,10)||0}}}return this._fitInfo}},{key:"_sizeDimension",value:function(e,t,n,i,o){var s=this._fitInfo,r=st(this.screenTarget),l="Width"===o?r.width:r.height,a=t===i,c=a?l-e[i]:e[n],u=s.margin[a?n:i],h="offset"+o,d=this[h]-this.overlayTarget[h];this.overlayTarget.style["max"+o]=l-u-c-d+"px"}},{key:"_getPosition",value:function(e,t,n,i,o){var s,r,l,a,c,u,h=[{verticalAlign:"top",horizontalAlign:"left",top:i.top+this.verticalOffset,left:i.left+this.horizontalOffset},{verticalAlign:"top",horizontalAlign:"right",top:i.top+this.verticalOffset,left:i.right-n.width-this.horizontalOffset},{verticalAlign:"bottom",horizontalAlign:"left",top:i.bottom-n.height-this.verticalOffset,left:i.left+this.horizontalOffset},{verticalAlign:"bottom",horizontalAlign:"right",top:i.bottom-n.height-this.verticalOffset,left:i.right-n.width-this.horizontalOffset}],d=this.overlap||!this.positionTarget;if(!d){for(var f=0,g=h.length;f<g;f++){var p={};for(var v in h[f])p[v]=h[f][v];h.push(p)}h[0].top=h[1].top+=i.height,h[2].top=h[3].top-=i.height,h[4].left=h[6].left+=i.width,h[5].left=h[7].left-=i.width}t="auto"===t?null:t,e="auto"===e?null:e;for(var _=0;_<h.length;_++){var m=h[_];if(!this.dynamicAlign&&d&&m.verticalAlign===t&&m.horizontalAlign===e){s=m;break}var y=!(t&&m.verticalAlign!==t||e&&m.horizontalAlign!==e);if(this.dynamicAlign||y){s=s||m,m.croppedArea=(r=m,l=n,a=o,void 0,c=Math.min(0,r.top)+Math.min(0,a.bottom-(r.top+l.height)),u=Math.min(0,r.left)+Math.min(0,a.right-(r.left+l.width)),Math.abs(c)*l.width+Math.abs(u)*l.height);var k=m.croppedArea-s.croppedArea;if((k<0||0===k&&y)&&(s=m),0===s.croppedArea&&y)break}}return s}},{key:"targetRect",get:function(){return this.overlayTarget.getBoundingClientRect()}}]),e}(),lt=Object.freeze({backdropFactory:function(){var e=document.createElement("div");return e.style.cssText="display:block;top:0;left:0;width:100%;height:100%;background-color: black;opacity: 0.6;transition: opacity 0.2s;position:fixed;pointer-events:auto;",e},modal:!1,style:{},closeEvents:["close"],cancelEvents:["cancel"],closeDelay:0,alwaysOnTop:!1,priority:0,autoLayout:!1,autoFocus:!0,destroyOnClose:!1,closeOnResize:!1,closeOnOutsideDown:!1,closeOnOutsideClick:!1,exceptionOutside:[],contentFactory:function(t,n){return new Promise(function(e){e(t,n)})},contentDestroy:function(e){},appendContent:function(e,t){t.appendChild(e)},removeContent:function(e,t){t.removeChild(e)}}),at=0,ct=1,ut=1;function ht(e){for(var t=e.length-1;0<=t;t--)e[t].state===ct&&e.splice(t,1)}var dt=ot(function(e){function n(e){var t;return l(this,n),(t=g(this,u(n).call(this)))._overlay=new rt,t._id="__popup"+ut+++"__",t._options=E({},lt,e||{}),t._content=null,t._sizeDetector=null,t._lastResult=null,t._isOpened=!1,t._isClosing=!1,t._openingCallback=[],t._openedCallback=[],t._closingCallback=[],t._closedCallback=[],t._boundUpdateLayout=function(e){t.updateLayout()},t}return c(n,q),a(n,[{key:"forceBuildContent",value:function(e,n){var i=this;return n=this._options=E({},this._options,n||{}),new Promise(function(t){i.content?t(i.content):n.contentFactory(e,n).then(function(e){i._content=e||i._content,t(i._content)}).catch(function(e){console.error(e)})})}},{key:"open",value:function(e,t){var n=this;return this.isOpened||(this._isOpened=!0,this._isOpening=!0,this._releaseCallbacks(),window.requestAnimationFrame(function(){n._isOpening&&(n._isOpening=!1,n._internalOpen(e,t))})),this}},{key:"close",value:function(e){return this.isOpened&&(this._isOpening?(this._isOpened=!1,this._isOpening=!1):this._internalClose(e,!1)),this}},{key:"cancel",value:function(e){return this.isOpened&&this._internalClose(e,!0),this}},{key:"center",value:function(){return this.isOpened&&(gt.hasPopup(this)?this._overlay.center():this._pendingCenter=!0),this}},{key:"destroy",value:function(){return this.isOpened&&this.close(),this.content&&(this.content.popupInstance&&(this.content.popupInstance=null),this.content.parentElement&&this.content.parentElement.removeChild(this.content),this.options.contentDestroy instanceof Function&&this.options.contentDestroy(this.content),this._content=null),this.backDrop&&(this._backDrop=null),this}},{key:"_internalOpen",value:function(e,t){var n=this;this.forceBuildContent(e,t).then(function(e){n._isOpened&&(n._updateContent(),n.options.autoLayout&&(n._sizeDetector||(n._sizeDetector=new Be(e),n._sizeDetector.addEventListener("size-change",n._boundUpdateLayout),n._sizeDetector.start())))})}},{key:"_pushCallback",value:function(e,t){if(t instanceof Function){if(!this._isOpened||this._isOpening){var n=this.isOpened?ct:at;e.push({state:n,callback:t})}}else console.warn("callback is not Function",t)}},{key:"_executeCallback",value:function(e,t){var n=[];return e.forEach(function(e){n.push(e.callback.apply(null,t))}),n}},{key:"_releaseCallbacks",value:function(){ht(this._openingCallback),ht(this._openedCallback),ht(this._closingCallback),ht(this._closedCallback)}},{key:"opening",value:function(e){return this._pushCallback(this._openingCallback,e),this}},{key:"opened",value:function(e){return this._pushCallback(this._openedCallback,e),this}},{key:"closing",value:function(e){return this._pushCallback(this._closingCallback,e),this}},{key:"closed",value:function(e){return this._pushCallback(this._closedCallback,e),this}},{key:"updateLayout",value:function(){return this._overlay.refit(),this}},{key:"_getPopupContainer",value:function(){var e="__popups__",t=this.content&&this.content.ownerDocument;t&&t.parentWindow||(t=document);var n=t.body,i=n.querySelector("#"+e);return i||((i=document.createElement("div")).id=e,i.style.cssText="left:0;top:0;display:block;position:fixed;z-index: 9999;",n.appendChild(i)),i}},{key:"_internalClose",value:function(e,t){var n=this;if(this.isOpened&&!this._isClosing){var i=function(){n._lastResult=e,n._isOpened=!1,n._unwatchContentForClose(n.content),n._destroyBackDrop(),n._removeContent(),n._executeCallback(n._closedCallback,[e,t]),n.options.destroyOnClose&&n.destroy(),gt.removePopup(n),n._isClosing=!1,n._sizeDetector&&(n._sizeDetector.removeEventListener("size-change",n._boundUpdateLayout),n._sizeDetector.stop(),n._sizeDetector=null)};this._executeCallback(this._closingCallback,[e,t]).every(function(e,t,n){return!1!==e})&&(0<this.options.closeDelay?(this._isClosing=!0,setTimeout(i,this.options.closeDelay)):i())}}},{key:"_updateContent",value:function(){var e=this.content;this._appendContent(),this._executeCallback(this._openingCallback,[e]),this._applyBackDrop(),this._watchContentForClose(),this._applyOverlayOrStyle(),this.updateLayout(),this._setContentFocus(),(e.popupInstance=this)._executeCallback(this._openedCallback,[e]),gt.addPopup(this),this._pendingCenter&&(this._pendingCenter=!1,this.center())}},{key:"_appendContent",value:function(){var e=this.content,t=this.options,n=this._getPopupContainer();t.appendContent(e,n)}},{key:"_removeContent",value:function(){var e=this.options,t=this.content;t&&t.parentElement&&e.removeContent(t,t.parentElement)}},{key:"_setContentFocus",value:function(){this.options.autoFocus&&this.content&&this.content.focus&&this.content.focus()}},{key:"_applyBackDrop",value:function(){var e=this.content,t=this.options;if(!t.modal&&this.backDrop)this.backDrop.parentElement&&this.backDrop.parentElement.removeChild(e),this._backDrop=null;else if(t.modal){if(this.backDrop||(this._backDrop=this.options.backdropFactory()),!this.backDrop.parentElement)this._getPopupContainer().insertBefore(this.backDrop,e)}}},{key:"_destroyBackDrop",value:function(){var e=this.backDrop;e&&e.parentElement&&e.parentElement.removeChild(e)}},{key:"_applyOverlayOrStyle",value:function(){var e=this.content,t=this.options;E((this._overlay.overlayTarget=e).style,t.style),E(this._overlay,t)}},{key:"_watchContentForClose",value:function(){var t=this,n=this.content,e=this.options,i=e.closeEvents||[],o=e.cancelEvents||[];this._boundCloseHandler||(this._boundCloseHandler=function(e){0<=i.indexOf(e.type)?t.close(e):t.cancel(e)},i.concat(o).forEach(function(e){n.addEventListener(e,t._boundCloseHandler)}))}},{key:"_unwatchContentForClose",value:function(t){var n=this,e=this.options,i=e.closeEvents||[],o=e.cancelEvents||[];this._boundCloseHandler&&(i.concat(o).forEach(function(e){t.removeEventListener(e,n._boundCloseHandler)}),this._boundCloseHandler=null)}},{key:"_contains",value:function(e){var t=this.options.exceptionOutside,n=[];if(t instanceof Function){if(t(e))return!0}else Array.isArray(t)&&(n=t);var i=[this.content].concat(n),o=e.path||[],s=e.clientX,r=e.clientY,l=e.target;if(this.options.active instanceof HTMLElement&&this.options.active.contains(l))return!0;for(var a=0;a<i.length;a++){var c=i[a];if(0<=o.indexOf(c)||c.contains(l)||this._containsInPopup(c,l))return!0;var u=c.getBoundingClientRect(),h=c.clientWidth===c.offsetWidth&&u.width<c.scrollWidth?u.left+c.scrollWidth:u.right,d=c.clientHeight===c.offsetHeight&&u.height<c.scrollHeight?u.top+c.scrollHeight:u.bottom;if(!(s<u.left||h<s||r<u.top||d<r))return!0}return!1}},{key:"_containsInPopup",value:function(e,t){for(;t;){if(t.popupInstance&&e.contains(t.popupInstance.options.active))return!0;t=t.parentElement}return!1}},{key:"_cancelByEvent",value:function(e){var t=this;if(!e.defaultPrevented){var n=e.type,i=e.target,o=this.options,s=o.closeOnOutsideDown,r=o.closeOnOutsideClick,l=o.exceptionOutside;if("scroll"===n&&(s||r))[this.content].concat(Array.isArray(l)?l:[]).filter(function(e){return i===e||e.contains(i)||t._containsInPopup(e,i)}).length<=0&&this.cancel(e);else("mousedown"===n&&s||"click"===n&&r)&&!this._contains(e)&&this.cancel(e)}}},{key:"content",get:function(){return this._content}},{key:"backDrop",get:function(){return this._backDrop}},{key:"lastResult",get:function(){return this._lastResult}},{key:"isOpened",get:function(){return this._isOpened}},{key:"options",get:function(){return this._options}}]),n}()),ft=["mousedown","mouseup","click","mousewheel","focus"],gt=new(function(){function e(){l(this,e),this._popups=[],this._pendingPopupMap=new Map,this._minZIndex=1e3,this._lockedPopups=null,this._alwaysOnTopCount=0,this._boundResize=this._onResize.bind(this),this._boundScroll=this._onScroll.bind(this),this._boundStageEventHandler=this._onStageEvents.bind(this)}return a(e,[{key:"hasPopup",value:function(e){return 0<=this._popups.indexOf(e)}},{key:"addPopup",value:function(e){this._popups.indexOf(e)<0&&(this._popups.push(e),e.options.alwaysOnTop&&this._alwaysOnTopCount++,this._lockedPopups&&this._lockedPopups.push(e),this.bringToFront(e),this._popups.length<=1&&this._addStageListeners())}},{key:"removePopup",value:function(e){var t=this._popups.indexOf(e);if(0<=t){this._popups.splice(t,1),e.options.alwaysOnTop&&this._alwaysOnTopCount--;var n=this._pendingPopupMap.get(e);n&&window.cancelAnimationFrame(n),0===this._popups.length&&this._removeStageListeners()}}},{key:"bringToFront",value:function(e){var t=this._popups,n=t.indexOf(e);if(!(n<0)){var i,o,s,r=this._alwaysOnTopCount,l=e.options.priority;for(t.splice(n,1),o=s=e.options.alwaysOnTop?(i=t.length-1,Math.max(0,i-(r-1)+1)):(i=t.length-1-r,0);o<=i&&!(l<t[o].options.priority);o++)s=o+1;for(t.splice(s,0,e),o=0;o<t.length;o++)this._updateZIndex(t[o])}}},{key:"center",value:function(e){e.center()}},{key:"_updateZIndex",value:function(e,t){if(e.isOpened){t||(t=this._popups.indexOf(e));var n=this._minZIndex+2*t;e.content.style.zIndex=n,e.backDrop&&(e.backDrop.style.zIndex=n-1)}}},{key:"_cancelPopups",value:function(t){var n=this._lockedPopups;this._popups.slice(0).forEach(function(e){(!n||n.indexOf(e)<0)&&e._cancelByEvent(t)})}},{key:"_addStageListeners",value:function(){var t=this;this._isInitiated||(this._isInitiated=!0,window.addEventListener("resize",this._boundResize),window.addEventListener("scroll",this._boundScroll,!0),ft.forEach(function(e){document.addEventListener(e,t._boundStageEventHandler,"focus"===e)}))}},{key:"_removeStageListeners",value:function(){var t=this;this._isInitiated&&(this._isInitiated=!1,window.removeEventListener("resize",this._boundResize),window.removeEventListener("scroll",this._boundScroll,!0),ft.forEach(function(e){document.removeEventListener(e,t._boundStageEventHandler,"focus"===e)}),this._lockedPopups=null)}},{key:"_onScroll",value:function(e){this._cancelPopups(e)}},{key:"_onResize",value:function(n){var e=this._popups,i=this._pendingPopupMap;e&&0<e.length&&e.forEach(function(e){var t=i.get(e);t&&window.cancelAnimationFrame(t),e.options.closeOnResize?e.close(n):(t=window.requestAnimationFrame(function(){e.updateLayout(),i.delete(e)}),i.set(e,t))})}},{key:"_onStageEvents",value:function(t){var n=this;switch(t.type){case"mousedown":this._lockedPopups=[],this._cancelPopups(t);break;case"mouseup":this._lockedPopups&&window.requestAnimationFrame(function(){n._lockedPopups=null});break;case"click":this._cancelPopups(t);break;case"focus":this._popups.some(function(e){if(e.content.contains(t.target))return n.bringToFront(e),!0})}}}]),e}());var pt,vt,_t,mt,yt={suggestDelay:300,suggestFactory:'<div class="suggest-container"><div class="suggest-list"></div></div>',suggestItemFactory:"<div></div>",hookRenderSuggestItem:null,hookFreeSuggestItem:null,suggestItemSize:40,suggestItemHighlightTemplate:'<em class="suggest-item__highlight">$1</em>',inputFactory:'<div class="input-control"><input autocomplete="off"></div>'},kt=function(e){function i(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return l(this,i),(t=g(this,u(i).call(this)))._options=n,t._selectContainer=t.DOM.selectContainer,t._boundInputEvent=t._onInputEvent.bind(f(t)),t._boundInputFocus=t._onInputFocus.bind(f(t)),t._boundInputBlur=t._onInputBlur.bind(f(t)),t._boundSuggestListItemClick=t._onSuggestListItemClick.bind(f(t)),t._boundSuggestListCaretChange=t._onSuggestListCaretChange.bind(f(t)),t._caretSuggestIndex=-1,t._lockedCount=0,t._focused=!1,t._suggestPopup=null,t._suggestContainer=null,t._suggestList=null,t._suggestItems=[],t._selectedSuggestItem=null,t._lastSuggestPromise=null,t._lastSuggestValue="",t._inputedValue="",t._highlightCache={},t._inputElement=null,t._inputGroup=null,t._debounceLoadSuggest=vrix.util.debounceFunction(t._loadSuggest,f(t),t._options.suggestDelay),t.labelField=n.labelField||null,t.minChar=1,t.suggestFilter=!0,t.placeholder=n.placeholder||"",t.suggestCount=6,t.suggestMinCount=0,t.delimiterOnKeys=[9,13],t.addEventListener("mousedown",t._onMouseDown.bind(f(t))),t}return c(i,We),a(i,null,[{key:"__template__",value:function(){return'<div class="auto-complete"><div id="selectContainer" class="select-container"></div></div>'}}]),a(i,[{key:"clear",value:function(){this._closeSuggestList(),this._caretSuggestIndex=-1,this._setInputValue(""),this._suggestItems=[],this._suggestList&&(this._suggestList.items=[])}},{key:"focus",value:function(){this._inputElement.focus()}},{key:"blur",value:function(){this._inputElement.blur()}},{key:"itemToLabel",value:function(e){return null!==this.labelField?e[this.labelField]:e&&e.toString()}},{key:"toHighlightHtml",value:function(e){var t,n,i,o,s,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",l=e+"|"+r,a=this._highlightCache[l];return void 0===a&&(a=this._highlightCache[l]=(t=e,n=r,i=this._options.suggestItemHighlightTemplate,o=I(n),s=new RegExp("(".concat(o.split(" ").join("|"),")"),"gi"),"".concat(t.replace(s,i)))),a}},{key:"openSuggest",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===e&&(e=this.inputValue),(e=e||"").length>=this.minChar&&(this.inputValue=e,this._loadSuggest(e),!0)}},{key:"closeSuggest",value:function(){this._closeSuggestList()}},{key:"destroy",value:function(){this._suggestList&&(this._suggestList.destroy(),this._suggestList=null),this._suggestPopup&&(this._suggestPopup.destroy(),this._suggestPopup=null),this.clear()}},{key:"_setInputElement",value:function(e){if(!(e instanceof HTMLElement))throw new Error("inputFactory is wrong.");var t=this._selectContainer;this.inputGroup&&t.removeChild(this.inputGroup);var n=this.inputElement;n&&(n.removeEventListener("focus",this._boundInputFocus),n.removeEventListener("blur",this._boundInputBlur),n.removeEventListener("keydown",this._boundInputEvent),n.removeEventListener("keyup",this._boundInputEvent),n.removeEventListener("input",this._boundInputEvent)),this._inputGroup=e,t.appendChild(e),(n=this._inputElement=t.querySelector("input"))&&(n.placeholder=this.placeholder,n.addEventListener("focus",this._boundInputFocus),n.addEventListener("blur",this._boundInputBlur),n.addEventListener("keydown",this._boundInputEvent),n.addEventListener("keyup",this._boundInputEvent),n.addEventListener("input",this._boundInputEvent))}},{key:"_getSuggestPopup",value:function(){return this._suggestPopup||(this._suggestPopup=new dt({positionTarget:this._options.positionTarget||this.root,horizontalAlign:"left",verticalAlign:"top",alwaysOnTop:!0,autoFocus:!1,closeOnResize:!0,closeOnOutsideDown:!0,exceptionOutside:[this.root],active:this.root}),this._suggestContainer=pe(this._options.suggestFactory),this._suggestList=this._createSuggestList(this._suggestContainer.querySelector(".suggest-list")||this._suggestContainer)),this._suggestPopup}},{key:"_openSuggestList",value:function(t){var n=this;if(this._suggestItems!==t&&(this._suggestItems=t,this._highlightCache={}),!(t.length<=0)){var e=this._getSuggestPopup(),i=this._suggestList,o=this._suggestContainer,s=function(){i.items!==t&&(i.rowCount=Math.max(n.suggestMinCount,Math.min(t.length,n.suggestCount)),i.items=t,n._commitCaretSuggestIndex(-1))};if(e.isOpened)return s(),void this._layoutSuggestList();var r=function(e){e.preventDefault(),n._lockFocus()},l=function(e){n._unlockFocus()};e.open(o).opening(function(e){var t=n.root.getBoundingClientRect();o.style.minWidth=t.width+"px",s()}).opened(function(e){o.addEventListener("mousedown",r),o.addEventListener("mouseup",l),i.addEventListener("item-click",n._boundSuggestListItemClick),i.addEventListener("caret-change",n._boundSuggestListCaretChange),n._dispatchEvent("suggest-open",{items:t})}).closed(function(e){o.removeEventListener("mousedown",r),o.removeEventListener("mouseup",l),i.removeEventListener("item-click",n._boundSuggestListItemClick),i.removeEventListener("caret-change",n._boundSuggestListCaretChange),n._dispatchEvent("suggest-close")})}}},{key:"_closeSuggestList",value:function(){var e=this._suggestPopup;e&&e.isOpened&&e.close()}},{key:"_createSuggestList",value:function(e){var s=this,r=s._options;return tt.create(e,{itemFactory:function(e,t){var n=pe(r.suggestItemFactory,e,t);return ke.addClass(n,"suggest-item"),n},renderItemCallback:function(e,t,n,i){if(r.hookRenderSuggestItem instanceof Function)r.hookRenderSuggestItem.apply(this,arguments);else{var o=s.itemToLabel(t);e.innerHTML=s.toHighlightHtml(o,s._lastSuggestValue),i.active?e.setAttribute("active",""):e.removeAttribute("active")}},freeItemCallback:function(e){r.hookFreeSuggestItem instanceof Function&&r.hookFreeSuggestItem.apply(this,arguments)},rowHeight:r.suggestItemSize})}},{key:"_layoutSuggestList",value:function(){this.isOpenedSuggest&&this._suggestPopup.updateLayout()}},{key:"_lockFocus",value:function(){this._focused&&this._lockedCount++}},{key:"_unlockFocus",value:function(){this._lockedCount<=0||(this._lockedCount--,this._lockedCount<=0&&(this._lockedCount=0,this.focus(),this.focus()))}},{key:"_filterSuggestItems",value:function(e){var n=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=I(e),o=new RegExp(i,"i");return t.filter(function(e){var t=n.itemToLabel(e);return n.suggestFilter instanceof Function?n.suggestFilter(e,t,n):!n.suggestFilter||o.test(t)})}},{key:"_changeInputValue",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=Math.max(0,this.minChar);return this._inputedValue!==e&&(this._inputedValue=e,this._dispatchEvent("input-change",{value:e,trigger:t}),e.length<n?this._closeSuggestList():this._debounceLoadSuggest(e),this._selectedSuggestItem=null,this._highlightCache={},!0)}},{key:"_loadSuggest",value:function(t){var n=this;if(t===this._lastSuggestValue&&0<this._suggestItems.length)this._openSuggestList(this._suggestItems);else{var i=function(e,t){e===n._inputedValue&&(e=e||"",0<(t=n._filterSuggestItems(e,t)).length?n._openSuggestList(t):n._closeSuggestList(),n._dispatchEvent("suggest-change",{value:e,items:t}))};this._lastSuggestValue=t||"";var o=this.suggestSource;o instanceof Function&&(o=o(t)),Array.isArray(o)?i(t,o):(o instanceof Promise||o instanceof te)&&(this._lastSuggestPromise&&this._lastSuggestPromise!==o&&(ke.removeClass(this.root,"suggest-progress"),this._dispatchEvent("suggest-cancel")),this._lastSuggestPromise=o,ke.addClass(this.root,"suggest-progress"),this._dispatchEvent("suggest-progress",{value:t}),o.then(function(e){o===n._lastSuggestPromise&&(i(t,e),n._lastSuggestPromise=null),ke.removeClass(n.root,"suggest-progress")}).catch(function(e){console.error(e),o===n._lastSuggestPromise&&(n._lastSuggestPromise=null),n._dispatchEvent("suggest-error",{error:e}),ke.removeClass(n.root,"suggest-progress")}))}}},{key:"_hasDelimiterKey",value:function(e){var t=this.delimiterOnKeys;return 0<=t.indexOf(e.keyCode)||0<=t.indexOf(String.fromCharCode(e.keyCode))}},{key:"_getInputValue",value:function(){return this._inputElement&&this._inputElement.value||""}},{key:"_setInputValue",value:function(e){e!==this._getInputValue()&&(this._inputElement.value=this._inputedValue=e,this._dispatchEvent("input-change",{value:e}))}},{key:"_selectSuggestItem",value:function(e){this._selectedSuggestItem=e,this._setInputValue(this.itemToLabel(e)),this._closeSuggestList(),this._dispatchEvent("suggest-select",{item:e})}},{key:"_commitCaretSuggestIndex",value:function(e){if(this._caretSuggestIndex!==e){var t=this._caretSuggestIndex;this._caretSuggestIndex=e,this._suggestList.caretIndex=e,this._suggestList.scrollToIndex(e),this._suggestList.invalidate(),this._suggestList.validateNow(),this._dispatchEvent("suggest-caret-change",{value:e,oldValue:t})}}},{key:"_moveUp",value:function(e){this.isOpenedSuggest&&(0<this._suggestItems.length&&this.isOpenedSuggest&&(0<=this._caretSuggestIndex&&this._commitCaretSuggestIndex(this._caretSuggestIndex-1),this._caretSuggestIndex<0&&this._closeSuggestList(),e.preventDefault()))}},{key:"_moveDown",value:function(e){var t=this._suggestItems.length;if(0<t)if(this.isOpenedSuggest){var n=Math.min(t-1,Math.max(this._caretSuggestIndex+1,0));this.isOpenedSuggest&&this._commitCaretSuggestIndex(n),e.preventDefault()}else this.openSuggest()}},{key:"_dispatchEvent",value:function(e,t){return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:t}))}},{key:"_applySuggestItem",value:function(){if(this.isOpenedSuggest){var e=this._caretSuggestIndex;if(1===this._suggestItems.length&&(e=0),0<=e){var t=this._suggestItems[e];return this._selectSuggestItem(t),!0}}return!1}},{key:"_adjustNavigation",value:function(e){switch(e.keyCode){case 38:this._moveUp(e);break;case 40:this._moveDown(e)}}},{key:"_onMouseDown",value:function(e){e.target!==this._inputElement&&(e.preventDefault(),e.stopPropagation(),this._inputElement.focus()),this._focused&&!this.isOpenedSuggest&&this.openSuggest()}},{key:"_onInputEvent",value:function(e){var t=e.type;"keydown"===t?(this._hasDelimiterKey(e)?this._applySuggestItem()&&(e.preventDefault(),e.stopPropagation()):this._adjustNavigation(e),this.dispatchEvent(new CustomEvent("input-key-down",{detail:{trigger:e}}))):"keyup"===t||"input"===t&&this._changeInputValue(this._getInputValue(),e)}},{key:"_onInputFocus",value:function(e){this._focused||(this._focused=!0,this.isOpenedSuggest||this.openSuggest(),this.dispatchEvent(new CustomEvent("focus",{detail:{trigger:e}})))}},{key:"_onInputBlur",value:function(e){0<this._lockedCount?this.focus():(this._focused=!1,this._closeSuggestList(),this.dispatchEvent(new CustomEvent("blur",{detail:{trigger:e}})))}},{key:"_onSuggestListItemClick",value:function(e){var t=C(e.detail.item,!0);this._selectSuggestItem(t)}},{key:"_onSuggestListCaretChange",value:function(e){var t=e.detail.index;t!==this._caretSuggestIndex&&(this._caretSuggestIndex=t)}},{key:"inputFactory",get:function(){return this._inputFactory},set:function(e){this._inputFactory!==e&&(this._inputFactory=e,this._setInputElement(pe(e)))}},{key:"inputGroup",get:function(){return this._inputGroup}},{key:"inputElement",get:function(){return this._inputElement}},{key:"suggestSource",get:function(){return this._suggestSource},set:function(e){e!==this.suggestSource&&(this._suggestSource=e)}},{key:"isOpenedSuggest",get:function(){return!(!this._suggestPopup||!this._suggestPopup.isOpened)}},{key:"caretSuggestIndex",get:function(){return this._caretSuggestIndex}},{key:"focused",get:function(){return this._focused}},{key:"inputValue",get:function(){return this._getInputValue()},set:function(e){this._setInputValue(e)}},{key:"selectedSuggestItem",get:function(){return this._selectedSuggestItem}},{key:"lastSuggestValue",get:function(){return this._lastSuggestValue||""}}],[{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return We.create.apply(i,[e,E({},yt,t)])}}]),i}(),bt="width: auto; height: auto; overflow: hidden; position: fixed;visibility: hidden; top: -999999px; left: -999999px;",It="select-item",Ct=h({},yt,{inputFactory:'<div class="input-control"><input autocomplete="off"></div>',selectedItemFactory:'<div><span class="'.concat(It,'-label"></span><span class="').concat(It,'-remover">×</span></div>')}),Et=function(e){function i(e,t){var n;return l(this,i),(n=g(this,u(i).call(this,e,t)))._inputSizer=n.DOM.inputSizer,n._inputSizer.style.cssText=bt,n._boundCollectionChange=n._onCollectionChange.bind(f(n)),n._selectContainer.addEventListener("click",n._onSelectContainerMouseClick.bind(f(n))),n._selectedElements=[],n._caretSelectedIndex=-1,n._anchorSelectedIndex=-1,n._typicalSelectedElement=null,n.selectedItems=[],n.selectedFilter=null,n.labelSelector=".".concat(It,"-label"),n.removerSelector=".".concat(It,"-remover"),n.allowDuplicate=!1,n.allowOnlySuggest=!1,n.addOnFocusOut=!1,n.multiple=!0,n.addEventListener("input-focus-out",function(){n.addOnFocusOut&&0<n.inputValue.trim().length&&n._addSelectedItemByInput()}),n}return c(i,kt),a(i,null,[{key:"__template__",value:function(){return'<div class="tokenizer"><div id="inputSizer"></div><div id="selectContainer" class="select-container"></div></div>'}}]),a(i,[{key:"clear",value:function(){var t=this;v(u(i.prototype),"clear",this).call(this),this._selectedElements.forEach(function(e){t._freeSelectedElement(e)}),this._selectedElements=[],this._caretSelectedIndex=-1,this._anchorSelectedIndex=-1}},{key:"destroy",value:function(){v(u(i.prototype),"destroy",this).call(this),this.selectedItems=null,this.clear(),this._typicalSelectedElement&&(this._freeSelectedElement(this._typicalSelectedElement),this._typicalSelectedElement=null)}},{key:"removeSelectedItem",value:function(e){this.removeSelectedItemAt(this.collection.get(e))}},{key:"removeSelectedItemAt",value:function(e){e<0||e>=this.collection.length||(this._removeSelectedItemItemAt(e),this._commitCaretSelectedIndex(-1),this.focus())}},{key:"_measure",value:function(){var e=this._typicalSelectedElement;if(e){var t=e.getBoundingClientRect(),n=getComputedStyle(e),i=t.height+parseInt(n.marginTop)+parseInt(n.marginBottom);this._selectContainer.style.minHeight=i+"px",this._inputElement.style.minHeight=i+"px"}}},{key:"_createSelectedItem",value:function(e){return this.labelField?r({},this.labelField,e):e}},{key:"_addSelectedItem",value:function(e){var t=this,n=this._selectedCollection.toArray(),i=this.itemToLabel(e);return null==i?(console.warn("Wrong item",e),!1):!(this.selectedFilter instanceof Function&&!this.selectedFilter(e,n))&&(!this.allowDuplicate&&n.some(function(e){return t.itemToLabel(e)===i})?(console.warn("Duplicate item",e),this._dispatchEvent("select-cancel",{item:e}),!1):(this.multiple||this._selectedCollection.removeAll(this._selectedCollection.toArray()),this._selectedCollection.add(e),!0))}},{key:"_addSelectedItemByInput",value:function(){if(!this.allowOnlySuggest){var e=this.inputValue.trim();if(0<e.length)return this._selectSuggestItem(this._createSelectedItem(e)),!0}return!1}},{key:"_removeSelectedItemItemAt",value:function(e){return this._selectedCollection.removeAt(e)}},{key:"_setSelectedLabel",value:function(e,t){var n=this.itemToLabel(t);if(this.labelSelector instanceof Function)this.labelSelector(e,t,n,this);else if(this.labelSelector){var i=e.querySelector(this.labelSelector);i&&(i.innerHTML=n)}}},{key:"_createTypicalSelectedElement",value:function(){this._typicalSelectedElement&&this._freeSelectedElement(this._typicalSelectedElement);var e=this._typicalSelectedElement=pe(this.selectedItemFactory);ke.addClass(e,It),e.style.cssText=bt,this.root.appendChild(e),this._setSelectedLabel(e,this._createSelectedItem("")),this._measure()}},{key:"_createSelectedElement",value:function(e,t){var n=this._selectContainer,i=pe(this.selectedItemFactory,e,t);return n.appendChild(i),ke.addClass(i,It),this._setSelectedLabel(i,e),(this._selectedElements[t]=i).__selectedItem__=e,this._layoutInputElement(),i}},{key:"_removeSelectedElement",value:function(t,e){var n;return!!(n=e<0?this._selectedElements.find(function(e){return e.__selectedItem__===t}):this._selectedElements[e])&&(this._freeSelectedElement(n),this._selectedElements.splice(e,1),this._layoutInputElement(),!0)}},{key:"_freeSelectedElement",value:function(e){var t=this._options.hookFreeSelectedElement;t instanceof Function&&t(e),e.parentElement&&e.parentElement.removeChild(e)}},{key:"_layoutInputElement",value:function(){0<this._selectedElements.length&&(this._lockFocus(),this._selectContainer.insertBefore(this.inputGroup,null),this._unlockFocus())}},{key:"_itemsAdded",value:function(n,e){var i=this;this._lockFocus(),(e||[]).forEach(function(e,t){i._createSelectedElement(e,n+t)}),this._commitCaretSelectedIndex(-1),this._unlockFocus()}},{key:"_itemsRemoved",value:function(n,e){var i=this;this._lockFocus(),(e||[]).forEach(function(e,t){i._removeSelectedElement(e,n)}),this._commitCaretSelectedIndex(-1),this._unlockFocus(),this._layoutSuggestList()}},{key:"_itemsReset",value:function(e){this.clear(),e&&0<e.length&&this._itemsAdded(0,e,!1)}},{key:"_resizeInputElement",value:function(e){this._inputSizer.innerHTML=e||"";var t=this._selectContainer.getBoundingClientRect(),n=this._inputSizer.getBoundingClientRect(),i=this._typicalSelectedElement.getBoundingClientRect();this.inputGroup.style.minWidth=Math.min(t.width,n.width+i.width)+"px"}},{key:"_findSelectedIndex",value:function(e){var t=e.closest(".select-item");return t?this._selectedElements.indexOf(t):-1}},{key:"_changeInputValue",value:function(e,t){v(u(i.prototype),"_changeInputValue",this).call(this,e,t)&&(this._commitCaretSelectedIndex(-1),this._resizeInputElement(e),this._layoutSuggestList())}},{key:"_selectSuggestItem",value:function(e){this._addSelectedItem(e),this._closeSuggestList(),this.inputValue=""}},{key:"_activeSelectedElement",value:function(e){var t=this._selectedElements[e];t&&!t.hasAttribute("active")&&t.setAttribute("active","")}},{key:"_deactiveSelectedElement",value:function(e){var t=this._selectedElements[e];t&&t.hasAttribute("active")&&t.removeAttribute("active")}},{key:"_commitCaretSelectedIndex",value:function(e,t){var n=this,i=this._selectedCollection.toArray();if(t&&0<=e?this._anchorSelectedIndex<0&&(this._anchorSelectedIndex=e):this._anchorSelectedIndex=e,this._caretSelectedIndex!==e){var o=this._caretSelectedIndex;this._caretSelectedIndex=e;var s=Math.min(this._anchorSelectedIndex,e),r=Math.max(this._anchorSelectedIndex,e);i.forEach(function(e,t){s<=t&&t<=r?n._activeSelectedElement(t):n._deactiveSelectedElement(t)}),this._dispatchEvent("item-caret-change",{value:e,oldValue:o})}}},{key:"_moveLeft",value:function(e){var t,n=this._selectedCollection.length,i=this._caretSelectedIndex;return 0<n&&(0===this._inputElement.selectionStart||0<=i)&&(t=0===i?-1:0<i?i-1:n-1,this._commitCaretSelectedIndex(t,e.shift),e.preventDefault(),!0)}},{key:"_moveRight",value:function(e){var t,n=this._selectedCollection.length,i=this._caretSelectedIndex,o=this.inputValue;return(0<n&&this._inputElement.selectionStart===o.length||0<=i)&&(t=i===n-1?-1:i<n-1?i+1:0,this._commitCaretSelectedIndex(t,e.shift),e.preventDefault(),!0)}},{key:"_backspace",value:function(e){var t=this._caretSelectedIndex;return 0<=t?(this._removeSelectedItemItemAt(t),e.preventDefault(),!0):0<this._selectedCollection.length&&0===this._inputElement.selectionStart&&(this._moveLeft(e),!0)}},{key:"_delete",value:function(e){var t=this._caretSelectedIndex;return 0<=t&&(this._removeSelectedItemItemAt(t),e.preventDefault(),!0)}},{key:"_applySuggestItem",value:function(){return!this.isOpenedSuggest||this.caretSuggestIndex<0?this._addSelectedItemByInput():v(u(i.prototype),"_applySuggestItem",this).call(this)}},{key:"_adjustNavigation",value:function(e){switch(e.keyCode){case 8:if(this._backspace(e))return;break;case 46:if(this._delete(e))return;break;case 37:return void this._moveLeft(e);case 39:return void this._moveRight(e);case 35:return}v(u(i.prototype),"_adjustNavigation",this).call(this,e)}},{key:"_onCollectionChange",value:function(e){var t=e.detail,n=t.index,i=t.items;switch(t.kind){case"move":break;case"set":case"add":this._itemsAdded(n,i),this._dispatchEvent("item-add",{items:i,index:n});break;case"remove":this._itemsRemoved(n,i),this._dispatchEvent("item-remove",{items:i,index:n});break;case"reset":this._itemsReset(this.collection.source),this._dispatchEvent("item-reset",{items:this.collection.source})}this._dispatchEvent(e.type,t)}},{key:"_onSelectContainerMouseClick",value:function(e){var t=e.target.closest(this.removerSelector),n=this._findSelectedIndex(e.target);t&&0<=n&&(this._removeSelectedItemItemAt(n),this.focus())}},{key:"collection",get:function(){return this._selectedCollection}},{key:"selectedItems",get:function(){return this._selectedCollection&&this._selectedCollection.source||[]},set:function(e){e||(e=[]),this.selectedItems!==e&&(this.collection&&this.collection.removeEventListener("collection-change",this._boundCollectionChange),this._selectedCollection=new J,this.collection.addEventListener("collection-change",this._boundCollectionChange),this._selectedCollection.source=e)}},{key:"selectedItemFactory",get:function(){return this._selectedItemFactory},set:function(e){this._selectedItemFactory!==e&&(this._selectedItemFactory=e,this._createTypicalSelectedElement())}},{key:"inputValue",get:function(){return v(u(i.prototype),"inputValue",this)},set:function(e){this.inputValue!==e&&(n(u(i.prototype),"inputValue",e,this,!0),this._resizeInputElement(e))}}],[{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return We.create.apply(i,[e,E({},Ct,t)])}}]),i}(),St=h({},Ct),wt=function(e){function i(e,t){var n;return l(this,i),(n=g(this,u(i).call(this,e,t))).allowOnlySuggest=!0,n.multiple=!1,n.minChar=0,n}return c(i,Et),a(i,null,[{key:"__template__",value:function(){return'<div class="combobox">\n                    <div id="inputSizer"></div>\n                    <div class="combobox-controls">\n                        <div id="selectContainer" class="select-container"></div>\n                        <div id="dropdownTrigger" class="dropdown-trigger"><button tabindex="-1">▼</button></div>\n                    </div>\n                </div>'}}]),a(i,[{key:"_createSelectedItem",value:function(e){return e}},{key:"items",get:function(){return v(u(i.prototype),"suggestSource",this)},set:function(e){n(u(i.prototype),"suggestSource",e,this,!0)}}],[{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return We.create.apply(i,[e,E({},St,t)])}}]),i}(),xt=(pt=Object,vt=pt.getPrototypeOf||function(e){return e.__proto__},_t=pt.setPrototypeOf||function(e,t){return e.__proto__=t,e},mt="object"===("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect.construct:function(e,t,n){var i,o=[null];return o.push.apply(o,t),i=e.bind.apply(e,o),_t(new i,n.prototype)},function(e){var t=vt(e);return _t(e,_t(function(){return mt(t,arguments,vt(this).constructor)},t))}),Ot=HTMLElement.prototype,Tt=Ot.matches||Ot.matchesSelector||Ot.webkitMatchesSelector||Ot.mozMatchesSelector||Ot.msMatchesSelector,Lt={priority:99999999,alwaysOnTop:!0,horizontalAlign:"left",verticalAlign:"top",style:{margin:0,pointerEvents:"none"},destroyOnClose:!0},Mt={dragLimitLength:10,cancelKeyCodes:[27],mirrorAnchor:[]},Pt="__release__";var zt=xt(function(e){function i(e,t){var n;if(l(this,i),n=g(this,u(i).call(this)),!(e instanceof HTMLElement))throw new Error("Draggable container is expected to be of type `HTMLElement`");return n._container=e,n._options=E({},Mt,t),n._mirrorPopup=new dt,n._boundContainerMouseDown=n._onContainerMouseDown.bind(f(n)),n._document=e.ownerDocument||document,n._container.addEventListener("mousedown",n._boundContainerMouseDown),n._dragging=!1,n._mirrorElement=null,n._dragScrollingId=-1,n._dragScrolling=!1,n}return c(i,q),a(i,[{key:"cancel",value:function(){this._dragCancel(),this.dispatchEvent(new CustomEvent(Pt))}},{key:"destroy",value:function(){this.cancel(),this._container.removeEventListener("mousedown",this._boundContainerMouseDown)}},{key:"cancelDragEnter",value:function(){this._dragLeave(new CustomEvent("drag-enter-cancel"))}},{key:"_dragReady",value:function(e){var t=this._findElement(e),n=this._getDraggableElement(t);if(!n)return!1;var i=this._options.dragSource;return this._dragElement=n,this._dragSource=i instanceof Function?i(n,e):i,!!this._dispatchDragEvent("drag-ready",null,e,!0)||(this._dragElement=null,this._dragSource=null,!1)}},{key:"_dragStart",value:function(t){var n=this;if(!this._dispatchDragEvent("drag-start",null,t,!0))return!1;var i=this._dragElement;this._scroller=this._getScroller(),this._dragging=!0;var o=this._mirrorElement=this._createMirrorElement(i);return o&&(ke.addClass(o,"drag-mirror"),ke.addClass(i,"drag-dragging"),this._mirrorPopup.open(o,Lt).opening(function(e){n._dispatchMirrorEvent("drag-mirror-create",i,o,t),n._mirrorOffset=n._calculateMirrorOffset(t),n._moveMirrorElement(t)})),!0}},{key:"_dragMove",value:function(e){if(!this._dragging)return!1;var t=this._calculateDragScrollDelta(e);t?this._startDragScrolling(t):this._stopDragScrolling();var n=this._findElement(e),i=this._getDroppableElement(n),o=this._overContainer,s=o&&o!==i;(this._moveMirrorElement(e),this._dispatchDragEvent("drag-move",i,e),s&&(this._dragLeave(e),ke.removeClass(o,"drag-container-over"),this._dispatchDragEvent("drag-out",this._overContainer,e),this._overContainer=null),i)&&(this._overContainer!==i&&(ke.addClass(i,"drag-container-over"),this._overContainer=i),this._dispatchDragEvent("drag-over",i,e,!0)?this._dropContainer&&this._dragLeave(e):this._dragEnter(e,i));return!0}},{key:"_dragEnter",value:function(e,t){this._dropContainer!==t&&this._dispatchDragEvent("drag-enter",t,e,!0)&&(this._dropContainer=t,ke.addClass(t,"drag-container-enter"),this._mirrorElement&&this._mirrorElement.setAttribute("drag-entering",""))}},{key:"_dragLeave",value:function(e){this._dropContainer&&(ke.removeClass(this._dropContainer,"drag-container-enter"),this._dispatchDragEvent("drag-leave",this._dropContainer,e),this._mirrorElement&&this._mirrorElement.removeAttribute("drag-entering"),this._dropContainer=null)}},{key:"_dragEnd",value:function(e){return!!this._dragging&&(this._dropContainer&&this._dispatchDragEvent("drop",this._dropContainer,e,!0),this._dragStop("drag-end",e),!0)}},{key:"_dragCancel",value:function(){return!!this._dragging&&(this._dragStop("drag-cancel",new CustomEvent("drag-cancel")),!0)}},{key:"_dragStop",value:function(e,t){this._overContainer&&ke.removeClass(this._overContainer,"drag-container-over"),this._mirrorElement&&(this._dispatchMirrorEvent("drag-mirror-remove",this._dragElement,this._mirrorElement,t),ke.removeClass(this._mirrorElement,"drag-mirror"),this._mirrorElement.removeAttribute("drag-entering"),this._mirrorPopup.close()),this._dropContainer&&ke.removeClass(this._dropContainer,"drag-container-enter"),this._dragElement&&ke.removeClass(this._dragElement,"drag-dragging"),this._stopDragScrolling(),this._dispatchDragEvent(e,this._dropContainer,t),this._dragging=!1,this._dragElement=null,this._dragSource=null,this._mirrorElement=null,this._dropContainer=null,this._overContainer=null}},{key:"_calculateDragScrollDelta",value:function(e){var t=this._scroller;if(!t)return null;var n=t.getBoundingClientRect(),i=Math.round(e.clientX-n.left),o=Math.round(e.clientY-n.top),s=0,r=0;return t.clientWidth<t.scrollWidth&&(i<=30?s=-10:n.width-i<=30&&(s=10)),t.clientHeight<t.scrollHeight&&(o<=30?r=-10:n.height-o<=30&&(r=10)),0===s&&0===r?null:{x:s,y:r}}},{key:"_startDragScrolling",value:function(i){var o=this,s=this._scroller;if(i&&s&&this._dragScrollingId<0){!function e(){var t=s.scrollLeft,n=s.scrollTop;s.scrollTop+=i.y,s.scrollLeft+=i.x,o._dragScrollingId=window.requestAnimationFrame(e),o._dragScrolling=s.scrollLeft!==t||s.scrollTop!==n}()}}},{key:"_stopDragScrolling",value:function(){0<this._dragScrollingId&&(window.cancelAnimationFrame(this._dragScrollingId),this._dragScrollingId=-1,this._dragScrolling=!1)}},{key:"_getDraggableElement",value:function(e){return this._normalizeElement(e,this._options.draggable)}},{key:"_getDroppableElement",value:function(e){return this._normalizeElement(e,this._options.droppable)}},{key:"_createMirrorElement",value:function(e){var t=this._options.mirror;if(!1===t);else{if(t instanceof Function)return t(e);if(e instanceof HTMLElement){var n=e.cloneNode(!0),i=e.getBoundingClientRect();return ke.setSize(n,i.width,i.height),n}}return null}},{key:"_getScroller",value:function(){var e=this._options.scrollTarget;return e instanceof HTMLElement?e:"string"==typeof e?this._document.querySelector(e):null}},{key:"_calculateMirrorOffset",value:function(e){var t,n=this._dragElement,i=this._mirrorElement,o=this._options.mirrorAnchor;if(Array.isArray(o)&&2<=o.length)t={left:i.offsetWidth*o[0]||0,top:i.offsetHeight*o[1]||0};else{var s=n.getBoundingClientRect();t={left:e.clientX-s.left,top:e.clientY-s.top}}return t}},{key:"_moveMirrorElement",value:function(e){if(this._mirrorElement&&this._mirrorOffset){var t=this._mirrorElement.style,n=e.clientX-this._mirrorOffset.left,i=e.clientY-this._mirrorOffset.top;t.webkitTransform=t.transform="translate("+n+"px,"+i+"px)"}}},{key:"_findElement",value:function(e){return e.target}},{key:"_normalizeElement",value:function(e,t){if(!e)return null;if(!0===t)return e;if(t instanceof Function)return t(e);if("string"==typeof t){if(!this._container.contains(e))return null;for(var n=e;n&&n!==this._document.body&&n!==this._document&&n!==this._container;){if(Tt.call(n,t))return n;n=n.parentNode}}return null}},{key:"_dispatchDragEvent",value:function(e,t,n,i){var o=new CustomEvent(e,{cancelable:!!i,detail:{container:this._container,dragSource:this._dragSource,dragElement:this._dragElement,overContainer:t,trigger:n}});return this.dispatchEvent(o),!o.defaultPrevented}},{key:"_dispatchMirrorEvent",value:function(e,t,n,i){return this.dispatchEvent(new CustomEvent(e,{cancelable:!0,detail:{container:this._container,dragSource:this._dragSource,dragElement:t,mirrorElement:n,trigger:i}}))}},{key:"_toggleUserSelect",value:function(e){var t,n,i;t=this._document.body,n=e?"":"none",(i=t.style).userSelect=n,i.msUserSelect=n,i.webkitUserSelect=n,i.mozUserSelect=n,i.oUserSelect=n}},{key:"_onContainerMouseDown",value:function(t){var i=this;if(0===t.button&&!t.ctrlKey&&!t.metaKey&&this._dragReady(t)){var o=this._document,s=t.clientX,r=t.clientY,l=t,n=function(e){t.preventDefault()},a=function(e){0<=(i._options.cancelKeyCodes||[]).indexOf(e.keyCode)&&i.cancel()},c=function(e){if(i._dragging)i._dragMove(e)&&e.stopPropagation();else{var t=e.clientX-s,n=e.clientY-r;Math.sqrt(t*t+n*n)>i._options.dragLimitLength&&(i._dragStart(l)?o.addEventListener("keydown",a):i.dispatchEvent(new CustomEvent(Pt)))}},u=function(e){i._dragging&&i._dragEnd(e)&&e.stopPropagation(),i.dispatchEvent(new CustomEvent(Pt))};this._toggleUserSelect(!1),o.addEventListener("mousemove",c),o.addEventListener("mouseup",u),o.addEventListener("dragstart",n),this.addEventListener(Pt,function e(t){t.stopPropagation(),i._toggleUserSelect(!0),o.removeEventListener("keydown",a),o.removeEventListener("mouseup",u),o.removeEventListener("mousemove",c),o.removeEventListener("dragstart",n),i.removeEventListener(Pt,e)})}}},{key:"dragging",get:function(){return this._dragging}},{key:"dragElement",get:function(){return this._dragElement}},{key:"dragSource",get:function(){return this._dragSource}},{key:"dragScrolling",get:function(){return this._dragScrolling}}]),i}()),Nt=function(){function n(e,t){l(this,n),this.setValues(e,t)}return a(n,[{key:"setValues",value:function(e,t){return this.x=e||0,this.y=t||0,this}},{key:"subtract",value:function(e){return new n(this.x-e.x,this.y-e.y)}},{key:"interpolate",value:function(e,t){return new n(e.x+(this.x-e.x)*t,e.y+(this.y-e.y)*t)}},{key:"offset",value:function(e,t){return this.x+=e,this.y+=t,this}},{key:"clone",value:function(){return new n(this.x,this.y)}},{key:"equals",value:function(e){return e&&this.x===e.x&&this.y===e.y}},{key:"toString",value:function(){return"[Point (x="+this.x+" y="+this.y+")]"}},{key:"interpolate",value:function(e,t,n){return e.interpolate(t,n)}},{key:"polar",value:function(e,t){return new n(e*Math.cos(t),e*Math.sin(t))}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}],[{key:"distance",value:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}}]),n}();function At(e,t,n){return isNaN(t)||(e=Math.max(e,t)),isNaN(n)||(e=Math.min(e,n)),e}var Ft={left:!0,right:!0,top:!0,bottom:!0},Ht={left:10,right:10,top:10,bottom:10};function Rt(e){e&&E(y,e,{overwrite:!0,deep:!0,copy:!1})}return E(Rt,{defaults:y,core:{ProgressPromise:te,Selector:Q},collection:{ArrayList:J,HierarchyList:le},net:{http:fe,download:function(e,t,n,i,c){var o={};if(null==e&&(e="/"),2===arguments.length&&Object.keys(arguments[1]).find(function(e){return"params"===e||"method"===e||"body"===e||"fileName"===e})){var s=arguments[1];t=s.params||{},"method"in s&&(n=s.method),"body"in s&&(i=s.body),"fileName"in s&&(c=s.fileName)}o.responseType="blob";var u=fe(e,t,n,i,o).then(function(e){if(null==c){var t=u.xhr.getResponseHeader("Content-Disposition");if(null!=t&&0<t.trim().length)for(var n,i,o=t.split(";"),s=o.length,r=0;r<s;++r)if(2<=(n=o[r].split("=")).length&&"filename"===n[0].trim().toLowerCase()){for(i=n[1].trim();'"'===i.charAt(0);)i=i.substring(1);for(;'"'===i.charAt(i.length-1);)i=i.substring(0,i.length-1);c=decodeURIComponent(i);break}if(null==c)throw new Error("Could not found `fileName`.")}if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,c);else{var l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=c,document.body.appendChild(a),a.click(),requestAnimationFrame(function(){document.body.removeChild(a),window.URL.revokeObjectURL(l)})}return e});return u}},file:{browse:function(e,t){var n=document.createElement("input");if(n.setAttribute("type","file"),null!=e){if("string"!=typeof e)throw new Error("`accept` argument must be `string` type.");n.setAttribute("accept",e)}t&&n.setAttribute("multiple","multiple"),n.style.display="none",document.body.appendChild(n),n.onclick=function(e){e.stopPropagation(),delete n.onclick};var i=new Promise(function(t){n.addEventListener("change",function e(){n.removeEventListener("change",e),document.body.removeChild(n),t(n.files)})});return n.click(),i}},ui:{List:tt,Tree:it,Popup:dt,AutoComplete:kt,Tokenizer:Et,ComboBox:wt,ScaleViewer:function(e){function r(e,t){var n;l(this,r),(n=g(this,u(r).call(this))).panOnKey=32,n._scale=1,n._minScale=.2,n._maxScale=4,n._padding=Ht,n._autoPage=Ft,n._enablePan=!0,n._enableZoom=!0,n._isPanning=!1,n._hiddenScroll=!1;var i=n._scroller=n.DOM.scroller;n._container=n.DOM.container,n._viewport=n.DOM.viewport;i.addEventListener("scroll",n._onScroll.bind(f(n))),n.addEventListener("mousewheel",n._onMouseWheel.bind(f(n))),n.addEventListener("keydown",n._onKeyDown.bind(f(n))),n.addEventListener("keyup",n._onKeyUp.bind(f(n))),(n._sizeDetector=new Be(n.root)).addEventListener("size-change",function(e){n.dispatchEvent(new CustomEvent(e.type,{bubbles:!1,detail:e.detail})),n.invalidate()});var o=n._onDragHandler.bind(f(n)),s=n._dragManager=new zt(n.root,{draggable:!0,mirror:!1,dragLimitLength:0});return["drag-start","drag-move","drag-end"].forEach(function(e){s.addEventListener(e,o)}),n}return c(r,We),a(r,null,[{key:"__template__",value:function(){return'<div id="scroller" class="size-viewer-scroller" tabindex="-1"><div id="container" class="size-viewer-container" style="min-width: 100%;min-height: 100%;"><div id="viewport" class="size-viewer-viewport" style="transform-origin:0 0;position: absolute"></div></div></div>'}}]),a(r,[{key:"setContent",value:function(e){this._content&&this._viewport.removeChild(this._content),this._content=e,this._content&&(this._viewport.appendChild(this._content),this.invalidate(),this.validateNow())}},{key:"center",value:function(e,t){e=e||0,t=t||0,this.validateNow();var n=this._scroller;this.scrollLeft=e+(n.scrollWidth-n.clientWidth)/2,this.scrollTop=t+(n.scrollHeight-n.clientHeight)/2}},{key:"destroy",value:function(){this._sizeDetector.stop()}},{key:"doLayout",value:function(e,t){this._layoutContent(),this._layoutContainer(),this._centerContent()}},{key:"_internalSetScale",value:function(e){if(e=At(e,this.minScale,this.maxScale),this._scale===e)return!1;var t=this._scale;return this._scale=e,this._dispatchChangeEvent("scale",e,t),!0}},{key:"_layoutContent",value:function(){if(this.content){var e=Math.round(this.content.offsetWidth),t=Math.round(this.content.offsetHeight);ye(this._viewport,e,t)}}},{key:"_layoutContainer",value:function(){var e=this._scroller,t=this._container,n=this._viewport,i=this.padding,o=this.autoPage,s=o.left?e.clientWidth-i.left:i.left,r=o.right?e.clientWidth-i.right:i.right,l=o.top?e.clientHeight-i.top:i.top,a=o.bottom?e.clientHeight-i.bottom:i.bottom,c=Math.round(n.clientWidth*(this.scale-1)),u=Math.round(n.clientHeight*(this.scale-1));ye(t,Math.round(n.clientWidth+s+r+c),Math.round(n.clientHeight+l+a+u))}},{key:"_centerContent",value:function(){var e=this._container,t=this._viewport,n=this.padding,i=this.autoPage,o=Math.round(t.clientWidth*this.scale),s=Math.round(t.clientHeight*this.scale),r=e.clientWidth,l=e.clientHeight,a=n.left;i.left===i.right?a=Math.max(0,(r-o)/2):i.left&&(a=r-o-n.right);var c=n.top;i.top===i.bottom?c=Math.max(0,(l-s)/2):i.top&&(c=l-s-n.bottom),ve(t,Math.round(a),Math.round(c))}},{key:"_doZoom",value:function(e,t,n,i){!function(e,t){if(e.__scale===t)return;e.__scale=t;var n=e.style;n.transform=n.OTransform=n.msTransform=n.MozTransform=n.WebkitTransform="scale("+t+")"}(this._viewport,e),n=n/t||0,i=i/t||0,this._scroller.scrollLeft+=Math.round(n*(e-t)),this._scroller.scrollTop+=Math.round(i*(e-t)),this.invalidate()}},{key:"_dispatchChangeEvent",value:function(e,t,n){this.dispatchEvent(new CustomEvent(e+"-change",{bubbles:!1,cancelable:!1,detail:{property:e,newValue:t,oldValue:n}}))}},{key:"_validateEvent",value:function(t){return![HTMLInputElement,HTMLTextAreaElement].find(function(e){return t.target instanceof e})}},{key:"_onScroll",value:function(e){this.invalidate(),this.dispatchEvent(new CustomEvent("scroll-change",{bubbles:!1,cancelable:!1,detail:{scrollTop:this.scrollTop,scrollLeft:this.scrollLeft,trigger:e}}))}},{key:"_onMouseWheel",value:function(e){if(!e.defaultPrevented&&e.ctrlKey&&this.enableZoom){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t/=Math.abs(t);var n=this.scale,i=At(this.scale+.1*t,this.minScale,this.maxScale);if(this._internalSetScale(i)){var o=this._viewport.getBoundingClientRect(),s=e.clientX-o.left,r=e.clientY-o.top;this._doZoom(i,n,s,r)}}}},{key:"_onDragHandler",value:function(e){if(this.isPanning){var t=e.detail.trigger;switch(e.type){case"drag-start":case"drag-move":var n=new Nt(t.clientX,t.clientY);if(this._oldPanningPoint){var i=n.subtract(this._oldPanningPoint);0!==i.length&&(this.scrollLeft-=i.x,this.scrollTop-=i.y)}this._oldPanningPoint=n;break;case"drag-end":delete this._oldPanningPoint}}}},{key:"_onKeyDown",value:function(e){this._validateEvent(e)&&(!this.enablePan||!0!==this.panOnKey&&e.keyCode!==this.panOnKey||(this.root.setAttribute("panning",!0),this._isPanning=!0,e.preventDefault()))}},{key:"_onKeyUp",value:function(e){this._validateEvent(e)&&(!this.enablePan||!0!==this.panOnKey&&e.keyCode!==this.panOnKey||(this.root.removeAttribute("panning"),this._isPanning=!1,e.preventDefault()))}},{key:"content",get:function(){return this._content}},{key:"scrollLeft",get:function(){return Math.round(this._scroller.scrollLeft)},set:function(e){this.scrollLeft!==e&&(this._scroller.scrollLeft=e)}},{key:"scrollTop",get:function(){return Math.round(this._scroller.scrollTop)},set:function(e){this.scrollTop!==e&&(this._scroller.scrollTop=e)}},{key:"minScale",get:function(){return this._minScale||.2},set:function(e){this.minScale!==e&&(this._minScale=e)}},{key:"maxScale",get:function(){return this._maxScale||4},set:function(e){this.maxScale!==e&&(this._maxScale=e)}},{key:"scale",get:function(){return this._scale},set:function(e){var t=this.scale;if(this._internalSetScale(e)){var n=this._viewport.getBoundingClientRect();this._doZoom(e,t,n.width/2,n.height/2)}}},{key:"hiddenScroll",get:function(){return this._hiddenScroll},set:function(e){this._hiddenScroll!==e&&(this._hiddenScroll=e,this._scroller.style.overflow=e?"hidden":"",this.invalidate())}},{key:"autoPage",get:function(){return this._autoPage},set:function(e){this.autoPage!==e&&(this._autoPage=e,this.invalidate())}},{key:"padding",get:function(){return this._padding},set:function(e){this.padding!==e&&(this._padding=e,this.invalidate())}},{key:"enablePan",get:function(){return this._enablePan},set:function(e){this._enablePan!==e&&(this._enablePan=e)}},{key:"enableZoom",get:function(){return this._enableZoom},set:function(e){this._enableZoom!==e&&(this._enableZoom=e)}},{key:"isPanning",get:function(){return this._isPanning}}]),r}(),PopupManager:gt,DragManager:zt,popup:function(e,t){return(new dt).open(e,t)}},util:h({},L,{paramsTo:ce,paramsFrom:function(e){var t=e.lastIndexOf("?"),o={};return 0<=t&&e.substring(t+1).split("&").forEach(function(e){var t=e.split("=");if(2<t.length)console.warn("Invalid query-string entry. ("+e+")");else{t.length<2&&(t=[e,!0]);var n=decodeURIComponent(t[0]),i=decodeURIComponent(t[1]);void 0!==o[n]?Array.isArray(o[n])?o[n].push(i):o[n]=[o[n],i]:o[n]=i}}),o}}),dom:{build:pe}}),Rt});
