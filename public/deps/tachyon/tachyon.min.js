!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).tachyon=t()}(this,function(){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i=p(r);if(s){var o=p(this).constructor;e=Reflect.construct(i,arguments,o)}else e=i.apply(this,arguments);return t=this,!(n=e)||"object"!=typeof n&&"function"!=typeof n?v(t):n}}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=l(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function u(e,t,n,i){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var o,r=l(e,t);if(r){if((o=Object.getOwnPropertyDescriptor(r,t)).set)return o.set.call(i,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(i,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(i,t,o)}else s(i,t,n);return!0})(e,t,n,i)}function m(){var n=arguments,i=arguments.length<=0?void 0:arguments[0],e=arguments.length,o=!0;"boolean"==typeof(e-1<0||arguments.length<=e-1?void 0:arguments[e-1])&&(o=e-1<0||arguments.length<=e-1?void 0:arguments[e-1],e-=1);for(var t=function(e){var t=e<0||n.length<=e?void 0:n[e];Object.getOwnPropertyNames(t).forEach(function(e){!o&&i.hasOwnProperty(e)||Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))})},r=1;r<e;r++)t(r);return i}function _(e,t){if(t in e){for(var n=arguments.length,i=new Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e[t].apply(e,i)}}function y(e){if(e instanceof Function){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(null,n)}return e}function L(e,t,n){return isNaN(t)||(e=Math.max(e,t)),isNaN(n)||(e=Math.min(e,n)),e}var r=e(function(e){return e&&(-1!==e.indexOf(".")&&e.split(".")||[e])});function k(e){if(Array.isArray(e));else{var t=a(e);switch(t){case"number":e+="";case"string":e=r(e);break;default:throw new TypeError("path must be a Number/String/Array, received ".concat(t," instead."))}}return e}function w(e,t){for(var n=(t=k(t))&&t.length||0,i=e,o=0;o<n;o++){var r=t[o];if(!(r in i))return null;i=i[r]}return i}function x(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"children",n=[],i=e[t],o=Array.isArray(i)&&i.length||0;if(0<o)for(var r=0;r<o;r++)n=n.concat(x(i[r],t));else n.push(e);return n}function e(n){var i={};return function(e){var t=i[e];return void 0===t&&(i[e]=t=n(e)),t}}var b,E=(b=new WeakMap,function(e,t){var n=b.get(e);n&&(window.cancelAnimationFrame(n),b.delete(e)),n=window.requestAnimationFrame(function(){e.apply(null,t),b.delete(e)}),b.set(e,n)}),I=function(){function n(e,t){h(this,n),this.setValues(e,t)}return c(n,null,[{key:"distance",value:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}}]),c(n,[{key:"setValues",value:function(e,t){return this.x=e||0,this.y=t||0,this}},{key:"clone",value:function(){return new n(this.x,this.y)}},{key:"toString",value:function(){return"[Point (x="+this.x+" y="+this.y+")]"}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}]),n}(),R=function(){function r(e,t,n,i){h(this,r),this.setValues(e,t,n,i)}return c(r,[{key:"setValues",value:function(e,t,n,i){return this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0,this}},{key:"equals",value:function(e){return e&&e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}},{key:"extend",value:function(e,t,n,i){return i=i||0,e+(n=n||0)>this.x+this.width&&(this.width=e+n-this.x),t+i>this.y+this.height&&(this.height=t+i-this.y),e<this.x&&(this.width+=this.x-e,this.x=e),t<this.y&&(this.height+=this.y-t,this.y=t),this}},{key:"contains",value:function(e,t,n,i){return n=n||0,i=i||0,e>=this.x&&e+n<=this.x+this.width&&t>=this.y&&t+i<=this.y+this.height}},{key:"containsRect",value:function(e){return!!e&&this.contains(e.x,e.y,e.width,e.height)}},{key:"union",value:function(e){return this.clone().extend(e.x,e.y,e.width,e.height)}},{key:"intersection",value:function(e){var t=e.x,n=e.y,i=t+e.width,o=n+e.height;return this.x>t&&(t=this.x),this.y>n&&(n=this.y),this.x+this.width<i&&(i=this.x+this.width),this.y+this.height<o&&(o=this.y+this.height),i<=t||o<=n?null:new r(t,n,i-t,o-n)}},{key:"intersects",value:function(e){return e.x<=this.x+this.width&&this.x<=e.x+e.width&&e.y<=this.y+this.height&&this.y<=e.y+e.height}},{key:"setEmpty",value:function(){this.setValues(0,0,0,0)}},{key:"isEmpty",value:function(){return this.width<=0||this.height<=0}},{key:"clone",value:function(){return new r(this.x,this.y,this.width,this.height)}},{key:"toString",value:function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"}},{key:"left",get:function(){return this.x},set:function(e){this.width-=e-this.x,this.x=e}},{key:"right",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"top",get:function(){return this.y},set:function(e){this.height-=e-this.y,this.y=e}},{key:"bottom",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}}]),r}(),S=function(e){f(l,R);var s=g(l);function l(e,t,n,i,o){var r;return h(this,l),null==n&&(n=e),null==i&&(i=t),(r=s.call(this)).rowIndex=Math.min(e,n),r.columnIndex=Math.min(t,i),r.endRowIndex=Math.max(e,n),r.endColumnIndex=Math.max(t,i),r.isCrossed=!0===o,r}return c(l,[{key:"clone",value:function(){return new l(this.rowIndex,this.columnIndex,this.endRowIndex,this.endColumnIndex)}},{key:"toPosition",value:function(){return[this.rowIndex,this.columnIndex,this.endRowIndex,this.endColumnIndex].join(",")}},{key:"valueOf",value:function(){return{rowIndex:this.rowIndex,columnIndex:this.columnIndex,endRowIndex:this.endRowIndex,endColumnIndex:this.endColumnIndex,rowCount:this.rowCount,columnCount:this.columnCount,isCrossed:this.isCrossed}}},{key:"toJSON",value:function(){var n=this;return["rowIndex","columnIndex","endRowIndex","endColumnIndex","isCrossed"].reduce(function(e,t){return e[t]=n[t],e},{})}},{key:"toString",value:function(){return"[CellPosition (rowIndex="+this.rowIndex+" columnIndex="+this.columnIndex+" endRowIndex="+this.endRowIndex+" endColumnIndex="+this.endColumnIndex+")]"}},{key:"rowIndex",get:function(){return this.top},set:function(e){this.top=e,this.endRowIndex<e&&(this.endRowIndex=e)}},{key:"endRowIndex",get:function(){return this.bottom},set:function(e){this.bottom=e}},{key:"columnIndex",get:function(){return this.left},set:function(e){this.left=e,this.endColumnIndex<e&&(this.endColumnIndex=e)}},{key:"endColumnIndex",get:function(){return this.right},set:function(e){this.right=e}},{key:"rowCount",get:function(){return this.height+1}},{key:"columnCount",get:function(){return this.width+1}},{key:"isMerged",get:function(){return 1<this.rowCount||1<this.columnCount}}],[{key:"create",value:function(e){return new l(e.rowIndex,e.columnIndex,e.endRowIndex,e.endColumnIndex)}}]),l}(),M=new WeakMap,D=new WeakMap;function N(e){var t=M.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function t(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function P(e,t){M.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n=Object.keys(t),i=0;i<n.length;++i){var o=n[i];o in this||Object.defineProperty(this,o,O(o))}}function O(t){return{get:function(){return N(this).event[t]},set:function(e){N(this).event[t]=e},configurable:!0,enumerable:!0}}function G(t){return{value:function(){var e=N(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function H(e){if(null==e||e===Object.prototype)return P;var t=D.get(e);return null==t&&(t=function(n,e){var t=Object.keys(e);if(0===t.length)return n;function i(e,t){n.call(this,e,t)}i.prototype=Object.create(n.prototype,{constructor:{value:i,configurable:!0,writable:!0}});for(var o=0;o<t.length;++o){var r=t[o];if(!(r in n.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(e,r).value;Object.defineProperty(i.prototype,r,s?G(r):O(r))}}return i}(H(Object.getPrototypeOf(e)),e),D.set(e,t)),t}function T(e,t){N(e).passiveListener=t}P.prototype={get type(){return N(this).event.type},get target(){return N(this).eventTarget},get currentTarget(){return N(this).currentTarget},composedPath:function(){var e=N(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return N(this).eventPhase},stopPropagation:function(){var e=N(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=N(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(N(this).event.bubbles)},get cancelable(){return Boolean(N(this).event.cancelable)},preventDefault:function(){t(N(this))},get defaultPrevented(){return N(this).canceled},get composed(){return Boolean(N(this).event.composed)},get timeStamp(){return N(this).timeStamp},get srcElement(){return N(this).eventTarget},get cancelBubble(){return N(this).stopped},set cancelBubble(e){if(e){var t=N(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!N(this).canceled},set returnValue(e){e||t(N(this))},initEvent:function(){}},Object.defineProperty(P.prototype,"constructor",{value:P,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(P.prototype,window.Event.prototype),D.set(window.Event.prototype,P));var z=new WeakMap,A=3;function F(e){return null!==e&&"object"===a(e)}function V(e){var t=z.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function B(e,t){var r;Object.defineProperty(e,"on".concat(t),(r=t,{get:function(){for(var e=V(this).get(r);null!=e;){if(e.listenerType===A)return e.listener;e=e.next}return null},set:function(e){"function"==typeof e||F(e)||(e=null);for(var t=V(this),n=null,i=t.get(r);null!=i;)i.listenerType===A?null!==n?n.next=i.next:null!==i.next?t.set(r,i.next):t.delete(r):n=i,i=i.next;if(null!==e){var o={listener:e,listenerType:A,passive:!1,once:!1,next:null};null===n?t.set(r,o):n.next=o}},configurable:!0,enumerable:!0}))}function W(e){function t(){U.call(this)}t.prototype=Object.create(U.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)B(t.prototype,e[n]);return t}function U(){if(!(this instanceof U)){if(1===arguments.length&&Array.isArray(arguments[0]))return W(arguments[0]);if(0<arguments.length){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return W(e)}throw new TypeError("Cannot call a class as a function")}z.set(this,new Map)}U.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!F(t))throw new TypeError("'listener' should be a function or an object.");var i=V(this),o=F(n),r=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:t,listenerType:r,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null},l=i.get(e);if(void 0!==l){for(var a=null;null!=l;){if(l.listener===t&&l.listenerType===r)return;l=(a=l).next}a.next=s}else i.set(e,s)}},removeEventListener:function(e,t,n){if(null!=t)for(var i=V(this),o=(F(n)?Boolean(n.capture):Boolean(n))?1:2,r=null,s=i.get(e);null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==r?r.next=s.next:null!==s.next?i.set(e,s.next):i.delete(e));s=(r=s).next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=V(this),n=e.type,i=t.get(n);if(null==i)return!0;for(var o,r,s,l,a=(o=this,r=e,new(H(Object.getPrototypeOf(r)))(o,r)),u=null;null!=i;){if(i.once?null!==u?u.next=i.next:null!==i.next?t.set(n,i.next):t.delete(n):u=i,T(a,i.passive?i.listener:null),"function"==typeof i.listener)try{i.listener.call(this,a)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else i.listenerType!==A&&"function"==typeof i.listener.handleEvent&&i.listener.handleEvent(a);if(N(a).immediateStopped)break;i=i.next}return T(a,null),s=0,N(a).eventPhase=s,l=null,N(a).currentTarget=l,!a.defaultPrevented}},Object.defineProperty(U.prototype,"constructor",{value:U,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(U.prototype,window.EventTarget.prototype);var j={_styles:{},get defaultStyles(){return{}},get styleParent(){return null},get _nonInheritingStyleNames(){return[]},get styles(){return this._styles},set styles(e){this.addStyles(e||{})},getStyle:function(){for(var n=this,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 1<t.length?t.reduce(function(e,t){return e[t]=n._internalGetStyle(t),e},{}):this._internalGetStyle(t[0])},addStyle:function(e,t){this._styles[e]=t,this._notifyStyleChanged()},removeStyle:function(e){delete this._styles[e],this._notifyStyleChanged()},clearStyles:function(){this._styles={},this._notifyStyleChanged()},addStyles:function(e){this._styles=m({},this._styles,e),this._notifyStyleChanged()},_internalGetStyle:function(e){var t=this.styles,n=this.defaultStyles,i=this._nonInheritingStyleNames,o=t[e];return!o&&n&&(o=n[e]),this.styleParent&&!o&&(!i||i.indexOf(e)<0)&&(o=this.styleParent.getStyle(e)),o},_styleChanged:function(){},_notifyStyleChanged:function(){this._boundStyleChanged||(this._boundStyleChanged=this._styleChanged.bind(this)),E(this._boundStyleChanged)}},K={DISPLAY_UPDATE:2,ITEMS_CHANGE:4,COLUMNS_CHANGE:8,VISIBLE_COLUMNS_CHANGE:16,ITEM_UPDATE:32,COLUMN_UPDATE:64,COLUMN_VISIBLE:128,VERTICAL_SCROLL_CHANGE:256,HORIZONTAL_SCROLL_CHANGE:512,SELECTION_CHANGE:1024,CARET_CHANGE:2048,RENDERER_CHANGE:4096,STYLES_CHANGE:8192,ROW_HEIGHT_CHANGE:16384,GROUP_SIZE_CHANGE:32768,ALL:4294967295},X=function(){function t(e){h(this,t),this.options=e}return c(t,[{key:"format",value:function(e){}},{key:"type",get:function(){return this.options.type}},{key:"pattern",get:function(){return this.options.pattern}},{key:"source",get:function(){return this.options.source}}]),t}();var Y={};function q(e){return Y[e]}function Z(e){if(e&&"type"in e&&"pattern"in e){var t=q(e.type);if(t)return new t(e);console.warn("Formatter not defined.",e)}return null}var J=Object.freeze({__proto__:null,get:q,add:function(e,t){return Y[e]=(n=t,m((i=function(e){f(n,X);var t=g(n);function n(e){return h(this,n),t.call(this,e)}return n}()).prototype,n,!1),i);var n,i},remove:function(e){e in Y&&delete Y[e]},createFormatter:Z});var Q=function(e){f(o,U);var i=g(o);function o(e,t){var n;return h(this,o),(n=i.call(this)).index=-1,n._open=!0,n._width=void 0,n._visible=!0,n._minWidth=30,n._children=[],n._level=0,n._depth=0,n._formatter=null,n._itemRenderer=null,n._itemEditor=null,n._headerRenderer=null,n.editable=!0,n.editOnEvents=null,n.draggable=!0,n.resizable=!0,n.wordWrap=!1,n.labelFunction=null,n.sortable=!0,n.sortDescending=!1,n.sortCompare=null,n.isSortOriginal=!1,n.isRowMerge=!1,n.isColumnMerge=!1,n.mergeDependColumns=null,n.height=void 0,n.dataField=e||"",n.headerText=t,n}return c(o,[{key:"setGrid",value:function(e){this._grid!==e&&(this._grid=e,this.dispatchEvent(new CustomEvent("grid-change",{bubbles:!1,cancelable:!1,detail:{grid:e}})))}},{key:"setWidth",value:function(e){isNaN(e)||(e=L(e,this.minWidth)),this._width=e}},{key:"setVisible",value:function(e){this._visible=e}},{key:"itemToLabel",value:function(e){if(this.labelFunction instanceof Function)return this.labelFunction(e,this);var t=this.itemToValue(e);return this._formatter&&(t=this._formatter.format(t)),t}},{key:"itemToValue",value:function(e){try{return w(e,this.dataFieldPath)}catch(e){console.error(e)}return null}},{key:"invalidate",value:function(){this._grid&&this._grid.invalidate(K.COLUMN_UPDATE)}},{key:"updateChildren",value:function(){!function e(t,n){n._level=t&&t.level+1||0;for(var i=0,o=n.children||[],r=o.length,s=0;s<r;s++){var l=o[s];e(l._parent=n,l),i=Math.max(l.depth+1,i)}n._depth=i}(this.parent,this)}},{key:"_styleChanged",value:function(){}},{key:"toJSON",value:function(){var n=this;return["minWidth","width","offsetWidth","dataField","headerText","children","visible","open","format"].reduce(function(e,t){return e[t]="children"===t?n.children.map(function(e){return e.toJSON()}):n[t],e},{})}},{key:"grid",get:function(){return this._grid}},{key:"dataField",get:function(){return this._dataField},set:function(e){e=null==e?"":""+e,this._dataField!==e&&(this._dataField=e,this._dataFieldPath=k(e),this.invalidate())}},{key:"dataFieldPath",get:function(){return this._dataFieldPath||[]}},{key:"headerText",get:function(){return this._headerText||this.dataField},set:function(e){this._headerText!==e&&(this._headerText=e,this.invalidate())}},{key:"offsetWidth",get:function(){return this.grid?this.grid.getColumnWidth(this.index):this.width}},{key:"width",get:function(){return this._width},set:function(e){isNaN(e)||(e=L(e,this.minWidth)),this._width!==e&&(this.grid?this.grid.setColumnWidth(this.index,e):this.setWidth(e))}},{key:"minWidth",get:function(){return this._minWidth},set:function(e){this._minWidth!==e&&(this._minWidth=e,this.invalidate())}},{key:"visible",get:function(){for(var e=this.parent;e;){if(!e.visible)return!1;e=e.parent}return this._visible},set:function(e){this._visible!==e&&(this.grid?this.grid.setColumnVisible(this,e):this.setVisible(e))}},{key:"itemRenderer",get:function(){return this._itemRenderer},set:function(e){this._itemRenderer!==e&&(this._itemRenderer=e,this.grid&&this.grid.clearItemRenderers())}},{key:"headerRenderer",get:function(){return this._headerRenderer},set:function(e){this._headerRenderer!==e&&(this._headerRenderer=e,this.grid&&this.grid.clearHeaderRenderers())}},{key:"itemEditor",get:function(){return this._itemEditor},set:function(e){this._itemEditor!==e&&(this._itemEditor=e)}},{key:"open",get:function(){return this._open},set:function(e){this._open!==e&&(this._open=e,this.invalidate())}},{key:"level",get:function(){return this._level}},{key:"depth",get:function(){return this._depth}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children},set:function(e){this._children!==e&&(this._children=e)}},{key:"isLeaf",get:function(){return!this.children||this.children.length<=0}},{key:"format",get:function(){return this._format},set:function(e){this._format!==e&&(this._format=e,this._formatter=Z(e),this.invalidate())}},{key:"filterInstance",get:function(){return this.grid&&this.grid.filterManager.getFilter(this)}},{key:"filter",get:function(){return this._filter},set:function(e){this._filter!==e&&(this._filter=e,this.invalidate())}},{key:"styleParent",get:function(){return this.grid}},{key:"_nonInheritingStyleNames",get:function(){return["backgroundColor"]}}],[{key:"create",value:function(e){var t=new this;for(var n in e){var i=e[n];"styles"===n?t.addStyles(i):n in t&&("children"===n&&Array.isArray(i)&&(i=i.map(function(e){return e instanceof o?e:o.create(e)})),t[n]=i)}return t}}]),o}();m(Q.prototype,j,!1);var $=function(e){f(i,Q);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this)).hostColumn=e,t.draggable=!1,t.sortable=!1,t.editable=!1,t.open=!1,t}return c(i,[{key:"itemToLabel",value:function(e){return this.hostColumn.children.indexOf(this)<this.grid.collection.getNodeLevel(e)?null:C(p(i.prototype),"itemToLabel",this).call(this,e)}},{key:"boxMode",get:function(){return this.hostColumn.boxMode}},{key:"indent",get:function(){return this.hostColumn.indent}},{key:"itemRenderer",get:function(){return this.hostColumn.itemRenderer}},{key:"dataField",get:function(){return this.hostColumn.dataField},set:function(e){}},{key:"dataFieldPath",get:function(){return this.hostColumn.dataFieldPath}},{key:"headerText",get:function(){return""+(this.hostColumn.children.indexOf(this)+1)},set:function(e){}}]),i}(),ee=function(e){f(o,Q);var i=g(o);function o(e,t){var n;return h(this,o),(n=i.call(this,e,t))._indent=20,n._boxMode=!1,n}return c(o,[{key:"toJSON",value:function(){var n=this;return["minWidth","width","dataField","headerText","children","visible","boxMode","indent","open"].reduce(function(e,t){return"children"===t?e[t]=n.children.map(function(e){return e.toJSON()}):(e[t]=n[t],"width"===t&&e[t]),e},{})}},{key:"indent",get:function(){return this._indent},set:function(e){this._indent!==e&&(this._indent=e,this.invalidate())}},{key:"boxMode",get:function(){return this._boxMode},set:function(e){this._boxMode!==e&&(this._boxMode=e)}}]),o}();function te(e,t){var o=0;return function e(t,n){if(t){n(t,o++);for(var i=t.firstChild;i;)e(i,n),i=i.nextSibling}}(e,t),o}var ne=function(){function e(){var t=this;h(this,e),function(s){var e=s.constructor.__template__,l=s.constructor.__annotations__;if(e){var t=document.importNode(e,!0),n=t&&t.querySelector("*")||null,a={};te(t,function(o,e){var t=l[e],n=t&&t.id,i=t&&t.events;if(n&&(a[n]=o,a[n].removeAttribute("id")),i){var r={};i.forEach(function(e){var t=e.name,n=e.value;if(s[n]instanceof Function){var i=r[n];i||(i=r[n]=s[n].bind(s)),o.addEventListener(t,i)}else console.warn(o.localName+":"+t,"listener method `"+e.value+"` not defined",o)})}}),s.DOM=a,s.root=n,s.root.__instance__=s}}(this),(this.constructor.__behaviors__||[]).forEach(function(e){e.constructor instanceof Function&&e.constructor.call(t)})}return c(e,null,[{key:"withDom",value:function(e){if(e){var t=(i=e,"undefined"==typeof HTMLTemplateElement?((r=document.createElement("div")).innerHTML=i,(o=document.createDocumentFragment()).appendChild(r.firstChild)):((r=document.createElement("template")).innerHTML=i,o=r.content),o),n=(s=[],te(t,function(i,e){if(i.attributes){var t=Array.prototype.slice.call(i.attributes),o=null,r=[];t.forEach(function(e){var t=e.name,n=e.value;"id"===t&&n?o=n:"on-"===t.slice(0,3)&&n&&(i.removeAttribute(t),r.push({name:t.slice(3),value:n}))}),(o||0<r.length)&&(s[e]={id:o,events:r})}}),s);m(this,{get __template__(){return t},get __annotations__(){return n}})}var s,i,o,r;return this}},{key:"withBehavior",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];m.apply(null,[this.prototype].concat(t,[!1]));var i=this.__behaviors__||[];return m(this,{get __behaviors__(){return i.concat(t)}}),this}}]),c(e,[{key:"htmlElement",get:function(){return this.root}}]),e}();function ie(e,t,n){if(e.__x===t&&e.__y===n)return!1;e.__x=t,e.__y=n;var i=e.style;return i.left=t+"px",i.top=n+"px",!0}function oe(e,t,n){if(e.__width===t&&e.__height===n)return!1;e.__width=t,e.__height=n;var i=e.style;return i.width="number"==typeof t?t+"px":t,i.height="number"==typeof n?n+"px":n,!0}function re(e,t,n,i,o){var r=oe(e,i,o);return ie(e,t,n)||r}function se(e,t,n){if(e.__x!==t||e.__y!==n){var i=e.style;i.transform=i.webkitTransform="translate("+t+"px,"+n+"px)",e.__x=t,e.__y=n}}function le(e,t){var n=e.classList;return!(!n||n.contains(t))&&(n.add(t),!0)}function ae(e,t){var n=e.classList;return!(!n||!n.contains(t))&&(n.remove(t),!0)}var ue=function(e){f(r,ne);var t=g(r);function r(){return h(this,r),t.call(this)}return c(r,[{key:"appendChild",value:function(e){return e instanceof r&&(e=e.htmlElement),this.childContainer.appendChild(e)}},{key:"removeChild",value:function(e){return e instanceof r&&(e=e.htmlElement),this.childContainer.removeChild(e)}},{key:"setChildIndex",value:function(e,t){e instanceof r&&(e=e.htmlElement);var n=this.childContainer,i=n.children,o=Array.prototype.indexOf.call(i,e);return t!==o&&(o<t&&(t+=1),n.insertBefore(e,i[t]),!0)}},{key:"setPosition",value:function(e,t){return ie(this.childContainer,e,t)}},{key:"setSize",value:function(e,t){return oe(this.childContainer,e,t)}},{key:"setLayout",value:function(e,t,n,i){var o=this.setPosition(e,t),r=this.setSize(n,i);return o||r}},{key:"addEventListener",value:function(e,t,n){this.htmlElement.addEventListener.apply(this.htmlElement,arguments)}},{key:"removeEventListener",value:function(e,t,n){this.htmlElement.removeEventListener.apply(this.htmlElement,arguments)}},{key:"dispatchEvent",value:function(e){return this.htmlElement.dispatchEvent.apply(this.htmlElement,arguments)}},{key:"childContainer",get:function(){return this.htmlElement}},{key:"style",get:function(){return this.htmlElement.style}},{key:"clientWidth",get:function(){return this.htmlElement.clientWidth}},{key:"clientHeight",get:function(){return this.htmlElement.clientHeight}},{key:"childElementCount",get:function(){return this.childContainer.childElementCount}}]),r}(),he=function(e){f(i,U);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this))._target=e,t._init(),t}return c(i,[{key:"start",value:function(e){var t=this;isNaN(e)&&(e=250),this._intervalId||(this._intervalId=setInterval(function(){t._doCheck()&&t.dispatchEvent(new CustomEvent("size-change",{bubbles:!1,cancelable:!1,detail:{element:t._target,width:t._width,height:t._height}}))},e))}},{key:"stop",value:function(){this._intervalId&&(clearInterval(this._intervalId),this._init())}},{key:"_init",value:function(){this._intervalId=null,this._width=-1,this._height=-1}},{key:"_doCheck",value:function(){var e,t;return t=this._isVisible()?(e=this._getTargetWidth(),this._getTargetHeight()):e=0,(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,0<e&&0<t)}},{key:"_getTargetWidth",value:function(){return this._target.offsetWidth}},{key:"_getTargetHeight",value:function(){return this._target.offsetHeight}},{key:"_isVisible",value:function(){return null!==this._target.offsetParent}}]),i}(),ce={styles:{backgroundColor:"#FFFFFF",font:"14px Arial",color:"RGB(73,105,131)",textAlign:"left",verticalAlign:"center",rowHeight:30,headerRowHeight:30,cellSelectionColor:"RGB(183,210,222)",cellOverColor:"RGBA(215,237,247,0.5)",textSelectionColor:"RGB(73,105,131)",textOverColor:"RGB(73,105,131)",rowColors:["#F2F5F8"],cellPadding:{left:3,right:3,top:2,bottom:2},rowLine:{width:1,color:"#B3B4B6",dashed:[]},columnLine:{width:1,color:"#B3B4B6",dashed:[]},frozenLine:{width:1,color:"#000000",dashed:[]},caretLine:{width:2,color:"RGB(52,102,124)",dashed:[]},headerRowLine:{width:1,color:"RGBA(72,84,101, 0.7)",dashed:[]},headerColumnLine:{width:1,color:"RGBA(72,84,101, 0.7)",dashed:[]}},cacheMode:"hidden",editOnKeys:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"Â£$%^&*()_+-=[];'#,./|<>?:@~{} ",itemRenderer:null,headerRenderer:null,itemEditor:null,treeItemRenderer:null,groupingItemRenderer:null};function de(e,t){return isNaN(e)&&isNaN(t)?0:isNaN(e)?1:isNaN(t)?-1:e<t?-1:t<e?1:0}function fe(e,t,n){return null==e&&null==t?0:null==e?1:null==t?-1:(n&&(e=e.toLowerCase(),t=t.toLowerCase()),e<t?-1:t<e?1:0)}function ve(){var e=document.createElement("textarea"),t=e.style;return e.onkeydown=function(e){e.preventDefault()},t.position="absolute",t.left=t.top="-9999px",t.opacity="0",e}var ge,me=function(){function s(e){return e}function l(e){return"string"==typeof e?e.toLowerCase():e}function r(e,t){var n="function"==typeof this&&!this.firstBy&&this,i=function(n,e){if(e="object"===a(e)?e:{direction:e},"function"!=typeof n){var t=n;n=function(e){return e[t]?e[t]:""}}if(1===n.length){var i=n,o=e.ignoreCase?l:s,r=e.cmp||function(e,t){return e<t?-1:t<e?1:0};n=function(e,t){return r(o(i(e)),o(i(t)))}}return e.direction in{"-1":"",desc:""}?function(e,t){return-n(e,t)}:n}(e,t),o=n?function(e,t){return n(e,t)||i(e,t)}:i;return o.thenBy=r,o}return r.firstBy=r}(),_e=function(){function e(){h(this,e),this.count=0,2<=arguments.length?(this.startCallback=arguments[0],this.endCallback=arguments[1]):1===arguments.length&&(this.endCallback=arguments[0])}return c(e,[{key:"start",value:function(){var e=null;return this.count<=0&&this.startCallback&&(e=this.startCallback.apply(null,arguments)),this.count++,e}},{key:"end",value:function(){var e=null;return this.count--,this.count<=0&&this.endCallback&&(e=this.endCallback.apply(null,arguments),this.count=0),e}},{key:"cancel",value:function(){this.count--}},{key:"counting",get:function(){return 0<this.count}}]),e}(),ye=(ge=["push","pop","shift","unshift","splice","sort","reverse"],function(e,s){ge.forEach(function(o){var r=e[o];e[o]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=r.apply(this,t);return s(o,t,i),i},e[o].__original=r})}),pe=function(e){f(i,U);var n=g(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return h(this,i),(e=n.call(this)).collectionEventCounter=new _e(e.dispatchCollectionEvent.bind(v(e))),e._source=null,e._active=null,e._sortFunction=null,e._filterFunction=null,e._isObserveSource=t,e}return c(i,[{key:"get",value:function(e){return 0<=e&&e<this.length?this.localItems[e]:null}},{key:"indexOf",value:function(e,t){return this.localItems.indexOf(e,t)}},{key:"lastIndexOf",value:function(e,t){return this.localItems.lastIndexOf(e,t)}},{key:"contains",value:function(e){return 0<=this.indexOf(e)}},{key:"containsAll",value:function(e){var t=e&&e.length||0;if(t<=0)return!1;for(var n=0;n<t;n++)if(!this.contains(e[n]))return!1;return!0}},{key:"setValue",value:function(e,t,n){return this._internalSetValue(this.get(e),t,n)}},{key:"setItemValue",value:function(e,t,n){return this._internalSetValue(e,t,n)}},{key:"sort",value:function(e){var t=e&&e.length||0;if(0<t){for(var n=e[0],i=me(n.sortFunction,n.descending?0:-1),o=1;o<t;o++)n=e[o],i=i.thenBy(n.sortFunction,n.descending?0:-1);this._sortFunction=i}else this._sortFunction=null}},{key:"forEach",value:function(e){}},{key:"refresh",value:function(){this.collectionEventCounter.start(),this._internalRefresh(),this.collectionEventCounter.end("refresh")}},{key:"clear",value:function(){this.source=[]}},{key:"toArray",value:function(){return this.localItems.slice(0)}},{key:"subList",value:function(e,t){var n=this.localItems.slice(e,t);return new this.constructor(n)}},{key:"_reset",value:function(){this.collectionEventCounter.start(),this._internalRefresh(),this.collectionEventCounter.end("reset")}},{key:"_internalSetValue",value:function(e,t,n){if(e&&null!=t){var i=w(e,t);if(n!==i)return this.collectionEventCounter.start(),function(e,t,n){for(var i=(t=k(t))&&t.length||0,o=e,r=0;r<i-1;r++){var s=t[r];if(!(s in o)){o=null;break}o=o[s]}!!(o&&0<i&&o[t[r]]!==n)&&(o[t[r]]=n)}(e,t,n),this.collectionEventCounter.end("update",{source:e,index:this.indexOf(e),property:t,newValue:n,oldValue:i}),!0}return!1}},{key:"_internalRefresh",value:function(){}},{key:"dispatchCollectionEvent",value:function(e,t,n,i){var o=t&&!Array.isArray(t)&&[t]||t,r={collection:this,kind:e};return null!=o&&(r.items=o),null!=n&&(r.index=n),null!=i&&(r.oldIndex=i),this.dispatchEvent(new CustomEvent("collection-change",{bubbles:!1,cancelable:!1,detail:r}))}},{key:"source",get:function(){return this._source},set:function(o){var r=this;if(this._source!==o&&(this._source=o,this._reset(),this._isObserveSource&&Array.isArray(o))){var s=this.dispatchCollectionEvent.bind(this);ye(o,function(e,t,n){if(!r.collectionEventCounter.counting)switch(e){case"push":s("add",t,o.length-t.length);break;case"unshift":s("add",t,0);break;case"pop":s("remove",n,o.length);break;case"shift":s("remove",n,0);break;case"splice":0<t[1]&&s("remove",n,t[0]);var i=t.slice(2);0<i.length&&s("add",i,t[0]);break;case"sort":case"reverse":r.refresh()}})}}},{key:"length",get:function(){return this._active&&this._active.length||0}},{key:"isEmpty",get:function(){return 0===this.length}},{key:"filterFunction",get:function(){return this._filterFunction},set:function(e){this._filterFunction!==e&&(this._filterFunction=e,this.refresh())}},{key:"sortFunction",get:function(){return this._sortFunction}},{key:"localItems",get:function(){return this._active||[]}}]),i}(),Ce=function(e){f(i,pe);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this,!0)).source=e||[],t}return c(i,[{key:"forEach",value:function(i){(this.source||[]).forEach(function(e,t,n){i(e,t,n)})}},{key:"add",value:function(e){return this.addAt(this.length,e)}},{key:"addAt",value:function(e,t){if(0<=e){if(e>=this.length&&(e=this.length),this.collectionEventCounter.start(),this.source!==this._active){var n=e,i=0;if(this.sortFunction?n=this.source.length:this.filterFunction&&(n=n>=this._active.length?this.source.length:this.source.indexOf(this._active[e])),this.source.splice(n,0,t),!this.filterFunction||this.filterFunction(t,e,this.source))if(this.sortFunction)i=this._findInsertIndex(this._active,t);else{for(var o=n-1;0<=o;){var r=this.source[o];if(this.filterFunction(r,o,this.source)&&0<=(i=this._active.indexOf(r))){i+=1;break}o--}i<0&&(i=0)}else i=-1;0<=i&&this._active.splice(i,0,t),e=i}else this._active.splice(e,0,t);return this.collectionEventCounter.end("add",t,e),!0}return!1}},{key:"addAll",value:function(e){this.addAllAt(this.length,e)}},{key:"addAllAt",value:function(e,t){var n=t&&t.length||0;if(0<n&&0<=e){this.collectionEventCounter.start();for(var i=0;i<n;i++)this.addAt(e+i,t[i]);this.collectionEventCounter.end("add",t,e)}}},{key:"remove",value:function(e){return this.removeAt(this.indexOf(e))===e}},{key:"removeAll",value:function(e){var t=this;this.collectionEventCounter.start(),e=e&&e.slice(0)||[];var n=[];e.forEach(function(e){t.remove(e)&&n.push(e)}),0<n.length?this.collectionEventCounter.end("remove",n,-1):this.collectionEventCounter.cancel()}},{key:"removeAt",value:function(e){var t=null;return 0<=e&&e<this.length&&(this.collectionEventCounter.start(),t=this._active.splice(e,1)[0],this.source!==this._active&&this.source.splice(this.source.indexOf(t),1),this.collectionEventCounter.end("remove",t,e)),t}},{key:"set",value:function(e,t){return 0<=e&&e<this.length&&(this.collectionEventCounter.start(),this.removeAt(e),this.addAt(e,t),this.collectionEventCounter.end("set",t,e),!0)}},{key:"move",value:function(e,t){if(e!==t&&0<=e&&e<this.length&&0<=t){this.collectionEventCounter.start();var n=this.removeAt(e);return this.addAt(t,n),this.collectionEventCounter.end("move",n,this.indexOf(n),e),!0}return!1}},{key:"_internalRefresh",value:function(){if(0<(this.source&&this.source.length||0)&&(this.sortFunction||this.filterFunction)){var e=this.source&&this.source.slice(0)||0;this.filterFunction&&(e=e.filter(this.filterFunction)),this.sortFunction&&(e=e.sort(this.sortFunction)),this._active=e}else this._active=this.source}},{key:"_findInsertIndex",value:function(e,t){for(var n=0,i=0,o=e.length-1,r=null,s=1;i<=o;)if(r=e[n=Math.round((i+o)/2)],(s=this.sortFunction(t,r))<=-1)o=n-1;else{if(!(1<=s))break;i=n+1}return 0<s?n+1:n}}]),i}(),ke=function(e){f(i,ue);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this))._scroller=t.DOM.scroller,t._viewport=t.DOM.viewport,t._contentContainer=t.DOM.contentContainer,t._boundDoLayout=t.doLayout.bind(v(t)),t._boundContentSizeChange=t._onContentSizeChange.bind(v(t)),t._boundScrollPositionChange=t._onScrollPositionChange.bind(v(t)),t._contentContainer.addEventListener("wheel",t._onWheel.bind(v(t))),t._scroller.addEventListener("scroll",t._onScroll.bind(v(t))),t._inOnScroll=!1,t.content=e,t}return c(i,[{key:"doLayout",value:function(e){this._inDoLayout=!0;var t=this._scroller,n=this._contentContainer,i=this._content;oe(n,t.clientWidth,t.clientHeight),i.doLayout(e),this._layoutViewport();var o=i.getViewMinHeight();0<o&&(t.style.minHeight=o+t.offsetHeight-t.clientHeight+"px"),oe(n,t.clientWidth,t.clientHeight)&&i.invalidateFor(K.GROUP_SIZE_CHANGE),this._inDoLayout=!1}},{key:"_layoutViewport",value:function(){var e=this._content;return oe(this._viewport,e.contentWidth,e.contentHeight)}},{key:"_scrollPositionChanged",value:function(){this._inOnScroll||(this._scroller.scrollTop=this.content.scrollTop,this._scroller.scrollLeft=this.content.scrollLeft)}},{key:"_onContentSizeChange",value:function(e){this._layoutViewport(),this._inDoLayout||E(this._boundDoLayout)}},{key:"_onScrollPositionChange",value:function(e){this._scrollPositionChanged()}},{key:"_onWheel",value:function(e){var t=this._scroller,n=this._content.getVerticalScrollPositionDelta(e.deltaY),i=L(t.scrollTop+n,0,this.maxScrollTop);if(t.scrollTop!==i)return t.scrollTop=i,e.preventDefault(),!1}},{key:"_onScroll",value:function(e){this._inOnScroll=!0;var t=this._scroller,n=this._content,i=t.scrollLeft,o=t.scrollTop,r=!1;n.scrollLeft!==i&&(n.scrollLeft=i,r=!0),n.scrollTop!==o&&(n.scrollTop=o,r=!0),r&&this.dispatchEvent(new CustomEvent("scroll",{detail:{scrollTop:o,scrollLeft:i,maxScrollTop:this.maxScrollTop,maxScrollLeft:this.maxScrollLeft,trigger:e}})),this._inOnScroll=!1}},{key:"childContainer",get:function(){return this._contentContainer}},{key:"maxScrollLeft",get:function(){return this._scroller.scrollWidth-this._scroller.clientWidth}},{key:"maxScrollTop",get:function(){return this._scroller.scrollHeight-this._scroller.clientHeight}},{key:"hasVerticalScroll",get:function(){return this._scroller.scrollHeight>this._scroller.clientHeight}},{key:"hasHorizontalScroll",get:function(){return this._scroller.scrollWidth>this._scroller.clientWidth}},{key:"content",get:function(){return this._content},set:function(e){this._content!==e&&(this.content&&(this.content.removeEventListener("content-size-change",this._boundContentSizeChange),this.content.removeEventListener("vertical-scroll-position-change",this._boundScrollPositionChange),this.content.removeEventListener("horizontal-scroll-position-change",this._boundScrollPositionChange),this.removeChild(e)),this._content=e,this.content&&(this.content.addEventListener("content-size-change",this._boundContentSizeChange),this.content.addEventListener("vertical-scroll-position-change",this._boundScrollPositionChange),this.content.addEventListener("horizontal-scroll-position-change",this._boundScrollPositionChange),this.appendChild(e)))}}]),i}().withDom('<div class="tachyon-scroller"><div id="scroller" class="tachyon-scroll-container"><div id="viewport" class="tachyon-scroll-viewport"></div></div><div id="contentContainer" class="tachyon-scroll-content"></div></div>'),we={left:0,right:0,top:0,bottom:0};function xe(e,t,n,i,o,r){e.beginPath();var s=y(r.dashed)||[],l=y(r.color)||0,a=y(r.width)||1;e.setLineDash(s),e.strokeStyle=l;var u=((e.lineWidth=a)||0)%2/2,h=t===i?u:0,c=n===o?u:0;e.translate(h,c),e.moveTo(t,n),e.lineTo(i,o),e.translate(-h,-c),e.stroke()}var be=e(function(e){var t=document.createElement("canvas"),n=t.getContext("2d");n.fillRect(0,0,t.width,t.height),n.textBaseline="top",n.fillStyle="white",n.font=e,n.fillText("gM",0,0);for(var i=n.getImageData(0,0,t.width,t.height).data,o=-1,r=-1,s=0;s<t.height;s++)for(var l=0;l<t.width;l++){if(0!==i[4*(s*t.width+l)]){-1===o&&(o=s);break}if(l===t.width-1&&-1!==o){r=s,s=t.height;break}}return r-o});function Ee(e,t){return!t||t.length<=0?0:e.measureText(t).width}function Ie(e,t,n,i,o,r,s,l,a){a=a||we;var u=Ee(e,t),h=be(e.font);return o-(a.left+a.right)<u&&(s="left"),n+="center"===s?(o-u)/2:"right"===s?o-u-a.right:a.left,i+="middle"===l||"center"===l?(r-h)/2:"bottom"===l?r-h-a.bottom:a.top,e.fillText(t,n,i+h-1),a.top+a.bottom+h}function Re(e,t,n){if(1===t.length)return t;for(var i,o=[t.shift()];(i=Ee(e,o.join(" "))<n)&&t.length;)o.push(t.shift());return!i&&1<o.length&&t.unshift(o.pop()),o=[o.join(" ")],t.length&&(o=o.concat(Re(e,t,n))),o}function Le(e,t,n,i,o,r,s,l,a){a=a||we;var u=be(e.font),h=function(e,t,n){for(var i,o=t.trim().split("\n"),r=o.length,s=[],l=0;l<r;l++)s=s.concat(Re(e,(i=o[l],(i+"").trim().replace(/\s\s+/g," ")).split(" "),n));return s}(e,t,o-(a.left+a.right)),c=h.length;if(c<=1)return Ie(e,t,n,i,o,r,s,l,a);var d,f,v=c*u;"top"===l?f=a.top:"center"===l||"middle"===l?f=(r-v)/2:"bottom"===l&&(f=r-v-a.bottom),f=Math.max(a.top,f)+u;for(var g=Ee(e,t),m=0;m<c;m++){var _=h[m];g=Ee(e,_),"left"===s?d=a.left:"center"===s?d=(o-g)/2:"right"===s&&(d=o-g-a.right),e.fillText(_,n+d,i+f+m*u-2)}return a.top+a.bottom+u*c}var Se=Object.freeze({__proto__:null,lineTo:xe,measureFontHeight:be,measureTextWidth:Ee,paintSingleLine:Ie,paintMultiLine:Le}),Me=function(e){f(i,ne);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this))._grid=e,t._deferredFuncs=[],t}return c(i,[{key:"created",value:function(e){}},{key:"prepare",value:function(e,t){}},{key:"paint",value:function(e,t,n,i){}},{key:"dispose",value:function(){for(;0<this._deferredFuncs.length;)this._deferredFuncs.pop()()}},{key:"watchEvent",value:function(e,t,n,i){e&&e.addEventListener&&(e.addEventListener(t,n,i),this._deferredFuncs.push(function(){e.removeEventListener(t,n,i)}))}},{key:"grid",get:function(){return this._grid}},{key:"isDomRenderer",get:function(){return!!this.htmlElement}}],[{key:"factory",value:function(e){var t=function(e){f(n,i);var t=g(n);function n(e){return h(this,n),t.call(this,e)}return n}();return t.withBehavior({dispose:function(){if(i.prototype.dispose.apply(this),e.dispose)return e.dispose.apply(this)}},e),"string"==typeof e.template&&t.withDom(e.template),t}}]),i}(),De={};function Ne(e,t,n){e[t]!=n&&(e[t]&&(ae(e,e[t]),delete e[t]),n&&(le(e,n),e[t]=n))}var Pe={created:function(){},prepare:function(e,t){},paint:function(e,t,n,i){var o=t.cellPosition,r=t.column,s=null==t.label?"":""+t.label,l=this.grid.getCellStyle(o.rowIndex,o.columnIndex,"font","textAlign","verticalAlign","cellPadding"),a=this.grid.getCellStyle(o.rowIndex,o.columnIndex,(t.hovered?"textOverColor":t.selected&&"textSelectionColor")||"color"),u=l.textAlign;if(r.format&&void 0===r.styles.textAlign){var h=r.format.type;"number"===h?u="right":"date"===h&&(u="center")}return e.font!==l.font&&(e.font=l.font),e.fillStyle!==a&&(e.fillStyle=a,e.strokeStyle=a),r.wordWrap?Le(e,s,0,0,n,i,u,l.verticalAlign,l.cellPadding):Ie(e,s,0,0,n,i,u,l.verticalAlign,l.cellPadding)}},Oe={template:'<div id="container"><label id="labelDisplay"></label></div>',prepare:function(e,t){var n=this.DOM,i=n.container,o=n.labelDisplay,r=t.cellPosition,s=t.column,l=null==t.label?"":""+t.label,a=this.grid.getCellStyle(r.rowIndex,r.columnIndex,(t.hovered?"textOverColor":t.selected&&"textSelectionColor")||"color"),u=this.grid.getCellStyle(r.rowIndex,r.columnIndex,"font","textAlign","verticalAlign","cellPadding"),h=u.font,c=u.textAlign,d=u.verticalAlign;u.cellPadding;if(s.format&&void 0===s.styles.textAlign){var f=s.format.type;"number"===f?c="right":"date"===f&&(c="center")}var v=("center"===c?"h-c":"right"===c&&"h-r")||null;Ne(i,"__vertical__",("center"===d?"v-c":"bottom"===d&&"v-b")||null),Ne(i,"__horizontal__",v),h&&i.style.fontFamily!==h&&(i.style.fontFamily=h),a&&i.style.color!==a&&(i.style.color=a),o.textContent!==l&&(o.textContent=l)}},Ge={template:'<div><label id="labelDisplay" style="width:100%;text-align:center;margin: 0 3px"></label><div id="iconContainer" style="height:80%; display:none; align-items:center;border-left:solid 1px #c3c3c3;"><label id="iconDisplay" style="font-size:small;min-width:15px;text-align: center;margin:0 3px;"></label></div></div></div>',prepare:function(e,t){var n=this.DOM,i=n.labelDisplay,o=n.iconDisplay,r=n.iconContainer,s=t.column,l=t.label,a=e.getSortColumns()||[],u=a.length,h=a.indexOf(s);i.textContent=l,0<=h?(o.textContent=(s.sortDescending?"↓":"↑")+(1<u?h+1:""),r.style.display="flex"):r.style.display="none"},dispose:function(){}},He={template:'<div style="overflow: hidden"><div id="indentBox" style="display:inline-block"></div><button id="toggleButton" on-mousedown="onClick"></button><label id="labelDisplay"></label></div>',prepare:function(e,t){var n=t.item,i=t.column,o=t.label||"",r=e.getNodeLevel(n),s=i.indent,l=e.isOpenNode(n),a=e.hasChildren(n),u=this.DOM.indentBox,h=this.DOM.labelDisplay,c=this.DOM.toggleButton;u.style.marginLeft=r*s+"px",h.textContent=o,a?(c.removeAttribute("hidden"),c.textContent=l?"-":"+"):c.setAttribute("hidden","hidden"),this.item=n,this.column=i},onClick:function(e){this.grid.toggleNode(this.item),e.preventDefault(),e.stopPropagation()}},Te={created:function(e){this.watchEvent(document,"keydown",function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:return e.stopImmediatePropagation(),!0}},!0)},getSaveValue:function(){return this.DOM.input.value},prepare:function(e,t){var n=this.DOM.input,i=null!=t.label?""+t.label:"",o=t.inputtedKey;if(o){var r=(n.value=o).length;n.setSelectionRange(r,r)}else n.value=i,n.setSelectionRange(0,i.length);n.focus()},dispose:function(){},template:'<input id="input" class="tachyon-editor" type="text">'},ze=function(e){f(i,ue);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this))._grid=e,t._layers=[],t._reasonsMask=0,t._invalidateFlag=!1,t._boundValidateNow=t.validateNow.bind(v(t)),t._freeElementMap=new Map,t._factoryMap=new Map,t._scrollLeft=0,t._scrollTop=0,t._lockedDisplay=!1,t.hookFreeElement=null,t}return c(i,[{key:"setContentSize",value:function(e,t){e===this.contentWidth&&t===this.contentHeight||(this._contentWidth=e,this._contentHeight=t,this.dispatchEvent(new CustomEvent("content-size-change")))}},{key:"getScrollRect",value:function(){return new R(this.scrollLeft,this.scrollTop,this.clientWidth,this.clientHeight)}},{key:"getHorizontalScrollPositionDelta",value:function(e){return 0<e?-30:30}},{key:"getVerticalScrollPositionDelta",value:function(e){return 0<e?-30:30}},{key:"lockDisplay",value:function(){this._lockedDisplay=!0}},{key:"unlockDisplay",value:function(){this._lockedDisplay&&(this._invalidateFlag=!1,this._lockedDisplay=!1,this.invalidateFor(K.ALL))}},{key:"invalidate",value:function(e){this.invalidateFor(e||K.DISPLAY_UPDATE)}},{key:"validateNow",value:function(){this._lockedDisplay||!this._invalidateFlag||this._inUpdateDisplay||(this._inUpdateDisplay=!0,this._updateDisplay(),this._inUpdateDisplay=!1,this._reasonsMask=0,this._invalidateFlag=!1)}},{key:"clearElementCache",value:function(){this._freeElementMap.clear(),this._factoryMap.clear()}},{key:"invalidateFor",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(e){t._reasonsMask|=0|e}),this._invalidateFlag||(this._invalidateFlag=!0,E(this._boundValidateNow))}},{key:"isInvalidateReason",value:function(){for(var e=0,t=arguments.length;e<t;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];if((this._reasonsMask&n)===n)return!0}return!1}},{key:"_addLayer",value:function(e){return this._layers.indexOf(e)<0&&(this.appendChild(e),this._layers.push(e)),e}},{key:"_beginLayers",value:function(){for(var e=this._layers,t=e.length,n=0;n<t;n++)e[n].begin()}},{key:"_endLayers",value:function(){this._layers.forEach(function(e){return e.end()})}},{key:"_prepareLayers",value:function(t,n,i,o){this._layers.forEach(function(e){return e.prepareLayout(t,n,i,o)})}},{key:"_updateLayers",value:function(t,n,i,o,r,s,l){this._layers.forEach(function(e){return e.updateLayout(t,n,i,o,r,s,l)})}},{key:"_createRenderer",value:function(){var e,t=this._itemToFactory.apply(this,arguments),n=this._freeElementMap.get(t);return n&&0<n.length?e=n.pop():t instanceof Function&&(e=new t(this.grid))&&_(e,"created",this.grid),e&&_(e,"ready",this.grid),e}},{key:"_freeRenderer",value:function(e){if(!(this.hookFreeElement instanceof Function&&!1===this.hookFreeElement(e))){var t=e&&e.constructor;if(!t)return!1;var n=this._freeElementMap.get(t);return n||(n=[],this._freeElementMap.set(t,n)),n.push(e),!0}}},{key:"_itemToFactory",value:function(){var e=this._itemToTemplate.apply(this,arguments);if(e){var t=this._factoryMap.get(e);return t||(t=Me.factory(e),this._factoryMap.set(e,t)),t}return null}},{key:"_itemToTemplate",value:function(){}},{key:"_updateScrollRect",value:function(){}},{key:"_updateDisplay",value:function(){}},{key:"_mouseEventToContent",value:function(e){}},{key:"_mouseEventToLocal",value:function(e){var t=this.root.getBoundingClientRect();return new I(Math.round(e.clientX-t.left),Math.round(e.clientY-t.top))}},{key:"grid",get:function(){return this._grid}},{key:"contentWidth",get:function(){return this._contentWidth||0}},{key:"contentHeight",get:function(){return this._contentHeight||0}},{key:"maxScrollLeft",get:function(){return Math.max(0,this.contentWidth-this.clientWidth)}},{key:"maxScrollTop",get:function(){return Math.max(0,this.contentHeight-this.clientHeight)}},{key:"scrollLeft",get:function(){return this._scrollLeft||0},set:function(e){if(e=parseInt(L(e,0,this.maxScrollLeft)),this._scrollLeft!==e){var t=this._scrollLeft;this._scrollLeft=e,this.updateScrollRect(),this.dispatchEvent(new CustomEvent("horizontal-scroll-position-change",{bubbles:!1,detail:{newValue:e,oldValue:t}}))}}},{key:"scrollTop",get:function(){return this._scrollTop},set:function(e){if(e=parseInt(L(e,0,this.maxScrollTop)),this._scrollTop!==e){var t=this._scrollTop;this._scrollTop=e,this.updateScrollRect(),this.dispatchEvent(new CustomEvent("vertical-scroll-position-change",{bubbles:!1,detail:{newValue:e,oldValue:t}}))}}}]),i}(),Ae=function(e){f(i,ue);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this)).useDB=!1,t._ctx=t.canvas.getContext("2d"),t._bufferCanvas=document.createElement("canvas"),t._bufferCtx=t._bufferCanvas.getContext("2d"),le(t.root,"tachyon-layer-"+e),t}return c(i,[{key:"begin",value:function(){this.context.save(),this.useDB&&this._bufferCtx.clearRect(0,0,this.canvas.width,this.canvas.height),this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"end",value:function(){this.context.restore(),this.useDB&&0<this._bufferCanvas.width&&0<this._bufferCanvas.height&&this._ctx.drawImage(this._bufferCanvas,0,0)}},{key:"setSize",value:function(e,t){return!!C(p(i.prototype),"setSize",this).call(this,e,t)&&(this.canvas.width!==e&&(this.canvas.width=this._bufferCanvas.width=e),this.canvas.height!==t&&(this.canvas.height=this._bufferCanvas.height=t),!0)}},{key:"prepareLayout",value:function(e,t,n,i){this.setSize(n,i)}},{key:"updateLayout",value:function(e,t,n,i){}},{key:"canvas",get:function(){return this.DOM.canvas}},{key:"context",get:function(){return this.useDB?this._bufferCtx:this._ctx}}]),i}().withDom('<div><canvas id="canvas" class="canvas"></canvas></div>'),Fe=function(e){f(i,ue);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this)).index=e,t.fragment=null,t}return c(i,[{key:"begin",value:function(){this.fragment=document.createDocumentFragment()}},{key:"end",value:function(){0<this.fragment.childNodes.length&&this.root.appendChild(this.fragment),this.fragment=null}},{key:"addElement",value:function(e){return!(!this.fragment||e.parentElement===this.root)&&(this.fragment.appendChild(e),!0)}}]),i}().withDom('<div class="tachyon-section"><div id="sizeMarker" style="position:absolute;width: 1px;height: 1px;visibility: hidden;pointer-events: none"></div></div>');m(Fe,{LEFT:1,RIGHT:2,CENTER:0,TOP:1,BOTTOM:2,MIDDLE:0});var Ve=["center","left","right"],Be=["middle","top","bottom"],We=function(e){f(y,Ae);var n=g(y);function y(e){var t;return h(this,y),(t=n.call(this,e))._sections=[],t._overlaySection=new Fe,t.appendChild(t._overlaySection),le(t._overlaySection.root,"overlay"),t}return c(y,[{key:"begin",value:function(){C(p(y.prototype),"begin",this).call(this),this._sections.forEach(function(e,t,n){e&&e.begin()}),this._overlaySection.begin()}},{key:"end",value:function(){C(p(y.prototype),"end",this).call(this),this._sections.forEach(function(e){e&&e.end()}),this._overlaySection.end()}},{key:"updateLayout",value:function(e,t,n,i,o,r,s){C(p(y.prototype),"updateLayout",this).call(this,e,t,n,i,o,r,s);for(var l,a,u,h,c,d,f=this._sections.length,v=0;v<f;v++){var g=this._sections[v];if(g){var m=Math.floor(g.index/3),_=g.index%3;_===Fe.LEFT?(l=0,u=s.left,c=0):_===Fe.RIGHT?(l=n-s.right,u=s.right,c=0):(l=s.left,u=n-(s.left+s.right),c=e,g.DOM.sizeMarker.style.left=o+"px"),m===Fe.TOP?(a=0,h=s.top,d=0):m===Fe.BOTTOM?(a=i-s.bottom,h=s.bottom,d=0):(a=s.top,h=i-(s.top+s.bottom),d=t,g.DOM.sizeMarker.style.top=r+"px"),g.setLayout(l,a,u,h),g.root.scrollLeft=c,g.root.scrollTop=d}}this._overlaySection.setLayout(0,0,n,i)}},{key:"addElement",value:function(e,t,n){return this._getSection(e,t).addElement(n)}},{key:"addOverlayElement",value:function(e){this._overlaySection.addElement(e)}},{key:"removeElement",value:function(e){e instanceof HTMLElement&&e.parentElement&&e.parentElement.removeChild(e)}},{key:"_getSection",value:function(e,t){var n=3*e+t,i=this._sections[n];return i||(i=new Fe(n),this.appendChild(i),this.setChildIndex(this._overlaySection,this.childElementCount),le(i.root,Ve[t]+"-"+Be[e]),(this._sections[n]=i).begin()),i}}]),y}(),Ue=function e(){h(this,e),this.item=null,this.column=null,this.hovered=!1,this.selected=!1,this.label=null,this.renderer=null,this.visible=!0},je=function(e){f(r,Ue);var o=g(r);function r(e,t,n){var i;return h(this,r),(i=o.call(this)).item=e,i.column=t,i.cellPosition=n,i}return r}(),Ke=function(e){f(i,Ue);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this)).column=e,t}return i}(),Xe=function(e){f(n,je);var t=g(n);function n(){return h(this,n),t.call(this)}return n}(),Ye=function(){function t(e){h(this,t),this.headerGroup=e,this._visibleColumns=[],this._visibleLayouts=[],this._oldVisibleColumns=null,this._pendingHeaders=null,this._headers=[],this._rowCount=1,this._rowHeight=30}return c(t,[{key:"setRowDefaultHeight",value:function(e){this._rowHeight=e}},{key:"updateStart",value:function(){this._pendingHeaders=[]}},{key:"updateEnd",value:function(){var e=this._headers;return this._headers=this._pendingHeaders,this._pendingHeaders=null,this._oldVisibleColumns=null,{headers:e}}},{key:"getHeader",value:function(e){var t=this._visibleColumns.indexOf(e);return 0<=t?this._headers[t]:null}},{key:"setHeader",value:function(e,t){this._pendingHeaders[this._visibleColumns.indexOf(e)]=t}},{key:"takeHeader",value:function(e){var t=(this._oldVisibleColumns||this._visibleColumns).indexOf(e);if(0<=t){var n=this._headers[t];return this._headers[t]=null,n}return null}},{key:"createHeader",value:function(e){return new Ke(e)}},{key:"isOpenColumn",value:function(e){if(!e.visible)return!1;for(var t=e.parent;t;){if(!t.open)return!1;t=t.parent}return!0}},{key:"getHeaderLayout",value:function(e){var t=this._visibleColumns.indexOf(e);return 0<=t?this._visibleLayouts[t]:null}},{key:"updateHeaderRowCount",value:function(){var e=this.dataGroup.normalizedColumns;this._rowCount=e.reduce(function(e,t){if(t.visible){for(var n=0,i=0;t;)t.open&&0!==t.height||(i=n),n++,t=t.parent;e=Math.max(n-i,e)}return e},0)}},{key:"updateHeaderColumnLayouts",value:function(){var i=this,e=this.dataGroup._dimensions,o=this.dataGroup.normalizedColumns,t=this._visibleColumns,r=[],s=[],l=new Set;e.forEachColumnLayouts(function(e,t){for(var n=o[t];n&&!l.has(n)&&0!==n.height;)l.add(n),i.isOpenColumn(n)&&(r.push(n),s.push(i.calculateHeaderLayout(n))),n=n.parent}),this._visibleColumns=r,this._visibleLayouts=s,this._oldVisibleColumns=t}},{key:"calculateHeaderLayout",value:function(e){var t=this.columnCollection,n=this.dataGroup._dimensions,i=t.getVisibleLeafColumns(e),o=this.headerGroup.headerHeight,r=this.headerGroup.headerRowHeight,s=n.getColumnLayouts(i[0].index,i[i.length-1].index),l=t.getAncestorNodes(e).reduce(function(e,t){var n=t.height;return(null==n||n<0)&&(n=r),e+=n},0),a=0!==e.depth&&e.open?0===e.height?0:r:o-l;return d(d({},s),{},{y:l,height:a,sy:0,sh:a,dy:l,dh:a})}},{key:"forEachHeaderLayouts",value:function(n){var i=this;this._visibleLayouts.forEach(function(e,t){return n(e,i._visibleColumns[t])})}},{key:"clear",value:function(){this._visibleColumns=[],this._visibleLayouts=[],this._pendingHeaders=null,this._headers=[]}},{key:"dataGroup",get:function(){return this.headerGroup.dataGroup}},{key:"columnCollection",get:function(){return this.dataGroup.columnCollection}},{key:"rowCount",get:function(){return this._rowCount}},{key:"headers",get:function(){return this._headers}},{key:"rowHeight",get:function(){return this._rowHeight}},{key:"headerHeight",get:function(){return this.rowHeight*this.rowCount}}]),t}(),qe=function(e){f(o,ze);var i=g(o);function o(e){var t;h(this,o),(t=i.call(this,e))._headerDimensions=new Ye(v(t)),t._selectionLayer=t._addLayer(new Ae("selection")),t._rendererLayer=t._addLayer(new We("renderer")),t._separatorLayer=t._addLayer(new Ae("separator")),t._headerRenderer=ce.headerRenderer||Ge,t.headerRowHeight=ce.styles.headerRowHeight,t._boundDocumentMouseMove=t._onDocumentMouseMove.bind(v(t)),t._boundDocumentMouseUp=t._onDocumentMouseUp.bind(v(t)),t.addEventListener("mousedown",t._onMouseDown.bind(v(t))),t.addEventListener("mousemove",t._onMouseMove.bind(v(t))),t.addEventListener("mouseout",t._onMouseOut.bind(v(t)));var n=t._onDataGroupEvent.bind(v(t));return["visible-columns-change","normalized-columns-change","column-visible","column-size-change","horizontal-scroll-position-change","group-size-change"].forEach(function(e){return t.dataGroup.addEventListener(e,n)}),t}return c(o,[{key:"doLayout",value:function(e){this.invalidateFor(e?K.ALL:0),this.validateNow()}},{key:"getColumnByPosition",value:function(n,i){var o=null;return this._headerDimensions.forEachHeaderLayouts(function(e,t){!o&&n>=e.x&&n<e.x+e.width&&i>=e.y&&i<e.y+e.height&&(o=t)}),o}},{key:"getHeaderLayout",value:function(e){return this._headerDimensions.getHeaderLayout(e)}},{key:"clearHeaderRenderers",value:function(){this._freeHeaders(this._headerDimensions.headers.slice(0))}},{key:"clearCache",value:function(){this.clearHeaderRenderers(),this._headerDimensions.clear(),this.clearElementCache()}},{key:"destroy",value:function(){this.clearCache()}},{key:"_measureSize",value:function(){this.style.minHeight=this.headerHeight+"px"}},{key:"_updateDisplay",value:function(){var e=this.dataGroup,t=e.scrollLeft,n=e.clientWidth,i=e.getVisibleFrozenSizeRect().clone(),o=e.getContentWidth();i.top=i.bottom=0;var r=this.isInvalidateReason(K.COLUMNS_CHANGE),s=this.isInvalidateReason(K.COLUMN_VISIBLE),l=this.isInvalidateReason(K.VISIBLE_COLUMNS_CHANGE),a=r||s||l||this.isInvalidateReason(K.COLUMN_UPDATE,K.HORIZONTAL_SCROLL_CHANGE,K.GROUP_SIZE_CHANGE);r&&this.clearCache(),this._beginLayers(),(r||s)&&(this._headerDimensions.updateHeaderRowCount(),this._measureSize()),a&&this._headerDimensions.updateHeaderColumnLayouts();var u=this.headerHeight;this._prepareLayers(t,0,n,u),this._createHeaders(t,0,n,u),this._paintSeparators(t,0,n,u),this._updateLayers(t,0,n,u,o,u,i),this._endLayers(),this.setContentSize(o,u)}},{key:"_createHeaders",value:function(e,t,n,i){var o=this,r=this._rendererLayer.context,s=this._headerDimensions;s.updateStart(),s.forEachHeaderLayouts(function(e,t){var n=s.takeHeader(t),i=o._createHeader(t,e,n);o._paintHeader(r,i,e),s.setHeader(t,i)});var l=s.updateEnd().headers;this._freeHeaders(l)}},{key:"_createHeader",value:function(e,t,n){var i=n||this._headerDimensions.createHeader(e),o=i.renderer||this._createRenderer(e),r=o&&o.htmlElement;if(r){le(r,"header-cell");var s=this._rendererLayer;e.isLeaf?(s.addElement(Fe.MIDDLE,this.dataGroup.getHorizontalSectionIndex(e.index),r),re(r,t.x-t.baseX,t.y,t.width,t.height)):(s.addOverlayElement(r),re(r,t.dx,t.dy,Math.min(t.dw,t.width),t.dh))}return this._setupHeader(i,o,e)}},{key:"_setupHeader",value:function(e,t,n){return e.item=n,e.column=n,e.label=n.headerText,e.hovered=this._overColumn===n,e.renderer=t,e.visible=!0,_(t,"prepare",this.grid,e),e}},{key:"_paintHeader",value:function(e,t,n){if(t.visible){var i=t.renderer;if(i.paint){var o=t.column.isLeaf,r=n.dx,s=n.dy,l=o?n.sx:0,a=o?n.sy:0,u=n.sw,h=n.sh,c=o?n.width:u,d=o?n.height:h;e.save(),e.beginPath(),e.rect(r,s,u,h),e.clip(),e.translate(r-l,s-a),i.paint(e,t,c,d),e.restore()}}}},{key:"_paintSeparators",value:function(e,t,n,o){var r=this._separatorLayer.context,s=this._headerDimensions,l=this._getStyle("headerColumnLine");r.save(),s.forEachHeaderLayouts(function(e,t){var n=t.parent,i=n&&s.getHeaderLayout(n)||null;s.getHeader(t);i&&i.x+i.width===e.x+e.width||xe(r,e.dx+e.dw,e.dy,e.dx+e.dw,o,l)});var i=this.dataGroup._dimensions.getColumnLayout(this.normalizedColumns.length-1),a=i&&i.x+i.width||-1;0<a&&a<n&&xe(r,a,0,a,o,l),this._grid.hasVerticalScroll&&xe(r,n-1,0,n-1,o,l),r.restore();var u=this._getStyle("headerRowLine");r.save(),s.forEachHeaderLayouts(function(e,t){!t.isLeaf&&0<e.height&&xe(r,e.dx,e.dy+e.dh,e.dx+Math.min(e.dw,e.width),e.dy+e.dh,u)}),r.restore()}},{key:"_freeHeaders",value:function(e){var i=this,o=this._rendererLayer;e.forEach(function(e){var t=e&&e.renderer;if(t){var n=t.htmlElement;_(t,"dispose");n&&o.removeElement(n),i._freeRenderer(t)}})}},{key:"_itemToTemplate",value:function(e){var t=e.headerRenderer||this.headerRenderer,n=t instanceof Function?t(e):t;return n||(n=Ge),n}},{key:"_getStyle",value:function(e){return this.grid.getStyle(e)}},{key:"_dispatchDataGridHeaderEvent",value:function(e,t,n){return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:{column:t,trigger:n}}))}},{key:"_mouseEventToContent",value:function(e){var t=this._mouseEventToLocal(e),n=this.dataGroup.clientWidth,i=this.dataGroup.contentWidth,o=this.dataGroup.getVisibleFrozenSizeRect();return 0<o.left&&t.x<=o.left||(0<o.right&&n-t.x<=o.right?t.x=i-(n-t.x):t.x=t.x+this.dataGroup.scrollLeft),t}},{key:"_getSeparatorColumn",value:function(e){var i=this._mouseEventToLocal(e),o=null;if(this._headerDimensions.forEachHeaderLayouts(function(e,t){var n=e.dx+e.dw;(!t.isLeaf||e.width-(e.sx+e.sw)<1)&&i.x>=n-5&&i.x<n+5&&i.y>=e.y&&i.y<e.y+e.height&&(o=t)}),o&&!o.isLeaf){var t=this.dataGroup.columnCollection.getVisibleLeafColumns(o);o=t[t.length-1]}return o}},{key:"_onMouseDown",value:function(e){if(!e.defaultPrevented){var t=this._mouseEventToContent(e),n=t&&this.getColumnByPosition(t.x,t.y);n&&(this._mouseDownPoint=t,this._mouseDownColumn=n,this._mouseDownSeparatorColumn=this._getSeparatorColumn(e),this._mouseDownSeparatorColumn?(this._mouseDownColumn=null,this._dispatchDataGridHeaderEvent("separator-down",this._mouseDownSeparatorColumn,e)):this._mouseDownColumn&&this._dispatchDataGridHeaderEvent("header-down",this._mouseDownColumn,e),document.addEventListener("mousemove",this._boundDocumentMouseMove),document.addEventListener("mouseup",this._boundDocumentMouseUp))}}},{key:"_onMouseMove",value:function(e){if(1!=(1&e.buttons)){var t=this._getSeparatorColumn(e),n=this._mouseEventToContent(e),i=!t&&this.getColumnByPosition(n.x,n.y);t!==this._overSeparatorColumn&&(this._overSeparatorColumn&&this._dispatchDataGridHeaderEvent("separator-out",this._overSeparatorColumn,e),t&&this._dispatchDataGridHeaderEvent("separator-over",t,e)),i!==this._overColumn&&(this._overColumn&&this._dispatchDataGridHeaderEvent("header-out",this._overColumn,e),i&&this._dispatchDataGridHeaderEvent("header-over",i,e)),this._overSeparatorColumn=t,this._overColumn=i}}},{key:"_onMouseOut",value:function(e){this._overSeparatorColumn&&this._dispatchDataGridHeaderEvent("separator-out",this._overSeparatorColumn,e),this._overColumn&&this._dispatchDataGridHeaderEvent("header-out",this._overColumn,e),this._overSeparatorColumn=null,this._overColumn=null}},{key:"_onDocumentMouseMove",value:function(e){var t=this._mouseEventToContent(e);this._mouseDownSeparatorColumn?this._dispatchDataGridHeaderEvent("separator-drag",this._mouseDownSeparatorColumn,e):this._mouseDownColumn&&(!this._mouseDownPoint||5<I.distance(this._mouseDownPoint,t))&&(this._dispatchDataGridHeaderEvent("header-drag",this._mouseDownColumn,e),this._mouseDownPoint=null)}},{key:"_onDocumentMouseUp",value:function(e){document.removeEventListener("mousemove",this._boundDocumentMouseMove),document.removeEventListener("mouseup",this._boundDocumentMouseUp);var t,n=this._mouseEventToContent(e),i=n&&this.getColumnByPosition(n.x,n.y),o=this._getSeparatorColumn(e);(this._mouseDownSeparatorColumn&&(i=null),o||i)&&(t=0<=this._lastClickTime&&Date.now()-this._lastClickTime<400?(this._lastClickTime=-1,o?"separator-double-click":"header-double-click"):(this._lastClickTime=Date.now(),o?"separator-click":"header-click"),this._dispatchDataGridHeaderEvent(t,o||i,e));this._mouseDownSeparatorColumn&&this._dispatchDataGridHeaderEvent("separator-up",this._mouseDownSeparatorColumn,e),this._mouseDownColumn&&this._dispatchDataGridHeaderEvent("header-up",i,e),this._mouseDownSeparatorColumn=null,this._mouseDownColumn=null}},{key:"_onDataGroupEvent",value:function(e){switch(e.type){case"normalized-columns-change":this.invalidateFor(K.COLUMNS_CHANGE);break;case"visible-columns-change":this.invalidateFor(K.VISIBLE_COLUMNS_CHANGE);break;case"column-size-change":this.invalidateFor(K.COLUMN_UPDATE);break;case"column-visible":this.invalidateFor(K.COLUMN_VISIBLE);break;case"horizontal-scroll-position-change":this.invalidateFor(K.HORIZONTAL_SCROLL_CHANGE);break;case"group-size-change":this.invalidateFor(K.GROUP_SIZE_CHANGE)}}},{key:"headerRenderer",get:function(){return this._headerRenderer},set:function(e){this._headerRenderer!==e&&(this._headerRenderer=e,this.clearCache(),this.invalidateFor(K.RENDERER_CHANGE))}},{key:"headerHeight",get:function(){return this._headerDimensions.headerHeight}},{key:"headerRowHeight",get:function(){return this._headerDimensions.rowHeight},set:function(e){this.headerRowHeight!==e&&(this._headerDimensions.setRowDefaultHeight(e),this.invalidate())}},{key:"dataGroup",get:function(){return this.grid.dataGroup}},{key:"normalizedColumns",get:function(){return this.dataGroup.normalizedColumns}}]),o}().withDom('<div class="tachyon-group-header"></div>'),Ze=function(e){f(s,S);var r=g(s);function s(e,t,n,i){var o;return h(this,s),(o=r.call(this,e,t,n,i))._crossCellPositions=[],o}return c(s,[{key:"containsCross",value:function(t,n){return this.crossCellPositions.some(function(e){return e.contains(t,n)})}},{key:"crossCellPositions",get:function(){return this._crossCellPositions},set:function(e){this._crossCellPositions=e||[]}}]),s}();function Je(e,t,n){for(var i=e.length,o=0;o<i;o++){var r=e[o];if(!r.isCrossed&&t<r.y)break;if(r.contains(n,t))return r}return null}var Qe=function(){function t(e){h(this,t),this._dataGroup=e,this._cells=[],this._affectColumnsMap=new Map,this._collection=null,this._compareFunction=null,this._columns=[],this._targetColumnIndices=[],this._doneRowsMap={},this._needUpdate=!0,this._crossCells=[],this._visibleRect=null,this._visibleCells=[]}return c(t,[{key:"getCells",value:function(){return this._cells.slice(0)}},{key:"getCrossCells",value:function(){return this._needUpdate&&(this._needUpdate=!1,this._crossCells=this._cells.reduce(function(e,t){return t instanceof Ze&&(e=e.concat(t.crossCellPositions)),e},[])),this._crossCells}},{key:"addCell",value:function(e){return!!e.isMerged&&(this.removeCell(e),this._internalAddCell(e),!0)}},{key:"_internalAddCell",value:function(e){this._needUpdate=!0;var t=this._cells,n=t.length;if(n<=0)return t.push(e),!0;for(var i=e.y,o=e.x,r=0;r<n;r++){var s=t[r],l=s.y,a=s.x;if(i<l||i===l&&o<a)return t.splice(r,0,e),!0}return t.push(e),!0}},{key:"removeCell",value:function(e){this._needUpdate=!0;for(var t=this._cells,n=[],i=0;i<t.length;){var o=t[i];e.containsRect(o)?(t.splice(i,1),n.push(o)):i++}return n}},{key:"removeCells",value:function(e){var t=this;return(e||[]).map(function(e){return t.removeCell(e)})}},{key:"insertRows",value:function(e,t){this._needUpdate=!0;for(var n=this._cells.slice(0),i=n.length,o=new S(e,0,e+t-1,1073741824),r=[],s=i-1;0<=s;s--){var l=n[s];e<=l.y?l.y+=t:1<l.rowCount&&o.intersects(l)&&r.push.apply(r,n.splice(s,1))}this._cells=n}},{key:"deleteRows",value:function(e,t){this._needUpdate=!0;for(var n=this._cells.slice(0),i=n.length,o=new S(e,0,e+t-1,1073741824),r=o.endRowIndex,s=[],l=i-1;0<=l;l--){var a=n[l];r<a.y?a.y-=t:o.intersects(a)&&s.push.apply(s,n.splice(l,1))}this._cells=n}},{key:"insertColumns",value:function(e,t){}},{key:"deleteColumns",value:function(e,t){}},{key:"findCell",value:function(e,t){var n=Je(this._cells,e,t);return n||(n=Je(this.getCrossCells(),e,t)),n}},{key:"findCellFromVisibleRect",value:function(e,t){if(!this._visibleRect)return null;var n=null;return this._visibleRect.contains(t,e)?0<this._visibleCells.length&&(n=Je(this._visibleCells,e,t)):n=Je(this._cells,e,t),n||(n=Je(this.getCrossCells(),e,t)),n}},{key:"setVisibleRect",value:function(e,t,n,i){for(var o=new S(e,t,n,i),r=this._cells,s=[],l=0,a=r.length;l<a;l++){var u=r[l];if(n<u.y)break;u.intersects(o)&&s.push(u)}this._visibleRect=o,this._visibleCells=s}},{key:"unionCellPosition",value:function(e,t,n,i,o){var r=this.getCells();o&&(r=r.concat(this.getCrossCells()));for(var s=new S(e,t,n,i),l=0;l<r.length;l++){var a=r[l];s.intersects(a)&&(s.containsRect(a)||(s=s.union(a)),r.splice(l,1),l=-1)}return s}},{key:"clear",value:function(){this._cells=[],this._crossCells=[],this._affectColumnsMap.clear(),this._doneRowsMap={}}},{key:"analysisReady",value:function(){var o=this,r=this._dataGroup.normalizedColumns.slice(0),e=r.filter(function(e){return e.isRowMerge||e.isColumnMerge}).map(function(e){return e.index});this._affectColumnsMap.clear(),this._doneRowsMap={},this._collection=this._dataGroup.collection,this._columns=r,this._targetColumnIndices=e,this._compareFunction=this._dataGroup.mergeCompare,this._targetColumnIndices.forEach(function(e){var t=o._columns[e],n=t.mergeDependColumns;if(Array.isArray(n)){var i=r.filter(function(e){return 0<=n.indexOf(e.dataField)});0<i.length&&o._affectColumnsMap.set(t,i)}})}},{key:"analysisAll",value:function(){for(var e=this._collection&&this._collection.length||0,t=0;t<e;t++)this.analysisRow(t)}},{key:"analysisRow",value:function(e){this._doneRowsMap[e]||(this._doneRowsMap[e]=!0,this._internalAnalysisRow(e))}},{key:"analysisRows",value:function(e,t){for(var n=e;n<=t;n++)this.analysisRow(n)}},{key:"_internalAnalysisRow",value:function(e){for(var t=this._targetColumnIndices.length,n=[],i=0;i<t;i++){var o=this._targetColumnIndices[i];if(!Je(n,e,o)&&!Je(this._cells,e,o)){var r=this._analysisCell(e,o);r&&n.push(r)}}for(this.removeCells(n);0<n.length;)this._internalAddCell(n.shift())}},{key:"_analysisCell",value:function(e,t){var n=this._collection.get(e),i=this._columns[t],o=this._dataGroup.itemToLabel(n,i),r=e,s=t;if(i.isRowMerge&&(r=this._compare(e,i,o,i)),i.isColumnMerge)for(var l,a=this._targetColumnIndices.length,u=t,h=this._targetColumnIndices.indexOf(t)+1;h<a&&u===(l=this._targetColumnIndices[h])-1&&!(this._compare(e,this._columns[l],o,n,i)<r);h++)u=s=l;return e!==r||t!==s?new S(e,t,r,s):null}},{key:"_compare",value:function(e,t,n,i){var o=this._internalCompare(e,t,n,i);if(e<o)for(var r=this._affectColumnsMap.get(t)||[],s=r.length,l=this._collection.get(e),a=0;a<s;a++){var u=r[a],h=this._internalCompare(e,u,this._dataGroup.itemToLabel(l,u),i);if(h<o&&(o=h),o<=e){o=e;break}}return o}},{key:"_internalCompare",value:function(e,t,n,i){for(var o=this._collection.length,r=this._collection.get(e),s=-1,l=e;l<o;l++){var a=this._collection.get(l),u=this._dataGroup.itemToLabel(a,t);if(null!=this._compareFunction){if(!this._compareFunction(a,t,r,i))break}else if(n!==u)break;s=l}return s}}]),t}(),$e={get merger(){return this._merger||(this._merger=new Qe(this)),this._merger},getMergeCellPositions:function(){return this.merger.getCells()},addMergeCellPosition:function(e){return this.merger.addCell(e)},removeMergeCellPosition:function(e){return this.merger.removeCell(e)},removeMergeCellPositions:function(e){return this.merger.removeCells(e)},findMergeCellPosition:function(e,t){return this.merger.findCell(e,t)},findMergeCellPositionFromVisibleRect:function(e,t){return this.merger.findCellFromVisibleRect(e,t)},setMergeVisibleRect:function(e,t,n,i){return this.merger.setVisibleRect(e,t,n,i)},unionCellPosition:function(e,t,n,i){var o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return this.merger.unionCellPosition(e,t,n,i,o)},clearCellMerger:function(){return this.merger.clear()},analysisReady:function(){this.merger.analysisReady()},analysisAll:function(){this.merger.analysisAll()},analysisRow:function(e){this.merger.analysisRow(e)},analysisRows:function(e,t){this.merger.analysisRows(e,t)},collectionChangedForCellMerger:function(e){var t=e.detail,n=t.index,i=t.items||[];switch(t.kind){case"add":this.merger.insertRows(n,i.length);break;case"remove":this.merger.deleteRows(n,i.length)}}},et=function(e){f(l,S);var s=g(l);function l(e,t,n,i,o){var r;return h(this,l),(r=s.call(this,e,t,n,i)).isAdded=o,r}return l}();var tt="singleRow",nt="multipleRows",it="multipleCells",ot=function(){function t(e){h(this,t),this._dataGroup=e,this._selectionCells=[],this._maxBounds=null,this._cells=[],this._rows=[],this._needUpdateMaxBounds=!0,this._needUpdateCells=!0,this.mode=tt}return c(t,[{key:"getSingleCell",value:function(){return this.isSingleSelection?this._selectionCells[0].clone():null}},{key:"getRows",value:function(){for(var e=[],t=this._getMaxBounds(),n=t.top,i=t.bottom,o=new S(0,0),r=n;r<=i;r++)o.y=r,this.containsCell(o)&&e.push(r);return e}},{key:"getCells",value:function(){if(this._needUpdateCells){for(var e=this._getMaxBounds(),t=e.rowIndex,n=e.endRowIndex,i=e.columnIndex,o=e.endColumnIndex,r=[],s=[],l=function(e,t){for(var n=0;n<s.length;n++)if(s[n].contains(t,e))return!0;return!1},a=t;a<=n;a++)for(var u=i;u<=o;u++)if(!l(a,u)){var h=this._dataGroup.findMergeCellPosition(a,u),c=h&&h.x||u,d=h&&h.y||a,f=h&&h.width||0,v=h&&h.height||0;this.containsBounds(c,d,f,v)&&(h||(h=new S(a,u)),r.push(h),h.isMerged&&s.push(h))}this._cells=r,this._needUpdateCells=!1}return this._cells}},{key:"setCell",value:function(e){var t=this._selectionCells;return(!e||1!==t.length||!t[0].equals(e))&&(this.removeAll(),this.addCell(e))}},{key:"setCells",value:function(e){return this.removeAll(),this.addCells(e)}},{key:"addCells",value:function(e){return this.addCellsAt(e,this._selectionCells.length)}},{key:"addCellsAt",value:function(e,t){var n,i=e&&e.length||0,o=!1;for(n=0;n<i;n++)this.addCellAt(e[n],t+n)&&(o=!0);return o}},{key:"addCell",value:function(e){return this.addCellAt(e,this._selectionCells.length)}},{key:"addCellAt",value:function(e,t){if(!e||this.containsCell(e))return!1;var n=this._cellToSelectionCell(e,!0);return this._selectionCells.splice(t,0,n),this._needUpdateMaxBounds=!0,this._needUpdateCells=!0}},{key:"removeCell",value:function(e){if(e&&this.containsCell(e)){var t=this._cellToSelectionCell(e,!1);return this._selectionCells.push(t),this._needUpdateMaxBounds=!0,this._needUpdateCells=!0}return!1}},{key:"removeAll",value:function(){return!(this._selectionCells.length<=0)&&(this._selectionCells=[],this._needUpdateMaxBounds=!0,this._needUpdateCells=!0)}},{key:"itemsAdded",value:function(e,t){if(t){for(var n=this._selectionCells.length,i=t.length,o=0;o<n;o++){var r=this._selectionCells[o];e<=r.y&&(r.y+=i)}this._needUpdateMaxBounds=!0,this._needUpdateCells=!0}}},{key:"itemsRemoved",value:function(e,t){for(var n=this._selectionCells.length,i=t.length,o=n-1;0<=o;o--){var r=this._selectionCells[o];e<r.y?r.y-=i:e<=r.y&&r.height<=i?this._selectionCells.splice(o,1):e<=r.y+r.height&&r.y}this._needUpdateMaxBounds=!0,this._needUpdateCells=!0}},{key:"containsCell",value:function(e){return e&&this.containsBounds(e.x,e.y,e.width,e.height)}},{key:"containsBounds",value:function(e,t,n,i){for(var o=this._selectionCells,r=o.length,s=-1,l=r-1;0<=l;l--){var a=o[l];if(a.isAdded&&a.contains(e,t,n,i)){s=l;break}}if(-1===s)return!1;for(var u=s+1;u<r;u++){var h=o[u];if(!h.isAdded&&h.contains(e,t,n,i))return!1}return!0}},{key:"clear",value:function(){this._selectionCells=[],this._cells=[],this._maxBounds=null,this._needUpdateMaxBounds=!0,this._needUpdateCells=!0}},{key:"_cellToSelectionCell",value:function(e,t){return e instanceof et?(e.isAdded=t,e):new et(e.rowIndex,e.columnIndex,e.endRowIndex,e.endColumnIndex,t)}},{key:"_getMaxBounds",value:function(){if(this._needUpdateMaxBounds){var e,t=this._selectionCells.length;if(0<t){e=this._selectionCells[0].clone();for(var n,i=1;i<t;i++)(n=this._selectionCells[i]).isAdded&&(e.left=Math.min(e.left,n.left),e.right=Math.max(e.right,n.right),e.top=Math.min(e.top,n.top),e.bottom=Math.max(e.bottom,n.bottom))}else e=new S(0,0,0,0);this._maxBounds=e,this._needUpdateMaxBounds=!1}return this._maxBounds}},{key:"isRowMode",get:function(){return this.mode===tt||this.mode===nt}},{key:"isCellMode",get:function(){return"singleCell"===this.mode||this.mode===it}},{key:"isMultipleMode",get:function(){return this.mode===nt||this.mode===it}},{key:"isSingleSelection",get:function(){return 1===this._selectionCells.length&&this._selectionCells[0].isAdded}}]),t}(),rt={get selector(){var n=this;return this._selector||(this._selector=new ot(this),this._counter=new _e(function(e,t){return n._dispatchSelectionEvent("selection-changing",e,t,!0)},function(e,t){return n._dispatchSelectionEvent("selection-change",e,t,!1)})),this._selector},get hasSelectionMode(){return this.isRowSelectionMode||this.isCellSelectionMode},get isRowSelectionMode(){return this.selector.isRowMode},get isCellSelectionMode(){return this.selector.isCellMode},get isMultipleSelectionMode(){return this.selector.isMultipleMode},get isSingleSelection(){return this.selector.isSingleSelection},get selectionMode(){return this.selector.mode},set selectionMode(e){this.selector.mode=e},get selectedIndices(){return this.isRowSelectionMode?this.selector.getRows():[]},set selectedIndices(e){this.setSelectedIndices(e)},get selectedIndex(){var e=this.selectedIndices;return e&&0<e.length?e[0]:-1},set selectedIndex(e){this.selectedIndex!==e&&this.setSelectedIndices([e])},get selectedItems(){return this.indicesToItems(this.selectedIndices)},set selectedItems(e){var i=this;this.collection&&(this.selectedIndices=e.reduce(function(e,t){var n=i.collection.indexOf(t);return 0<=n&&e.push(n),e},[]))},get selectedItem(){var e=this.selectedItems;return e&&0<e.length&&e[0]||null},set selectedItem(e){e!==this.selectedItem&&(this.selectedItems=e&&[e]||[])},get selectedCells(){return this.selector.getCells()},set selectedCells(e){this.setSelectedCells(e)},get selectedCell(){var e=this.selectedCells;return e&&0<e.length&&e[0]||null},set selectedCell(e){this.selectedCell&&this.selectedCell.equals(e)||(e?this.setSelectedCells([e]):this.removeSelectedAll())},getSingleCell:function(){return this.selector.getSingleCell()},containsSelectedCell:function(e){return this.selector.containsCell(e)},containsSelectedPosition:function(e,t){return this.selector.containsBounds(t,e)},setSelectedIndices:function(e){var t=[];return e.forEach(function(e){t.push(new S(e,0))}),this.setSelectedCells(t)},addSelectedRow:function(e){return this.addSelectedCell(new S(e,0))},removeSelectedRow:function(e){return this.removeSelectedCell(new S(e,0))},setSelectedCell:function(e){if(this.isRowSelectionMode&&function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}(this.selectedIndices,function(e){for(var t=[],n=e.rowIndex;n<=e.endRowIndex;n++)t.push(n);return t}(e)))return!1;return this._executeSelectionFunction("setCell","set",e)},setSelectedCells:function(e){return this.isMultipleSelectionMode?this._executeSelectionFunction("setCells","set",e):this.setSelectedCell(Array.isArray(e)&&e[0])},addSelectedCell:function(e){return this.isMultipleSelectionMode?this._executeSelectionFunction("addCell","add",e):this.setSelectedCell(e)},removeSelectedCell:function(e){return this._executeSelectionFunction("removeCell","remove",e)},removeSelectedAll:function(){return this._executeSelectionFunction("removeAll","remove")},indicesToItems:function(e){if(this.collection){for(var t=e&&e.length||0,n=[],i=0;i<t;i++){var o=e[i],r=this.collection.get(o);r&&n.push(r)}return n}return null},clearSelection:function(){this.selector.clear()},collectionChangedForSelection:function(e){var t=e.detail;switch(t.kind){case"add":this._itemsAddedForSelection(t.index,t.items);break;case"remove":this._itemsRemovedForSelection(t.index,t.items)}},_executeSelectionFunction:function(e,t,n){var i=this.selector,o=this._counter;if(o.start(t,n)){var r=i[e].call(i,n);return o.end(t,n),this.invalidateFor(K.SELECTION_CHANGE),r}return o.cancel(),!1},_itemsAddedForSelection:function(e,t){this.selector.itemsAdded(e,t)},_itemsRemovedForSelection:function(e,t){this.selector.itemsRemoved(e,t)},_dispatchSelectionEvent:function(e,t,n,i){var o=Array.isArray(n)?n:n?[n]:[];return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:i,detail:{kind:t,cell:o[0]||null,cells:o}}))}};function st(e,t,n){e.splice(t,n.length)}function lt(e,t,n,i,o){for(var r=t&&t.length||0,s=[],l=0;l<r;++l){var a=t[l];if(!i&&n(a,e,t)&&(s.push(a),o))return s;var u=this.getChildren(a);if(u&&0<u.length&&0<(s=s.concat(lt.call(this,a,u,n,i,o))).length&&o)return s;if(i&&n(a,e,t)&&(s.push(a),o))return s}return s}var at="noParent",ut="parentToAbove",ht=function(e){f(i,pe);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this,!1)).nodeEventCounter=new _e(t.dispatchNodeEvent.bind(v(t))),t._rootNode=null,t._displayableNodes=[],t._openNodesMap=new Map,t._parentMap=new Map,t._childrenMap=new Map,t._childrenField="children",t._displayPolicy=ut,t.source=e||[],t}return c(i,[{key:"getParentNode",value:function(e){var t=this._internalGetParentNode(e);return t===this._rootNode&&(t=null),t}},{key:"getAncestorNodes",value:function(e){for(var t=[],n=this.getParentNode(e);n;)t.unshift(n),n=this.getParentNode(n);return t}},{key:"getDescendantNodes",value:function(t){return this.find(function(e){return t!==e},t)}},{key:"_internalGetParentNode",value:function(e){var t=this._parentMap.get(e);if(!t&&this._rootNode){var n=this.getNativeChildren(this._rootNode);if(n&&0<=n.indexOf(e))return null;this._addAllParentMapping(),t=this._parentMap.get(e)}return t}},{key:"getChildren",value:function(e){null==e&&(e=this._rootNode);var t=[];return this._childrenMap.has(e)||(e===this._rootNode||this.childrenField in e)&&(t=this.getNativeChildren(e),this._addChildrenMapping(e,t)),(t=this._childrenMap.get(e))||[]}},{key:"getNativeChildren",value:function(e){return e||(e=this._rootNode),e&&this.childrenField in e&&e[this.childrenField]||[]}},{key:"getDisplayableChildren",value:function(e){return this._internalGetDisplayableChildren(e,!1)}},{key:"getSiblingNodes",value:function(e){var t=this.getParentNode(e);return this.getChildren(t)}},{key:"getNodeIndex",value:function(e){return(this.getSiblingNodes(e)||[]).indexOf(e)}},{key:"_internalGetDisplayableChildren",value:function(t,n){var i=this,o=[];this.isOpenNode(t)&&this.getChildren(t).forEach(function(e){n&&i._addParentMapping(t,e),i._displayPolicy===at?i.isOpenNode(e)&&i.hasChildren(e)||o.push(e):i._displayPolicy===ut&&o.push(e),o=o.concat(i._internalGetDisplayableChildren(e,n))});return o}},{key:"hasChildren",value:function(e){var t=this.getChildren(e);return t&&0<t.length||!1}},{key:"addNode",value:function(e,t){var n=this.getNativeChildren(e),i=n&&n.length||0;return this.addNodeAt(e,t,i)}},{key:"addNodeAt",value:function(e,t,n){return this.addNodesAt(e,[t],n)}},{key:"addNodes",value:function(e,t){var n=this.getNativeChildren(e);return this.addNodesAt(e,t,n.length)}},{key:"addNodesAt",value:function(e,t,n){if(!t||t.length<=0)return!1;var i,o;this.nodeEventCounter.start(),e||(e=this._rootNode),n=Math.max(n,0),i=e,o=this.childrenField,!i||o in i||(i[o]=[]);var r=this.getChildren(e),s=this.getNativeChildren(e),l=s&&s.length||0,a=t.length;if(r!==s){var u=r[n];(n=s.indexOf(u))<0&&(n=l)}n=Math.min(n,l),this._internalCloseNode(e);for(var h=0;h<a;h++){var c=t[h];this._removeParentMapping(c),s.splice(n+h,0,c),this._addParentMapping(e,c)}return this._removeChildrenMapping(e),this._internalOpenNode(e,!0),this.nodeEventCounter.end("add",!1,!1,t,e),!0}},{key:"moveNode",value:function(t,e,n){if(this.getAncestorNodes(e).find(function(e){return e===t}))return!1;var i=this.getParentNode(t);return!!this.dispatchNodeEvent("moving",!1,!0,[t],i,{toParent:e,toIndex:n})&&(this.nodeEventCounter.start(),this.removeNode(i,t),this.addNodeAt(e,t,n),this.nodeEventCounter.end("move",!1,!1,[t],i,{toParent:e,toIndex:n}),!0)}},{key:"removeNode",value:function(e,t){var n=this;e||(e=this._rootNode);var i=this.getNativeChildren(e),o=i?i.indexOf(t):-1;if(o<0)return!1;this.nodeEventCounter.start();var r=this.find(function(e){return!0},t);return this._internalCloseNode(e),this._removeChildrenMapping(e),r&&r.forEach(function(e){n._removeOpenNodeMapping(e),n._removeChildrenMapping(e),n._removeParentMapping(e)}),i.splice(o,1),this._internalOpenNode(e,!0),this.nodeEventCounter.end("remove",!1,!1,[t],e),!0}},{key:"removeNodes",value:function(t,e){var n=this;if(e){this.nodeEventCounter.start();var i=[];if(e.forEach(function(e){n.removeNode(t,e)&&i.push(e)}),0<i.length)return this.nodeEventCounter.end("remove",!1,!1,i,t),!0;this.nodeEventCounter.cancel()}return!1}},{key:"contains",value:function(t){return!!this.findOne(function(e){return t===e})}},{key:"containsAll",value:function(i){return!((i&&i.length||0)<=0)&&(i=i.slice(0),this.find(function(e,t){var n=i.indexOf(e);0<=n&&i.splice(n,1)}),0===i.length)}},{key:"isOpenNode",value:function(e){return e===this._rootNode||this._openNodesMap.has(e)}},{key:"isDisplayableNode",value:function(e){for(var t=e;t;){if(!this.isOpenNode(t))return!1;t=this.getParentNode(t)}return!0}},{key:"openNode",value:function(e){if(null!==e&&!this.isOpenNode(e)){var t=this.getParentNode(e);if(this.dispatchNodeEvent("expanding",!1,!0,[e],t))return this._addOpenNodeMapping(e),this._internalOpenNode(e,!0),this.dispatchNodeEvent("expand",!1,!1,[e],t),!0}return!1}},{key:"_internalOpenNode",value:function(e,t){if(this.isDisplayableNode(e)){var n=this._internalGetDisplayableChildren(e,!0);if(n&&0<n.length){var i=this._displayableNodes,o=e===this._rootNode?i.length:i.indexOf(e);0<=o&&(r=i,s=o+=1,l=n,Array.prototype.splice.apply(r,[s,0].concat(l)),t&&this.dispatchCollectionEvent("add",n,o),this._displayPolicy===at&&e&&e!==this._rootNode&&(st(i,o-1,[e]),this.dispatchCollectionEvent("remove",[e],o-1)))}}var r,s,l}},{key:"closeNode",value:function(e){if(null!==e&&this.isOpenNode(e)){var t=this.getParentNode(e);if(this.dispatchNodeEvent("collapsing",!1,!0,[e],t))return this._internalCloseNode(e),this._removeOpenNodeMapping(e),this.dispatchNodeEvent("collapse",!1,!1,[e],t),!0}return!1}},{key:"_internalCloseNode",value:function(e){if(this.isDisplayableNode(e)){var t=this._internalGetDisplayableChildren(e,!1);if(t&&0<t.length){var n=this._displayableNodes.indexOf(t[0]);0<=n&&(st(this._displayableNodes,n,t),this.dispatchCollectionEvent("remove",t,n))}}}},{key:"openNodes",value:function(e){var t,n,i=e&&e.length;for(this._openNodesMap.clear(),n=0;n<i;n++)t=e[n],this._addOpenNodeMapping(t);this._resetDisplayableNodes(),this._active=this._displayableNodes,this.dispatchCollectionEvent("refresh")}},{key:"getOpenedNodes",value:function(){var n=[];return this._openNodesMap.forEach(function(e,t){n.push(t)}),n}},{key:"getNodeLevel",value:function(e){if(null==e)return-1;for(var t=-1,n=this._internalGetParentNode(e);n;)n=this._internalGetParentNode(n),t++;return t}},{key:"getNodeDepth",value:function(e){return(e?[e]:this.toArray()).reduce(function(e,t){return Math.max(e,function t(e){var n=1;return e&&e.children&&e.children.forEach(function(e){n=Math.max(n,t(e)+1)}),n}(t))},1)}},{key:"forEach",value:function(i){var o=this;this.find(function(e,t,n){i.call(o,e,t,n)})}},{key:"find",value:function(e,t,n){if(this.source&&e){var i=t&&this.getParentNode(t)||null,o=t&&[t]||this.getNativeChildren(i);return lt.call(this,i,o,e,n,!1)}return[]}},{key:"findOne",value:function(e,t,n){if(this.source&&e){var i=t&&this.getParentNode(t)||null,o=t&&[t]||this.getNativeChildren(i),r=lt.call(this,i,o,e,n,!0);if(r&&0<r.length)return r[0]}return null}},{key:"expandAll",value:function(){this.openNodes(this._getParentsInNodes(this.getNativeChildren(null)))}},{key:"collapseAll",value:function(){this.openNodes([])}},{key:"_resetDisplayableNodes",value:function(){this._displayableNodes=[],this._internalOpenNode(this._rootNode,!1)}},{key:"_internalRefresh",value:function(){var e,t,n;this._openNodesMap.clear(),this._parentMap.clear(),this._childrenMap.clear(),this._rootNode=(e=this.source,t=this.childrenField,(n=Object.create({__ROOT_NODE__:!0}))[t]=e,n),this._resetDisplayableNodes(),this._active=this._displayableNodes}},{key:"_getParentsInNodes",value:function(e){var t,n,i,o=e&&e.length||0,r=[];for(i=0;i<o;i++)t=e[i],(n=this.getChildren(t))&&0<n.length&&(r.push(t),r=r.concat(this._getParentsInNodes(n)));return r}},{key:"_addOpenNodeMapping",value:function(e){this._openNodesMap.set(e,!0)}},{key:"_removeOpenNodeMapping",value:function(e){this._openNodesMap.delete(e)}},{key:"_addAllParentMapping",value:function(){var n=this;this._lockAllParentMapping||(this._lockAllParentMapping=!0,this.find(function(e,t){t||(t=n._rootNode),n._addParentMapping(t,e)},null,!1),this._lockAllParentMapping=!1)}},{key:"_addParentMapping",value:function(e,t){this._parentMap.set(t,e),e||console.warn("HierarchyList._addParentMapping !!!",t)}},{key:"_removeParentMapping",value:function(e){this._parentMap.delete(e)}},{key:"_addChildrenMapping",value:function(e,t){this._childrenMap.set(e,t)}},{key:"_removeChildrenMapping",value:function(e){this._childrenMap.delete(e)}},{key:"dispatchNodeEvent",value:function(e,t,n,i,o){var r=d({collection:this,kind:e,nodes:i,parent:o},5<arguments.length&&void 0!==arguments[5]?arguments[5]:null);return this.dispatchEvent(new CustomEvent("node-change",{bubbles:t,cancelable:n,detail:r}))}},{key:"displayableNodes",get:function(){return this._displayableNodes}},{key:"childrenField",get:function(){return this._childrenField},set:function(e){this._childrenField!==e&&(this._childrenField=e,this._reset())}},{key:"displayPolicy",get:function(){return this._displayPolicy},set:function(e){this._displayPolicy!==e&&(this._displayPolicy=e,this.reset())}}]),i}(),ct=function(e){f(o,ht);var i=g(o);function o(e){var t;h(this,o),(t=i.call(this,e))._leafColumnsMap=new Map;var n=t._onCollectionChange.bind(v(t));return t.addEventListener("collection-change",n),t.addEventListener("node-change",n),t}return c(o,[{key:"updateColumns",value:function(){this.source&&this.source.forEach(function(e){e.updateChildren()})}},{key:"getLeafColumns",value:function(e){return x(e)}},{key:"getVisibleLeafColumns",value:function(e){var t=this._leafColumnsMap.get(e);return t||(t=x(e).filter(function(e){return e.visible}),this._leafColumnsMap.set(e,t)),t||[]}},{key:"clearCache",value:function(){this._leafColumnsMap=new Map}},{key:"_onCollectionChange",value:function(e){var t=e.type,n=e.detail.kind;"collection-change"===t&&"reset"===n?this.clearCache():"node-change"!==t||"move"!==n&&"remove"!==n&&"add"!==n||this.clearCache()}}]),o}(),dt=128,ft=127,vt=function(){function n(e,t){h(this,n),this._index=e,this._itemFactory=t,this._items=new Array(dt),this._total=0,this._empty=dt}return c(n,[{key:"getTotal",value:function(){return this._total}},{key:"getItem",value:function(e){return this._items[e]}},{key:"addSize",value:function(e,t){var n=this.getSize(ft);this._items.splice(e,0,null),null!=t&&this.setSize(e,t),this._total-=n||0,this._items.length=dt}},{key:"removeSize",value:function(e){var t=this.getSize(e);return this._items.splice(e,1),null!=t&&(this._total-=t||0,this._empty=Math.min(dt,this._empty+1)),t}},{key:"getSize",value:function(e){var t=this._items[e];if(t)return t.value}},{key:"setSize",value:function(e,t){var n=this.getItem(e);n||(n=this._itemFactory(),this._items[e]=n,this._empty--);var i=n.value||0;return n.value=t,this._total+=t-i,n}},{key:"empty",get:function(){return this._empty}}]),n}(),gt=function(){function e(){h(this,e),this._defaultSize=30,this._blocks=[],this._gap=0,this._maxIndex=-1}return c(e,[{key:"clear",value:function(){this._blocks=[],this._maxIndex=-1}},{key:"setSize",value:function(e,t){var n=e>>7,i=e&ft,o=this._getBlock(n),r=this.getSize(e);return o.setSize(i,t),this._maxIndex=Math.max(e,this._maxIndex),r!==t}},{key:"getSize",value:function(e){return this.getItemValue(this.getItem(e))}},{key:"indexOf",value:function(e){for(var t,n=0,i=0,o=n>>7,r=n&ft,s=this._getBlock(o),l=0,a=0;i<e&&(t=s.getItem(r),!(e<i+(a=this.getItemValue(t)+this.gap)));){if(i+=a,dt<=++r){for(r=0,o+=1,l=this._getBlockTotalAt(o);l+i<e;)i+=l,n+=dt,o+=1,l=this._getBlockTotalAt(o);s=this._getBlock(o)}n++}return n}},{key:"getTotal",value:function(e,t){e=e||0,t=null!=t?t:this.length-1;for(var n,i=0,o=e;o<=t;){for(;0==(o&ft)&&o+dt<t;)n=o>>7,i+=this._getBlockTotalAt(n),o+=dt;i+=this.getSize(o)+this.gap,o++}return 0<t&&(i-=this.gap),i}},{key:"addSize",value:function(e,t){for(var n,i,o=this._blocks,r=o&&o.length||0,s=e&ft,l=e>>7;l<r;l++)i=(n=this._getBlock(l)).removeSize(ft),n.addSize(s,t),t=i,s=0;null!=i&&(n=this._getBlock(r)).addSize(0,i),this.length++,this._maxIndex++}},{key:"removeSize",value:function(e){var t,n,i,o=this._blocks,r=o&&o.length||0,s=e>>7,l=e&ft,a=null;for((n=this._getBlock(s)).removeSize(l),t=r-1;s<=t;t--)n=this._getBlock(t),t!==s&&(i=n.removeSize(0)),null!=a&&n.setSize(ft,a),a=i;this.length--,this._maxIndex--}},{key:"getItem",value:function(e){var t=e>>7,n=e&ft;return 0<=t&&t<this._blocks.length?this._getBlock(t).getItem(n):null}},{key:"getItemValue",value:function(e){return e&&!isNaN(e.value)?e.value:this.defaultSize}},{key:"_createBlock",value:function(e){return new vt(e,this.itemFactory)}},{key:"_getBlock",value:function(e){var t=this._blocks[e];return t||(t=this._blocks[e]=this._createBlock(e)),t}},{key:"_getBlockTotal",value:function(e){return e.getTotal()+e.empty*this.defaultSize+this.gap*dt}},{key:"_getBlockTotalAt",value:function(e){return this._getBlockTotal(this._getBlock(e))}},{key:"itemFactory",get:function(){return function(){return{value:0}}}},{key:"gap",get:function(){return this._gap},set:function(e){this._gap=e}},{key:"defaultSize",get:function(){return this._defaultSize},set:function(e){e!==this._defaultSize&&(this._defaultSize=e,this.clear())}},{key:"maxIndex",get:function(){return this._maxIndex}},{key:"length",get:function(){return Math.max(0<this._length?this._length:this._maxIndex+1,0)},set:function(e){this._length!==e&&(this._length=e,this._length<=this._maxIndex&&(this._maxIndex=this._length-1))}}]),e}();var mt=function(e){f(n,gt);var t=g(n);function n(e){return h(this,n),t.call(this)}return c(n,[{key:"getMaxCellHeight",value:function(e){var t=this.getItem(e);return t&&t.maxCellHeight||0}},{key:"setCellHeight",value:function(e,t,n){if(isNaN(n))return!1;var i=this.getItem(e);i||(this.setSize(e,this.defaultSize),i=this.getItem(e));var o=i.cellHeights;return o[t]!==n&&(o[t]=n,this._updateMaxCellHeight(i),!0)}},{key:"insertColumns",value:function(e,t){for(var n=this.length,i=Array.prototype.splice,o=function(e){for(var t=[];0<e--;)t.push(0);return t}(t),r=0;r<n;r++){var s=this.getItem(r),l=s.cellHeights;l.length<e&&(l.length=e),i.apply(l,[e,0].concat(o)),this._updateMaxCellHeight(s)}}},{key:"removeColumns",value:function(e,t){var n,i,o=this.length;for(i=0;i<o;i++)(n=this.getItem(i)).cellHeights.splice(e,t),this._updateMaxCellHeight(n)}},{key:"_updateMaxCellHeight",value:function(e){e.maxCellHeight=e.cellHeights.reduce(function(e,t){return t<e?e:t})}},{key:"itemFactory",get:function(){return function(){return{value:0,cellHeights:[],maxCellHeight:0}}}}]),n}(),_t=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;h(this,n),this._dimension=e,this._cells=[],this._layout=null,this._height=0,this._index=t}return c(n,[{key:"setIndex",value:function(e){this._index=e}},{key:"setCells",value:function(e){return this._cells=e,this}},{key:"setHeight",value:function(e){return this._height=e,this}},{key:"setLayout",value:function(e){return this._layout=e,this}},{key:"getCellAt",value:function(e){var t=this.columnIndices.indexOf(e);return 0<=t?this._cells[t]:null}},{key:"takeCellAt",value:function(e){var t=this.columnIndices.indexOf(e);if(0<=t){var n=this._cells[t];return this._cells[t]=null,n}return null}},{key:"index",get:function(){return this._index}},{key:"columnIndices",get:function(){return this._dimension.isColumnChanging?this._dimension.oldColumnIndices:this._dimension.columnIndices}},{key:"cells",get:function(){return this._cells}},{key:"layout",get:function(){return this._layout}},{key:"height",get:function(){return this._height}}]),n}();function yt(e,t,n,i,o){var r=e[t],s=e[e.length-1-n],l=e.indexOf(i),a=e.indexOf(o),u=i;l<0&&(u=s<=i?0<n?e[e.length-n]:0<=a?o:s:r);var h=o;return a<0&&(h=o<r?0<t?e[t-1]:0<=l?i:r:s),[u,h]}function pt(e,t,n,i){return!(i<e||t<n)}function Ct(e,t,n,i,o){return!!(0<t&&pt(i,o,e[0],e[t-1]))||(!!(0<n&&pt(i,o,e[e.length-n],e[e.length-1]))||!!pt(i,o,e[t],e[e.length-n-1]))}var kt=function(){function t(e){h(this,t),this.dataGroup=e,this.columnLinearVector=new gt,this.rowLinearVector=new mt,this._columnIndices=[],this._columnLayouts=[],this._oldColumnIndices=null,this._rows=[],this._rowIndices=[],this._mergeCells=[],this._mergeCellPositions=[],this._mergeCellLayouts=[],this._pendingRows=null,this._pendingIndices=null,this._pendingMergeCellPositions=null,this._visibleFrozenIndexRect=new R,this._visibleFrozenSizeRect=new R}return c(t,[{key:"getRowDefaultHeight",value:function(){return this.rowLinearVector.defaultSize}},{key:"setRowDefaultHeight",value:function(e){this.rowLinearVector.defaultSize=e}},{key:"setRowSize",value:function(e){this.rowLinearVector.length=e}},{key:"createRow",value:function(e){return new _t(this,e)}},{key:"getRow",value:function(e){var t=this._rowIndices.indexOf(e);return 0<=t?this._rows[t]:null}},{key:"getRowIndexOf",value:function(e){var t=this._rows.indexOf(e);return 0<=t?this._rowIndices[t]:null}},{key:"setRow",value:function(e,t,n){for(var i=this._pendingIndices||this._rowIndices,o=this._pendingRows||this._rows,r=0,s=i.length;r<s&&!(e<i[r]);r++);i.splice(r,0,e),o.splice(r,0,t),this.rowLinearVector.setSize(e,n)}},{key:"takeRow",value:function(e){var t=this._rowIndices.indexOf(e);return 0<=t?(this._rowIndices.splice(t,1),this._rows.splice(t,1)[0]):null}},{key:"insertRow",value:function(n,e,t){var i=this._rowIndices;return i.forEach(function(e,t){n<=e&&(i[t]=e+1)}),this.rowLinearVector.addSize(n,t),this.setRow(n,e,t),!0}},{key:"removeRow",value:function(n){var e=this.takeRow(n),i=this._rowIndices;return this.rowLinearVector.removeSize(n),i.forEach(function(e,t){n<=e&&(i[t]=e-1)}),e}},{key:"insertColumn",value:function(n){var i=this._columnIndices;i.forEach(function(e,t){n<=e&&(i[t]=e+1)})}},{key:"removeColumn",value:function(n){var i=this._columnIndices,t=i.indexOf(n),o=[];return 0<=t&&(i.splice(t,1),this._rows.forEach(function(e){Array.prototype.push.apply(o,e.cells.splice(t,1))}),this._columnLayouts.splice(t,1),i.forEach(function(e,t){n<=e&&(i[t]=e-1)})),o}},{key:"createCell",value:function(e,t,n){return new je(e,t,n)}},{key:"getCell",value:function(e,t){var n=this._rowIndices.indexOf(e);return 0<=n?this._rows[n].getCellAt(t):null}},{key:"getMergeCell",value:function(e){var t=this._mergeCellPositions.indexOf(e);return 0<=t?this._mergeCells[t]:null}},{key:"removeMergeCellPosition",value:function(e){var t=this._mergeCellPositions.indexOf(e);return 0<=t?(this._mergeCellPositions.splice(t,1),this._mergeCellLayouts.splice(t,1),this._mergeCells.splice(t,1)[0]):null}},{key:"hasPendingMergeCellPosition",value:function(e){return 0<=(this._pendingMergeCellPositions||[]).indexOf(e)}},{key:"setMergeCell",value:function(e,t){var n=this._pendingMergeCellPositions||this._mergeCellPositions,i=this._pendingMergeCells||this._mergeCells;n.push(e),i.push(t)}},{key:"getRowLayout",value:function(e){var t=this._rowIndices.indexOf(e);return 0<=t?this._rows[t].layout:null}},{key:"getColumnLayout",value:function(e){var t=this._columnIndices.indexOf(e);return 0<=t?this._columnLayouts[t]:null}},{key:"getColumnLayouts",value:function(e,t){if(e===t)return this.getColumnLayout(e);var n=this._visibleFrozenIndexRect;if(!Ct(this._columnIndices,n.left,n.right,e,t))return null;var i=yt(this._columnIndices,n.left,n.right,e,t),o=this.getColumnLayout(i[0]),r=this.getColumnLayout(i[1]);return{x:this.getColumnX(e),width:this.getColumnsWidth(e,t),sx:o.sx+this.getColumnsWidth(e,i[0]-1),sw:r.dx+r.dw-o.dx,dx:o.dx,dw:r.dx+r.dw-o.dx}}},{key:"getCellLayout",value:function(e,t){var n=this.getRowLayout(e),i=this.getColumnLayout(t);if(n&&i){var o=d(d({},n),i);return delete o.index,o}return null}},{key:"getCellLayoutByCellPosition",value:function(e){if(!e.isMerged)return this.getCellLayout(e.rowIndex,e.columnIndex);var t=this._mergeCellPositions.indexOf(e);return 0<=t?this._mergeCellLayouts[t]:null}},{key:"calculateCellLayoutByCellPosition",value:function(e){var t=e.rowIndex,n=e.columnIndex,i=e.endRowIndex,o=e.endColumnIndex;if(!e.isMerged)return this.getCellLayout(t,n);var r=this._visibleFrozenIndexRect,s=yt(this._rowIndices,r.top,r.bottom,t,i),l=yt(this._columnIndices,r.left,r.right,n,o),a=this.getRowLayout(s[0]),u=this.getRowLayout(s[1]),h=this.getColumnLayout(l[0]),c=this.getColumnLayout(l[1]);return{x:this.getColumnX(n),y:this.getRowY(n),width:this.getColumnsWidth(n,o),height:this.getRowsHeight(t,i),sx:h.sx+this.getColumnsWidth(n,l[0]-1),sy:a.sy+this.getRowsHeight(t,s[0]-1),sw:c.dx+c.dw-h.dx,sh:u.dy+u.dh-a.dy,dx:h.dx,dy:a.dy,dw:c.dx+c.dw-h.dx,dh:u.dy+u.dh-a.dy}}},{key:"isVisibleRow",value:function(e){return 0<=this._rowIndices.indexOf(e)}},{key:"isVisibleColumn",value:function(e){return 0<=this._columnIndices.indexOf(e)}},{key:"isVisiblePosition",value:function(e,t){return this.isVisibleRow(e)&&this.isVisibleColumn(t)}},{key:"isVisibleCell",value:function(e){var t=e.rowIndex,n=e.columnIndex,i=e.endRowIndex,o=e.endColumnIndex,r=this._visibleFrozenIndexRect,s=Ct(this._rowIndices,r.top,r.bottom,t,i),l=Ct(this._columnIndices,r.left,r.right,n,o);return s&&l}},{key:"getCellsByRow",value:function(e){var t=this._rowIndices.indexOf(e);return 0<=t?this._rows[t].cells:[]}},{key:"getCellsByColumn",value:function(e){var t=this._columnIndices.indexOf(e);return 0<=t?this._rows.map(function(e){return e.cells[t]}):[]}},{key:"forEachRowLayouts",value:function(n){var i=this;this._rows.forEach(function(e,t){return n(e.layout,i._rowIndices[t],e)})}},{key:"forEachColumnLayouts",value:function(n){var i=this;this._columnLayouts.forEach(function(e,t){return n(e,i._columnIndices[t])})}},{key:"forEachCellLayouts",value:function(e){for(var t=this._rowIndices.length,n=this._columnIndices.length,i=0;i<t;i++)for(var o=this._rowIndices[i],r=this._rows[i],s=r.layout,l=r.cells,a=0;a<n;a++){var u=this._columnIndices[a],h=this._columnLayouts[a],c=l[a];e(d(d({},s),h),o,u,c)}}},{key:"forEachMergeCellLayouts",value:function(n){var i=this;this._mergeCellLayouts.forEach(function(e,t){n(e,i._mergeCellPositions[t])})}},{key:"updateStart",value:function(){this._isUpdating=!0,this._pendingRows=[],this._pendingIndices=[],this._pendingMergeCellPositions=[],this._pendingMergeCellLayouts=[],this._pendingMergeCells=[]}},{key:"updateEnd",value:function(){var t=this;this._isUpdating=!1;var e=this._rows,n=this._mergeCells;return this._rows=this._pendingRows,this._rowIndices=this._pendingIndices,this._mergeCellPositions=this._pendingMergeCellPositions,this._mergeCells=this._pendingMergeCells,this._pendingRows=null,this._pendingIndices=null,this._pendingMergeCellPositions=null,this._pendingMergeCells=null,this._mergeCellLayouts=this._mergeCellPositions.map(function(e){return t.calculateCellLayoutByCellPosition(e)}),this._mergeCells=this._mergeCells.map(function(e){return e instanceof Function?e():e}),this._oldColumnIndices=null,{rows:e,mergeCells:n}}},{key:"clear",value:function(){this._columnIndices=[],this._columnLayouts=[],this._rows=[],this._rowIndices=[],this._mergeCells=[],this._mergeCellPositions=[],this._mergeCellLayouts=[],this._visibleFrozenIndexRect=new R,this._visibleFrozenSizeRect=new R}},{key:"getColumnX",value:function(e){return this.columnLinearVector.getTotal(0,e-1)}},{key:"getColumnIndexByDistance",value:function(e){return this.columnLinearVector.indexOf(e)}},{key:"getColumnWidth",value:function(e){return this.columnLinearVector.getSize(e)}},{key:"setColumnWidth",value:function(e,t){return this.getColumnWidth(e)!==t&&(this.columnLinearVector.setSize(e,t),!0)}},{key:"getColumnsWidth",value:function(e,t){return e<0||t<0||null==e?0:this.columnLinearVector.getTotal(e,t)}},{key:"getRowY",value:function(e){return this.rowLinearVector.getTotal(0,e-1)}},{key:"getRowIndexByDistance",value:function(e){return this.rowLinearVector.indexOf(e)}},{key:"getRowHeight",value:function(e){return this.rowLinearVector.getSize(e)}},{key:"getRowsHeight",value:function(e,t){return this.rowLinearVector.getTotal(e,t)}},{key:"setRowHeight",value:function(e,t){return this.rowLinearVector.setSize(e,t)}},{key:"setCellHeight",value:function(e,t,n){return this.rowLinearVector.setCellHeight(e,t,n)}},{key:"getColumnsTotal",value:function(){return this.columnLinearVector.getTotal()}},{key:"getRowsTotal",value:function(){return this.rowLinearVector.getTotal()}},{key:"updateTypicalColumnSizes",value:function(){var n=this,e=this.dataGroup.normalizedColumns;this.columnLinearVector.clear(),this.columnLinearVector.length=e.length,e.forEach(function(e){var t=e.visible?L(e.width||0,e.minWidth):0;n.columnLinearVector.setSize(e.index,t)})}},{key:"updateVisibleFrozenIndexRect",value:function(){for(var e=this.dataGroup,t=e.normalizedColumns,n=e.frozenLeft,i=e.frozenRight,o=e.frozenTop,r=e.frozenBottom,s=t.length,l=new R,a=0,u=0;u<n&&u<s;u++){t[u].visible&&a++}l.left=a,a=0;for(var h=Math.max(0,s-i);h<s;h++){t[h].visible&&a++}l.right=a,l.top=o,l.bottom=r,this._visibleFrozenIndexRect=l}},{key:"updateVisibleFrozenSizeRect",value:function(){var e=this.dataGroup,t=e.normalizedColumns,n=e.frozenLeft,i=e.frozenRight,o=e.frozenTop,r=e.frozenBottom,s=t.length,l=this.dataGroup.numRows;this._visibleFrozenSizeRect.top=this.getRowsHeight(0,o-1),this._visibleFrozenSizeRect.bottom=this.getRowsHeight(l-r,l-1),this._visibleFrozenSizeRect.left=this.getColumnsWidth(0,n-1),this._visibleFrozenSizeRect.right=this.getColumnsWidth(s-i,s-1)}},{key:"updateVisibleColumns",value:function(e){var n=this,t=this.dataGroup,i=t.normalizedColumns,o=t.clientWidth,r=t.scrollLeft,s=t.frozenLeft,l=t.frozenRight;this.updateVisibleFrozenIndexRect();var a=!1;if(e){for(var u=this.columnLinearVector.defaultSize,h=i.length,c=[],d=[],f=function(e){var t;return e.visible?(isNaN(e.width)?(t=L(u,e.minWidth),d.push(e.index)):t=L(e.width,e.minWidth),c.push(e.index)):t=0,n.columnLinearVector.setSize(e.index,t),t},v=0,g=0,m=0;m<s&&m<h;m++){var _=f(i[m]);v+=_,g+=_}for(var y=Math.max(0,h-l);y<h;y++){var p=i[y];if(c.indexOf(p.index)<0)v+=f(p)}var C=this.getColumnIndexByDistance(g+r);v+=this.getColumnX(C)-g-r;for(var k=C;k<h-l&&v<o;k++){v+=f(i[k])}if(r<=0&&v<o&&0<d.length)for(var w,x=o-1,b=0;v<x-1&&0<d.length;){0===b&&(w=Math.floor((x-v)/d.length));var E=d[b],I=this.getColumnWidth(E),R=I+Math.min(x-v,w);this.columnLinearVector.setSize(E,R),v+=(R=this.getColumnWidth(E))-I,I===R&&d.splice(b,1),b=b<d.length-1?b+1:0}c=c.sort(de),(this._columnIndices.length!==c.length||this._columnIndices.some(function(e,t){return e!==c[t]}))&&(this._oldColumnIndices=this._columnIndices,this._columnIndices=c,a=!0)}return this.updateVisibleColumnLayouts(),a}},{key:"updateVisibleColumnLayouts",value:function(){var l=this,e=this.dataGroup.clientWidth,a=this.dataGroup.scrollLeft,t=this._visibleFrozenIndexRect,n=this._columnIndices,u=n.length,h=t.left,c=u-t.right-1,d=0<t.left?this.getColumnsWidth(0,n[h-1]):0,i=0<t.right?this.getColumnsWidth(n[c+1]):0,f=e-(d+i),v=0<t.left?this.getColumnX(n[t.left-1]+1):0,g=0<t.right?this.getColumnX(n[c+1]):0,m=0,_=0;this._columnLayouts=n.map(function(e,t){var n=l.getColumnX(e),i=l.getColumnWidth(e),o=0,r=i,s=m;return t===h?(r=i-(o=a-(l.getColumnX(e)-d)),_=n):t===c&&t<u&&(o=0,r=d+f-m),t===h?_=v:t===c+1&&(_=g),m+=r,{index:e,baseX:_,x:n,width:i,sx:o,sw:r,dx:s,dw:r}})}},{key:"columnIndices",get:function(){return this._columnIndices}},{key:"columnLayouts",get:function(){return this._columnLayouts}},{key:"oldColumnIndices",get:function(){return this._oldColumnIndices}},{key:"mergeCellLayouts",get:function(){return this._mergeCellLayouts}},{key:"rows",get:function(){return this._rows}},{key:"rowIndices",get:function(){return this._rowIndices}},{key:"mergeCellPositions",get:function(){return this._mergeCellPositions}},{key:"mergeCells",get:function(){return this._mergeCells}},{key:"cells",get:function(){return this._rows.reduce(function(e,t){return e=e.concat(t.cells)},[])}},{key:"visibleFrozenIndexRect",get:function(){return this._visibleFrozenIndexRect}},{key:"visibleFrozenSizeRect",get:function(){return this._visibleFrozenSizeRect}},{key:"firstColumnIndex",get:function(){return 0<this._columnIndices.length?this._columnIndices[0]:-1}},{key:"lastColumnIndex",get:function(){return 0<this._columnIndices.length?this._columnIndices[this._columnIndices.length-1]:-1}},{key:"isColumnChanging",get:function(){return!!this._oldColumnIndices}}]),t}(),wt="#",xt="74616368796f6e6c6963-6c6f636174696f6e-686f73746e616d65",bt="7777772E78656E6F696D706163742E636F6D",Et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",It=window,Rt=-1;function Lt(e,t){if(e){for(var n,i=e&&e.length||0,o=0,r="";o<i;)n=e.substr(o,2),r+=n=String.fromCharCode(parseInt(n.toString(t),t)),o+=2;return r}return null}var St=function(e){for(var t=bt.split(String.fromCharCode(45)),n=[],i=0;i<t.length;i++)n[i]=Lt(t[i],16);return n[0]}(),Mt=function(e){for(var t=xt.split(String.fromCharCode(45)),n=[],i=0;i<t.length;i++)n[i]=Lt(t[i],16);return n}();function Dt(e){var o=Mt[0];return function(e,t){"string"==typeof e&&(e=e.split(""));var n,i=e&&e.length||0,o=[];for(n=0;n<i;n++)o.push(t(e[n],n));return o}(function(e){var t,n,i,o,r,s,l=0,a=[];if(!e)return e;for(e+="";t=(s=Et.indexOf(e.charAt(l++))<<18|Et.indexOf(e.charAt(l++))<<12|(o=Et.indexOf(e.charAt(l++)))<<6|(r=Et.indexOf(e.charAt(l++))))>>16&255,n=s>>8&255,i=255&s,a.push(t),64!==o&&(a.push(n),64!==r&&a.push(i)),l<e.length;);return a}(e),function(e,t){return String.fromCharCode(e^(i=t,(n=o).charCodeAt(Math.floor(i%n.length))));var n,i}).join("")}function Nt(e,t,n){(function(){if(-1===Rt){Rt=!1;try{var e=(""+It[Mt[1]][Mt[2]]).toLowerCase(),t=Dt(It[Mt[0]]).split(wt)||[],n=(t[0],(t[1]||"").toLowerCase());e&&n&&0<=n.indexOf(e)&&(Rt=!0)}catch(e){Rt=-2}}return Rt})()||(e.save(),e.font="20px Arial",e.color="#000000",e.textBaseline="bottom",e.textAlign="right",e.strokeText(St,t-10,n-10),e.restore())}var Pt=new S,Ot=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};h(this,t),this.data=e}return c(t,[{key:"union",value:function(e){for(var t in e){var n=e[t];Array.isArray(n)?(this.data[t]||(this.data[t]=[]),this.data[t]=this.data[t].concat(n)):n&&"object"===a(n)||(this.data[t]=n)}return this.data}},{key:"get",value:function(e){return this.data[e]}}]),t}();function Gt(){return document.createElement("canvas").getContext("2d")}function Ht(e,t,n){return e.isMerged&&(e.contains(n,t)||e instanceof Ze&&e.containsCross(n,t))}var Tt=function(e){f(i,ze);var n=g(i);function i(e){var t;return h(this,i),(t=n.call(this,e))._dimensions=new kt(v(t)),t._normalizedColumns=[],t._bufferContexts=[],t._backgroundLayer=t._addLayer(new Ae("background")),t._selectionLayer=t._addLayer(new Ae("selection")),t._rendererLayer=t._addLayer(new We("renderer")),t._separatorLayer=t._addLayer(new Ae("separator")),t._needGeneratedColumns=!0,t._frozenLeft=0,t._frozenRight=0,t._frozenTop=0,t._frozenBottom=0,t._itemRenderer=ce.itemRenderer||Pe,t._nullItemRenderer=ce.nullItemRenderer||De,t._useNullItemRenderer=!1,t._autoRowHeight=!1,t._maxRowCount=-1,t._rowCount=-1,t._cacheStyle=null,t._boundCollectionChange=t._onCollectionChange.bind(v(t)),t._boundColumnCollectionChange=t._onColumnCollectionChange.bind(v(t)),t._boundDocumentMouseMove=t._onDocumentMouseMove.bind(v(t)),t._boundDocumentMouseUp=t._onDocumentMouseUp.bind(v(t)),t.rowHeight=30,t.overRowIndex=-1,t.overColumnIndex=-1,t.overCell=null,t.anchorRowIndex=-1,t.anchorColumnIndex=-1,t.autoMerge=!1,t._oldScrollLeft=0,t._oldScrollTop=0,t.options={clipMode:"clip",hiddenElementMode:"none",mergeMode:"lazy",alwaysShowMergeCell:!0},t.addEventListener("mousedown",t._onMouseDown.bind(v(t))),t.addEventListener("mousemove",t._onMouseMove.bind(v(t))),t.addEventListener("mouseenter",t._onMouseEnter.bind(v(t))),t.addEventListener("mouseleave",t._onMouseLeave.bind(v(t))),t}return c(i,[{key:"_itemRendererChanged",value:function(){this.clearCache(),this.invalidateFor(K.ALL)}},{key:"_frozenCountChanged",value:function(e){this.invalidateFor(K.ALL)}},{key:"_setColumnCollection",value:function(e){var t=this,n=["collection-change","node-change"],i=this._boundColumnCollectionChange;this._columnCollection&&n.forEach(function(e){t._columnCollection.removeEventListener(e,i)}),this._columnCollection=e,this._columnCollection?(n.forEach(function(e){t._columnCollection.addEventListener(e,i)}),this._columnCollection.dispatchCollectionEvent("reset")):this._resetColumns()}},{key:"clearItemRenderers",value:function(){var e=this._dimensions;this._freeCells(e.cells.concat(e.mergeCells))}},{key:"clearCache",value:function(){this.clearItemRenderers(),this._dimensions.clear(),this.scrollLeft=0,this.scrollTop=0,this.clearElementCache(),this.clearCellMerger(),this.clearSelection(),this._caretColumnIndex=-1,this._caretRowIndex=-1,this._anchorRowIndex=-1,this._anchorColumnIndex=-1}},{key:"_clearCacheForIndicator",value:function(){this.clearItemRenderers(),this._dimensions.clear(),this.clearCellMerger(),this.clearSelection(),this._caretColumnIndex=-1,this._caretRowIndex=-1,this._anchorRowIndex=-1,this._anchorColumnIndex=-1}},{key:"_resetColumns",value:function(){var t=this.grid,e=this.columnCollection,n=this.normalizedColumns,i=[];e&&(e.updateColumns(),e.find(function(e){e.setGrid(t),e.isLeaf&&(e.index=i.length,i.push(e))})),this._normalizedColumns=i,this._dimensions.updateTypicalColumnSizes(),this._dispatchChangeEvent("normalized-columns-change",i,n),this.invalidateFor(K.COLUMNS_CHANGE)}},{key:"_measureSize",value:function(){for(var e=this.normalizedColumns.length,t=0,n=0;n<this.frozenLeft;n++)t+=this.getColumnWidth(n);for(var i=e-this.frozenRight;i<e;i++)t+=this.getColumnWidth(i);0<=t&&(this.style.minWidth=t+"px")}},{key:"_updateDisplay",value:function(){this._dispatchDataGroupEvent("render-updating",this._reasonsMask);var e=this._dimensions,t=this.clientWidth,n=this.clientHeight,i=this.scrollLeft,o=this.scrollTop,r=this.isInvalidateReason(K.ITEMS_CHANGE),s=this.isInvalidateReason(K.COLUMNS_CHANGE),l=r||s||this.isInvalidateReason(K.VISIBLE_COLUMNS_CHANGE,K.COLUMN_UPDATE,K.GROUP_SIZE_CHANGE),a=s||r;this.autoMerge&&a&&(this.merger.analysisReady(),"all"===this.options.mergeMode&&this.merger.analysisAll()),(r||s)&&(this._measureSize(),this._generateColumns()),this._beginLayers();var u=e.columnIndices;(e.updateVisibleColumns(l)||s)&&this._dispatchChangeEvent("visible-columns-change",e.columnIndices,u),(s||r)&&this._resetCaret(),this._cacheStyle=this.grid.getStyle("cellBackgroundColor","rowColors","backgroundColor","cellSelectionColor","cellOverColor","rowLine","columnLine","frozenLine","caretLine"),this._prepareLayers(i,o,t,n),this._createGrid(i,o,t,n),this.setContentSize(this.getContentWidth(),this.getContentHeight()),this._paintBackgrounds(i,o,t,n),this._paintSelectionIndicators(i,o,t,n),this._paintHighlightIndicators(i,o,t,n),this._paintSeparators(i,o,t,n),this._paintCaretIndicators(i,o,t,n),this._updateLayers(i,o,t,n,this.getContentWidth(),this.getContentHeight(),this.getVisibleFrozenSizeRect()),this._endLayers(),this._oldWidth===t&&this._oldHeight===n||(this._dispatchDataGroupEvent("group-size-change",this._reasonsMask),this._oldWidth=t,this._oldHeight=n),this._dispatchDataGroupEvent("render-update",this._reasonsMask)}},{key:"_resetCaret",value:function(){this._setCaretIndex(-1,-1),this._anchorRowIndex=-1,this._anchorColumnIndex=-1}},{key:"_setCaretIndex",value:function(e,t){var n=!1,i=this.findMergeCellPosition(e,t);return i&&(e=i.rowIndex,t=i.columnIndex),this._caretRowIndex!==e&&(this._caretRowIndex=e,n=!0),this._caretColumnIndex!==t&&(this._caretColumnIndex=t,n=!0),n&&(this._dispatchCaretChangeEvent(this._caretRowIndex,this._caretColumnIndex),this.invalidateFor(K.CARET_CHANGE)),n}},{key:"_generateColumns",value:function(){if(this._needGeneratedColumns&&0<this.numRows){var e=Object.keys(this.collection.get(0)).map(function(e){return new Q(e)});this._setColumnCollection(new ct(e)),this._needGeneratedColumns=!1}}},{key:"_createGrid",value:function(e,t,n,i){var o,r,s,l,a=this._dimensions,u=a.visibleFrozenIndexRect,h=this.numRows;a.updateStart(),0<u.top&&(o=0,r=Math.min(u.top-1,h-1),l=s=0,this._createRows(Fe.TOP,o,r,s,l,n,i,0)),0<u.bottom&&(o=Math.max(u.top,h-u.bottom),r=h-1,s=0,l=i-this.getRowsHeight(h-this.frozenBottom,h-1),this._createRows(Fe.BOTTOM,o,r,s,l,n,i,0)),a.updateVisibleFrozenSizeRect();var c=a.visibleFrozenSizeRect;o=this.getRowIndexByDistance(t+c.top),r=h-(u.bottom+1),s=this.getRowY(o)-c.top,l=this.getRowsHeight(0,this.frozenTop-1),this._createRows(Fe.MIDDLE,o,r,s,l,n,i-(c.top+c.bottom),t);var d=this._dimensions.updateEnd(),f=d.rows,v=d.mergeCells;this._paintMergeCells(),this._freeRows(f),this._freeCells(v),a.updateVisibleFrozenSizeRect()}},{key:"_asyncCreateRows",value:function(a,e,u,t,n,i){var h=this,c=this.collection.toArray(),d=this.scrollTop,f=this.autoRowHeight,v=this.merger,g=this.autoMerge,m=new Ot({cellInfos:[],mergeCells:[]}),_=this._calculateViewHeight(i);return new Promise(function(r){!function i(o,e){var s,l;(s=o,l=e,new Promise(function(e){for(var t=Date.now(),n=l,i=s;Date.now()-t<100&&n-d<_;){g&&v.analysisRow(i);var o=linearList.getSize(i);m.union(h._createRow(a,c[i],i,n));var r=linearList.getSize(i);f&&r!==o&&(_=h._calculateViewHeight(r)),n+=r,i++}e({lastIndex:i,lastY:n})})).then(function(e){var t=e.lastIndex,n=e.lastY;t<=u&&n-d<_?i(o,n):r(m)})}(e,t)})}},{key:"_createRows",value:function(e,t,n,i,o,r,s,l){var a,u,h,c,d,f,v=this._dimensions,g=this.collection&&this.collection.toArray()||[],m=this.autoRowHeight,_=this.merger,y=this.autoMerge,p=t,C=i,k=o,w=this._calculateViewHeight(s),x=p,b=Math.min(n,t+Math.ceil(w/this.rowHeight));for(y&&_.analysisRows(x,b),this.setMergeVisibleRect(x,0,b,this.normalizedColumns.length-1);p<=n&&C-l<w;){y&&b<p&&_.analysisRow(p);var E=v.getRowHeight(p),I=this._createRow(g[p],p,C,E);m&&I.height!==E&&(w=this._calculateViewHeight(s),E=I.height),h=C,c=k,f=d=void 0,d=0,f=u=E,t===(a=p)?f=u-(d=l-i):w<=h-l+u&&(d=0,f=w-(h-l)),I.setLayout({index:a,y:h,height:u,sy:d,sh:f,dy:c,dh:f});this._paintRow(I);k+=I.layout.sh,C+=E,++p}}},{key:"_createRow",value:function(l,a,u,h){var c=this,d=this._dimensions,f=(this.autoRowHeight,this._normalizedColumns),v=d.takeRow(a)||d.createRow(a),g=[];v.setIndex(a),d.forEachColumnLayouts(function(e,t){var n=f[t],i=v.takeCellAt(t),o=c.findMergeCellPositionFromVisibleRect(a,t)||new S(a,t),r=c._createCell(l,n,o,e.x-e.baseX,u,e.width,h,i);if(o.isMerged&&!d.hasPendingMergeCellPosition(o)){var s=d.getMergeCell(o);s&&d.removeMergeCellPosition(o),d.setMergeCell(o,function(){return c._createMergeCell(o,s)})}g.push(r)});var e=v.cells.slice(0);return v.setCells(g).setHeight(h),d.setRow(a,v,h),this._freeCells(e),v}},{key:"_createCell",value:function(e,t,n,i,o,r,s,l){var a=l||this._dimensions.createCell(e,t,n),u=n.isMerged,h=a.renderer;h||u||(h=this._createRenderer(e,t,n));var c=h&&h.htmlElement;if(c){var d=this._rendererLayer;u?d.removeElement(c):(d.addElement(this.getVerticalSectionIndex(n.rowIndex),this.getHorizontalSectionIndex(n.columnIndex),c),le(c,"grid-cell"),oe(c,r,s),se(c,i,o))}return this._setupCell(a,h,e,t,n,!u)}},{key:"_createMergeCell",value:function(e,t){var n=this._rendererLayer,i=this.collection.get(e.rowIndex),o=this.normalizedColumns[e.columnIndex],r=t||this._dimensions.createCell(i,o,e),s=r.renderer||this._createRenderer(i,o,e),l=s.htmlElement,a=this._dimensions.getCellLayoutByCellPosition(e);return l&&(n.addOverlayElement(l),le(l,"grid-cell"),oe(l,a.dw,a.dh),se(l,a.dx,a.dy)),this._setupCell(r,s,i,o,e,!0)}},{key:"_setupCell",value:function(e,t,n,i,o,r){var s=!1,l=!1;return this.isCellSelectionMode?(l=this.containsSelectedCell(o),s=o.contains(this.overColumnIndex,this.overRowIndex)):this.isRowSelectionMode&&(l=this.containsSelectedPosition(o.rowIndex,0),s=o.rowIndex===this.overRowIndex),e.item=n,e.column=i,e.renderer=t,e.cellPosition=o,e.cell=o,e.label=this.itemToLabel(n,i,o),e.hovered=s,e.selected=l,(e.visible=r)&&_(t,"prepare",this.grid,e),e}},{key:"_paintRow",value:function(r){var s=this,l=this._rendererLayer.context,a=r.layout,u=this._dimensions.columnLayouts,h=this.autoRowHeight;r.cells.forEach(function(e,t){var n=e.column,i=u[t],o=s._internalPaintCell(l,e,i.width,a.height,i.sx,a.sy,i.sw,a.sh,i.dx,a.dy);h&&n.wordWrap&&!e.renderer.isDomRenderer&&s._dimensions.setCellHeight(r.index,n.index,o)})}},{key:"_paintMergeCells",value:function(){var i=this,o=this._rendererLayer.context,r=this._dimensions;r.forEachMergeCellLayouts(function(e,t){var n=r.getMergeCell(t);i._internalPaintCell(o,n,e.dw,e.dh,0,0,e.dw,e.dh,e.dx,e.dy)})}},{key:"_paintCell",value:function(e,t,n){e.clearRect(n.dx,n.dy,n.dw,n.dh),t.cellPosition.isMerged?this._internalPaintCell(e,t,n.dw,n.dh,0,0,n.dw,n.dh,n.dx,n.dy):this._internalPaintCell(e,t,n.width,n.height,n.sx,n.sy,n.dw,n.dh,n.dx,n.dy)}},{key:"_internalPaintCell",value:function(e,t,n,i,o,r,s,l,a,u){if(t.visible){e.save(),e.beginPath(),e.rect(a,u,s,l),e.clip(),e.translate(a-o,u-r);var h=t.renderer.paint(e,t,n,i);return e.restore(),h}return i}},{key:"_freeRows",value:function(e){var t=this;e.forEach(function(e){return t._freeCells(e.cells)})}},{key:"_freeCells",value:function(e){var i=this,o=this._rendererLayer;e.forEach(function(e){var t=e&&e.renderer;if(t){var n=t.htmlElement;_(t,"dispose"),n&&o.removeElement(n),i._freeRenderer(t),e.renderer=null}})}},{key:"itemToLabel",value:function(e,t,n){var i=this.grid.labelFunction;return i?i(e,t,n):t.itemToLabel(e)}},{key:"getViewMinHeight",value:function(){return this._calculateViewHeight(0)}},{key:"_getBufferContext",value:function(e,t){var n,i;return e<=200&&t<=100?(n=0<this._bufferContexts.length?this._bufferContexts[0]:null)||((i=(n=Gt()).canvas).width=200,i.height=100,this._bufferContexts[0]=n):((n=1<this._bufferContexts.length?this._bufferContexts[1]:null)||(n=Gt(),this._bufferContexts[1]=n),((i=n.canvas).width<e||i.height<t)&&(i.width=e,i.height=t)),n}},{key:"_paintBackgrounds",value:function(e,t,i,o){var n=this._dimensions,r=this._backgroundLayer.context,s=this._cacheStyle,l=s.rowColors,a=s.backgroundColor;r.save(),r.beginPath(),a&&(r.fillStyle=a,r.fillRect(0,0,i,o)),n.forEachRowLayouts(function(e,t){var n;l instanceof Function?n=y(l,t):Array.isArray(l)?n=l[t%l.length]:"string"==typeof l&&(n=l),r.fillStyle=n,r.fillRect(0,e.dy,i,e.dh)}),r.restore(),r.save();var u=this.normalizedColumns;n.forEachColumnLayouts(function(e,t){var n=u[t].getStyle("backgroundColor");n&&(r.fillStyle=n,r.fillRect(e.dx,0,e.dw,o))}),r.restore();var h=this._cacheStyle.cellBackgroundColor;h instanceof Function&&n.forEachCellLayouts(function(e,t,n){var i=h(t,n);i&&(r.fillStyle=i,r.fillRect(e.dx,e.dy,e.dw,e.dh))})}},{key:"_paintSelectionIndicators",value:function(e,t,o,n){if(this.hasSelectionMode){var r=this._selectionLayer.context,i=this.isRowSelectionMode,s=this._dimensions;r.save(),r.beginPath(),r.fillStyle=this._cacheStyle.cellSelectionColor,i?s.forEachRowLayouts(function(e,t,n){var i=function(e){for(var t=e.cells,n=0,i=t.length;n<i;n++){var o=t[n];if(!o.cellPosition.isCrossed)return o}return null}(n);i&&i.selected&&r.fillRect(0,e.dy,o,e.dh)}):s.forEachCellLayouts(function(e,t,n,i){i&&i.selected&&r.fillRect(e.dx,e.dy,e.dw,e.dh)}),r.restore()}}},{key:"_paintHighlightIndicators",value:function(e,t,n,i){var o,r=this._dimensions,s=this._selectionLayer.context,l=this.overRowIndex,a=this.overColumnIndex;if(this.isRowSelectionMode){if(!r.isVisibleRow(l))return;o=d(d({},r.getRowLayout(l)),{dx:0,dw:this.clientWidth})}else{var u=this.findMergeCellPosition(l,a)||new S(l,a);if(!r.isVisibleCell(u))return;o=r.getCellLayoutByCellPosition(u)}o&&(s.save(),s.beginPath(),s.fillStyle=this._cacheStyle.cellOverColor,s.fillRect(o.dx,o.dy,o.dw,o.dh),s.restore())}},{key:"_paintSeparators",value:function(e,t,n,i){var r=this._separatorLayer.context,l=this._dimensions,o=l.visibleFrozenSizeRect,s=l.columnLayouts,a=s.length,u=this._cacheStyle.rowLine,h=function(e,t,n){var i=s[t],o=s[n];xe(r,i.dx,e,o.dx+o.dw,e,u)};if(r.save(),l.forEachRowLayouts(function(e,t){for(var n=l.getCellsByRow(t),i=0,o=0;o<a;o++){var r=n[o],s=r.column;Ht(r.cellPosition,t+1,s.index)&&(i<o&&h(e.dy+e.dh,i,o-1),i=o+1)}i<o&&h(e.dy+e.dh,i,o-1)}),this.getContentHeight()<i)for(var c=l.visibleFrozenSizeRect.bottom,d=this.rowHeight,f=this.getContentHeight()-c;f<i-c;)xe(r,0,f,n,f,u),f+=d;r.restore();var v=l.rows,g=v.length,m=this._cacheStyle.columnLine,_=function(e,t,n){var i=v[t].layout,o=v[n].layout;xe(r,e,i.dy,e,o.dy+o.dh,m)};r.save(),l.forEachColumnLayouts(function(e,t){for(var n=l.getCellsByColumn(t),i=0,o=0;o<g;o++){var r=v[o];Ht(n[o].cellPosition,r.index,t+1)&&(i<o&&_(e.dx+e.dw,i,o-1),i=o+1)}i<o&&_(e.dx+e.dw,i,o-1)});var y=l.getColumnLayout(this.normalizedColumns.length-1),p=y&&y.x+y.width||-1;0<p&&p<n&&xe(r,p,0,p,i,m),r.restore();var C=this._cacheStyle.frozenLine;r.save(),0<o.left&&xe(r,o.left,0,o.left,i,C),0<o.right&&xe(r,n-o.right,0,n-o.right,i,C),0<o.top&&xe(r,0,o.top,n,o.top,C),0<o.bottom&&xe(r,0,i-o.bottom,n,i-o.bottom,C),r.restore(),Nt(r,n,i)}},{key:"_paintCaretIndicators",value:function(e,t,n,i){var o=this._separatorLayer.context,r=this.caretRowIndex,s=this.caretColumnIndex;if(this.isValidPosition(r,s)){var l=this._dimensions.getCellLayoutByCellPosition(this.findMergeCellPosition(r,s)||new S(r,s));if(l){var a=this._cacheStyle.caretLine,u=a.color,h=a.width,c=l.dx+Math.floor(h/2),d=l.dy+Math.floor(h/2),f=l.dw-h+1,v=l.dh-h+1;o.save(),o.beginPath(),o.strokeStyle=u,o.lineWidth=h,o.rect(c,d,f,v),o.stroke(),o.restore()}}}},{key:"_invalidateOverAndOut",value:function(){var n=this,e=this.clientWidth,t=this.clientHeight,i=this.scrollLeft,o=this.scrollTop;if(this.hasSelectionMode){var r=this._dimensions.cells.concat(this._dimensions.mergeCells),s=this.isCellSelectionMode,l=this.isRowSelectionMode;r.forEach(function(e){var t=e.cellPosition;e.visible&&(e.hovered||l&&t.rowIndex===n.overRowIndex||s&&t.contains(n.overColumnIndex,n.overRowIndex))&&n.invalidateCell(t.rowIndex,t.columnIndex)})}this._selectionLayer.begin(),this._paintSelectionIndicators(i,o,e,t),this._paintHighlightIndicators(i,o,e,t),this._selectionLayer.end()}},{key:"_itemToTemplate",value:function(e,t,n){var i=this.useNullItemRenderer&&(!e||!(t.dataField in e)||null==e[t.dataField]),o=t.itemRenderer||this.itemRenderer,r=null;return n&&n.isMerged&&this.mergeItemRenderer?r=this.mergeItemRenderer instanceof Function?this.mergeItemRenderer(e,t,n):this.mergeItemRenderer:o instanceof Function?r=o(e,t,n):i?r=this.nullItemRenderer:o&&(r=o),r||(r=Pe),r}},{key:"_calculateViewHeight",value:function(e){return 0<this.normalizedRowCount?this.getRowsHeight(0,this.normalizedRowCount-1):e}},{key:"getVisibleRowIndices",value:function(){return this._dimensions.rowIndices.slice(0)}},{key:"getVisibleColumnIndices",value:function(){return this._dimensions.columnIndices.slice(0)}},{key:"getCellLayout",value:function(e,t){return this._dimensions.getCellLayout(e,t)}},{key:"getCellLayoutByCellPosition",value:function(e){return this._dimensions.getCellLayoutByCellPosition(e)}},{key:"getVisibleFrozenIndexRect",value:function(){return this._dimensions.visibleFrozenIndexRect}},{key:"getVisibleFrozenSizeRect",value:function(){return this._dimensions.visibleFrozenSizeRect}},{key:"getRowY",value:function(e){return this._dimensions.getRowY(e)}},{key:"getRowIndexByDistance",value:function(e){return this._dimensions.getRowIndexByDistance(e)}},{key:"getRowHeight",value:function(e){return this._dimensions.getRowHeight(e)}},{key:"setRowHeight",value:function(e,t){return!!this._dimensions.setRowHeight(e,t)&&(this.invalidateFor(K.ROW_HEIGHT_CHANGE),!0)}},{key:"getRowsHeight",value:function(e,t){return this._dimensions.getRowsHeight(e,t)}},{key:"getColumnX",value:function(e){return 0<e?this._dimensions.getColumnX(e):0}},{key:"getColumnLayout",value:function(e){return this._dimensions.getColumnLayout(e)}},{key:"getColumnIndexByDistance",value:function(e){return Math.min(this._dimensions.getColumnIndexByDistance(e),this.normalizedColumns.length-1)}},{key:"getColumnWidth",value:function(e){return this._dimensions.getColumnWidth(e)}},{key:"setColumnWidth",value:function(e,t){var n=this.getColumnAt(e);if(n){isNaN(t)||(t=L(t,n.minWidth));var i=this.getColumnWidth(e);i!==t&&(n.setWidth(t),isNaN(t)||this._dimensions.setColumnWidth(e,t),this.invalidateFor(K.COLUMN_UPDATE),this._dispatchDataGroupEvent("column-size-change",{column:n,newValue:t,oldValue:i}))}}},{key:"getColumnsWidth",value:function(e,t){return this._dimensions.getColumnsWidth(e,t)}},{key:"getContentWidth",value:function(){return this._dimensions.getColumnsTotal()}},{key:"getContentHeight",value:function(){return this._dimensions.getRowsTotal()}},{key:"setColumnVisible",value:function(e,t){e.visible!==t&&(e.setVisible(t),this.columnCollection.clearCache(),this._dispatchDataGroupEvent("column-visible",e),this.invalidateFor(K.COLUMN_UPDATE),this.validateNow())}},{key:"getHorizontalSectionIndex",value:function(e){return e<this.frozenLeft?Fe.LEFT:this.normalizedColumns.length-e<=this.frozenRight?Fe.RIGHT:Fe.CENTER}},{key:"getVerticalSectionIndex",value:function(e){return e<this.frozenTop?Fe.TOP:this.numRows-e<=this.frozenBottom?Fe.BOTTOM:Fe.MIDDLE}},{key:"getCell",value:function(e,t){var n=this._dimensions,i=this.findMergeCellPosition(e,t);return i?n.getMergeCell(i):n.getCell(e,t)}},{key:"getItemRenderer",value:function(e,t){var n=this.getCell(e,t);return n&&n.renderer||null}},{key:"invalidateRow",value:function(e){var t=this;this._dimensions.getCellsByRow(e).forEach(function(e){t.invalidateCell(e.cellPosition.rowIndex,e.cellPosition.columnIndex)})}},{key:"invalidateColumn",value:function(e){var t=this;this._dimensions.getCellsByColumn(e).forEach(function(e){t.invalidateCell(e.cellPosition.rowIndex,e.cellPosition.columnIndex)})}},{key:"invalidateCell",value:function(e,t){var n=this._dimensions,i=this.findMergeCellPosition(e,t),o=i?n.getMergeCell(i):n.getCell(e,t),r=i?n.getCellLayoutByCellPosition(i):n.getCellLayout(e,t);o&&r&&(this._setupCell(o,o.renderer,o.item,o.column,o.cellPosition,!0),this._paintCell(this._rendererLayer.context,o,r))}},{key:"isVisiblePosition",value:function(e,t){return this._dimensions.isVisiblePosition(e,t)}},{key:"isVisibleCell",value:function(e){return!(!e||!this._dimensions.isVisibleCell(e))}},{key:"isValidPosition",value:function(e,t){var n=this.numRows,i=this.normalizedColumns.length;return!(e<0||n<=e||t<0||i<=t)}},{key:"getItemAt",value:function(e){return this.collection&&this.collection.get(e)}},{key:"getColumnAt",value:function(e){return 0<=e&&e<this.normalizedColumns.length?this.normalizedColumns[e]:null}},{key:"doLayout",value:function(e){this.invalidateFor(e?K.ALL:0),this.validateNow()}},{key:"updateScrollRect",value:function(){var e=this._dimensions,t=this.scrollLeft,n=this.scrollTop,i=t!==this._oldScrollLeft,o=n!==this._oldScrollTop,r=e.visibleFrozenIndexRect,s=e.visibleFrozenSizeRect,l=e.columnIndices,a=0;if(i){var u=this.getColumnIndexByDistance(t+s.left),h=this.getColumnIndexByDistance(t+this.clientWidth-s.right),c=l.length,d=c>r.left?l[r.left]:0,f=c>r.right?l[c-r.right-1]:0;this._oldScrollLeft=t,a|=K.HORIZONTAL_SCROLL_CHANGE,u===d&&h===f||(a|=K.VISIBLE_COLUMNS_CHANGE)}o&&(this._oldScrollTop=n,a|=K.VERTICAL_SCROLL_CHANGE),this.invalidateFor(a)}},{key:"analysisMergeAll",value:function(){this.merger.analysisAll()}},{key:"getVerticalScrollPositionDelta",value:function(e){var t=Math.max(this.rowHeight,30);return 0<e?t:-t}},{key:"_mouseEventToContent",value:function(e){var t=this._mouseEventToLocal(e),n=this.clientWidth,i=this.clientHeight,o=this._dimensions.visibleFrozenSizeRect;return 0<o.top&&t.y<=o.top||(0<o.bottom&&i-t.y<=o.bottom?t.y=this.contentHeight-(i-t.y):this.contentHeight<i&&this.contentHeight-o.bottom<=t.y?t.y=this.contentHeight:t.y=t.y+this.scrollTop),0<o.left&&t.x<=o.left||(0<o.right&&n-t.x<=o.right?t.x=this.contentWidth-(n-t.x):t.x=t.x+this.scrollLeft),t}},{key:"scrollToCell",value:function(e,t,n){if(this.isValidPosition(e,t)){var i=-1!==t,o=-1!==e;do{if(!this._internalScrollToCell(e,t,o,i))break}while(!this.isVisiblePosition(e,t));this._internalScrollToCell(e,t,o,i),n&&this.updateSelection(e,t)}}},{key:"updateSelection",value:function(e,t,n,i){var o=!1;if(this.hasSelectionMode){var r,s=e,l=t,a=e,u=t;this.isRowSelectionMode&&(u=l=0),n&&this.isMultipleSelectionMode?(r="set",a=this._anchorRowIndex,u=this._anchorColumnIndex):r=i?this.containsSelectedCell(new S(s,l))?"remove":this.isMultipleSelectionMode?"add":"set":"set";var h=this.unionCellPosition(s,l,a,u,this.isMultipleSelectionMode);"set"===r?o=this.setSelectedCell(h):"add"===r?o=this.addSelectedCell(h):"remove"===r&&(o=this.removeSelectedCell(h)),n&&this.isMultipleSelectionMode||(this._anchorRowIndex=s,this._anchorColumnIndex=l)}return this._setCaretIndex(e,t),o}},{key:"getCellStyle",value:function(e,t){for(var n=this.getColumnAt(t),i=null,o=arguments.length,r=new Array(2<o?o-2:0),s=2;s<o;s++)r[s-2]=arguments[s];if(i=n?n.getStyle.apply(n,r):this.getStyle.apply(this,r)){if(i instanceof Function)i=i(e,t);else if("object"===a(i))for(var l in i)i[l]=y(i[l],e,t)}else;return i}},{key:"destroy",value:function(){this.clearCache()}},{key:"_internalScrollToCell",value:function(e,t,n,i){var o=this._calculateScrollPositionDelta(e,t),r=!1;if(o){if(n&&0!==o.y){var s=this.scrollTop;this.scrollTop+=o.y,this.scrollTop!==s&&(r=!0)}if(i&&0!==o.x){var l=this.scrollLeft;this.scrollLeft+=o.x,this.scrollLeft!==l&&(r=!0)}}return r}},{key:"_calculateScrollPositionDelta",value:function(e,t){var n=this.getColumnX(t),i=this.getRowY(e),o=n+this.getColumnWidth(t),r=i+this.getRowHeight(e),s=this.getScrollRect(),l=this._dimensions.visibleFrozenSizeRect,a=l.left+s.left,u=a+this.clientWidth-(l.left+l.right),h=l.top+s.top,c=h+this.clientHeight-(l.top+l.bottom),d=n-l.left-s.left,f=o-(s.right-l.right),v=i-l.top-s.top,g=r-(s.bottom-l.bottom),m=Math.abs(d)<Math.abs(f)?d:f,_=Math.abs(v)<Math.abs(g)?v:g;return(o<=l.left||n>=this.getContentWidth()-l.right||a<=n&&o<=u)&&(m=0),(r<=l.top||i>=this.getContentHeight()-l.bottom||h<=i&&r<=c)&&(_=0),new I(m,_)}},{key:"_itemsAdded",value:function(i,e){var o=this,r=this._dimensions;e.forEach(function(e,t){var n=i+t;r.insertRow(n,r.createRow(n),o.rowHeight)}),this.invalidateFor(K.ITEM_UPDATE)}},{key:"_itemsRemoved",value:function(o,e){var r=this,s=this._dimensions;e.forEach(function(e,t){var n=o+t,i=s.removeRow(n);i&&r._freeCells(i.cells)});var n=new S(o,0,o+e.length-1,this.normalizedColumns.length-1);s.mergeCells.slice(0).forEach(function(e){var t=e.cellPosition;n.intersects(t)&&(s.removeMergeCellPosition(t),r._freeCells([e]))}),this.invalidateFor(K.ITEM_UPDATE)}},{key:"_columnsAdded",value:function(n,e){var i=this._dimensions;e.forEach(function(e,t){i.insertColumn(n+t)}),this.invalidateFor(K.COLUMNS_CHANGE)}},{key:"_columnsRemoved",value:function(n,e){var i=this._dimensions,o=[];e.forEach(function(e,t){Array.prototype.push.apply(o,i.removeColumn(n))}),this._freeCells(o),this.invalidateFor(K.COLUMNS_CHANGE)}},{key:"_dispatchDataGroupEvent",value:function(e,t){return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:t}))}},{key:"_dispatchChangeEvent",value:function(e,t,n){return this.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:{newValue:t,oldValue:n}}))}},{key:"_dispatchItemEvent",value:function(e,t,n,i){var o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]&&arguments[5];return this.dispatchEvent(new CustomEvent(e,{cancelable:o,bubbles:r,detail:{rowIndex:t,columnIndex:n,item:this.getItemAt(t),column:this.getColumnAt(n),trigger:i}}))}},{key:"_dispatchCaretChangeEvent",value:function(e,t){return this.dispatchEvent(new CustomEvent("caret-change",{bubbles:!1,cancelable:!1,detail:{caretRowIndex:e,caretColumnIndex:t}}))}},{key:"_onMouseDown",value:function(e){if(!e.defaultPrevented){var t=this._mouseEventToContent(e),n=this.getRowIndexByDistance(t.y),i=this.getColumnIndexByDistance(t.x);this.isValidPosition(n,i)&&this._dispatchItemEvent("item-down",n,i,e,!0)&&(this._mouseDownColumnIndex=i,this._mouseDownRowIndex=n,document.addEventListener("mousemove",this._boundDocumentMouseMove),document.addEventListener("mouseup",this._boundDocumentMouseUp),this.updateSelection(n,i,e.shiftKey,e.ctrlKey))}}},{key:"_onMouseMove",value:function(e){var t=this._mouseEventToContent(e),n=this.getRowIndexByDistance(t.y),i=this.getColumnIndexByDistance(t.x);if(n!==this.overRowIndex||i!==this.overColumnIndex){var o=this.findMergeCellPosition(n,i);o||(Pt.rowIndex=n,Pt.columnIndex=i,o=Pt),o.equals(this.overCell)||((0<=this.overRowIndex||0<=this.overColumnIndex)&&this._dispatchItemEvent("item-out",this.overRowIndex,this.overColumnIndex,e),0<=n&&0<=i&&this._dispatchItemEvent("item-over",n,i,e),this.overRowIndex=n,this.overColumnIndex=i,this.overCell=Pt!==o?o:null,this._boundInvalidateOverAndOut||(this._boundInvalidateOverAndOut=this._invalidateOverAndOut.bind(this)),E(this._boundInvalidateOverAndOut))}}},{key:"_onMouseEnter",value:function(e){this._hasMouse=!0}},{key:"_onMouseLeave",value:function(e){this._hasMouse=!1,(0<=this.overRowIndex||0<=this.overColumnIndex)&&(this._dispatchItemEvent("item-out",this.overRowIndex,this.overColumnIndex,e),this.overRowIndex=-1,this.overColumnIndex=-1,this.overCell=null,this.invalidateFor(K.DISPLAY_UPDATE))}},{key:"_onDocumentMouseMove",value:function(t){try{var e=this._mouseEventToContent(t);if(e&&0<=this._mouseDownRowIndex&&0<=this._mouseDownColumnIndex){var n=this.getColumnIndexByDistance(e.x),i=this.getRowIndexByDistance(e.y);this._dispatchItemEvent("item-drag",i,n,t)}}catch(e){this._onDocumentMouseUp(t)}}},{key:"_onDocumentMouseUp",value:function(e){document.removeEventListener("mousemove",this._boundDocumentMouseMove),document.removeEventListener("mouseup",this._boundDocumentMouseUp);var t=this._mouseEventToContent(e),n=this.getRowIndexByDistance(t.y),i=this.getColumnIndexByDistance(t.x);if(this._dispatchItemEvent("item-up",n,i,e),this.isValidPosition(n,i)&&n===this._mouseDownRowIndex&&i===this._mouseDownColumnIndex){var o=Date.now();0<=this._lastClickTime&&o-this._lastClickTime<400&&this._lastMouseClickRowIndex===n&&this._lastMouseClickColumnIndex===i?(this._dispatchItemEvent("item-double-click",n,i,e),this._lastClickTime=-1):(this._dispatchItemEvent("item-click",n,i,e),this._lastClickTime=Date.now()),this._lastMouseClickRowIndex=n,this._lastMouseClickColumnIndex=i}this._mouseDownRowIndex=-1,this._mouseDownColumnIndex=-1}},{key:"_onColumnCollectionChange",value:function(e){var i=this,t=e.type,n=e.detail,o=e.detail,r=o.kind,s=o.nodes;if("collection-change"===t)"reset"===r&&(this._resetColumns(),this.clearCache(),this.invalidateFor(K.COLUMNS_CHANGE));else if("node-change"===t&&("move"===r||"add"===r||"remove"===r)){var l=this.columnCollection,a=this.normalizedColumns.slice(0);this._resetColumns();var u=this.normalizedColumns.slice(0);"add"!==r&&s.forEach(function(e){var t=l.getLeafColumns(e),n=a.indexOf(t[0]);i._columnsRemoved(n,t)}),"remove"!==r&&s.forEach(function(e){var t=l.getLeafColumns(e),n=u.indexOf(t[0]);i._columnsAdded(n,t)})}!this.dispatchEvent(new CustomEvent("column-"+t,{bubbles:!1,cancelable:e.cancelable,detail:n}))&&e.cancelable&&e.preventDefault()}},{key:"_onCollectionChange",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.detail;switch(n.kind){case"add":this._itemsAdded(n.index,n.items);break;case"remove":this._itemsRemoved(n.index,n.items);break;case"set":case"update":this.invalidateFor(K.ITEM_UPDATE);break;case"reset":this.clearCache(),this.invalidateFor(K.ITEMS_CHANGE);break;case"refresh":this._clearCacheForIndicator(),this.invalidateFor(K.ITEMS_CHANGE)}this._dimensions.setRowSize(this.numRows),this.collectionChangedForCellMerger(e),this.collectionChangedForSelection(e),!1!==t&&this.dispatchEvent(new CustomEvent(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,detail:e.detail}))}},{key:"columnCollection",get:function(){return this._columnCollection},set:function(e){this._setColumnCollection(e),this._needGeneratedColumns=!e||e.length<=0}},{key:"collection",get:function(){return this._collection},set:function(e){this._collection&&this._collection.removeEventListener("collection-change",this._boundCollectionChange),this._collection=e,this._collection&&(this._collection.addEventListener("collection-change",this._boundCollectionChange),this._collection.dispatchCollectionEvent("reset"))}},{key:"numRows",get:function(){return this.collection&&this.collection.length||0}},{key:"normalizedColumns",get:function(){return this._normalizedColumns.slice(0)}},{key:"caretRowIndex",get:function(){return this._caretRowIndex},set:function(e){e!==this.caretRowIndex&&this._setCaretIndex(e,this.caretColumnIndex),this._anchorRowIndex=e}},{key:"caretColumnIndex",get:function(){return this._caretColumnIndex},set:function(e){e!==this.caretColumnIndex&&this._setCaretIndex(this.caretRowIndex,e),this._anchorColumnIndex=e}},{key:"rowHeight",get:function(){return this._dimensions.getRowDefaultHeight()},set:function(e){this.rowHeight!==e&&(this._dimensions.setRowDefaultHeight(e),this.invalidateFor(K.ROW_HEIGHT_CHANGE))}},{key:"autoRowHeight",get:function(){return this._autoRowHeight},set:function(e){this.autoRowHeight!==e&&(this._autoRowHeight=e,this.scrollTop=0,this.invalidate())}},{key:"maxRowCount",get:function(){return this._maxRowCount},set:function(e){this._maxRowCount!==e&&(this._maxRowCount=e,this.invalidate())}},{key:"rowCount",get:function(){return this._rowCount},set:function(e){this._rowCount!==e&&(this._rowCount=e)}},{key:"normalizedRowCount",get:function(){var e=this.rowCount;return 0<e&&0<this.maxRowCount&&e>this.maxRowCount&&(e=this.maxRowCount),e}},{key:"itemRenderer",get:function(){return this._itemRenderer},set:function(e){this._itemRenderer!==e&&(this._itemRenderer=e,this._itemRendererChanged())}},{key:"nullItemRenderer",get:function(){return this._nullItemRenderer},set:function(e){this._nullItemRenderer!==e&&(this._nullItemRenderer=e,this._itemRendererChanged())}},{key:"mergeItemRenderer",get:function(){return this._mergeItemRenderer},set:function(e){this._mergeItemRenderer!==e&&(this._mergeItemRenderer=e,this._itemRendererChanged())}},{key:"frozenLeft",get:function(){return this._frozenLeft},set:function(e){e=Math.max(e,0),this._frozenLeft!==e&&(this._frozenLeft=e,this._frozenCountChanged())}},{key:"frozenRight",get:function(){return this._frozenRight},set:function(e){e=Math.max(e,0),this._frozenRight!==e&&(this._frozenRight=e,this._frozenCountChanged())}},{key:"frozenTop",get:function(){return this._frozenTop},set:function(e){e=Math.max(e,0),this._frozenTop!==e&&(this._frozenTop=e,this._frozenCountChanged())}},{key:"frozenBottom",get:function(){return this._frozenBottom},set:function(e){e=Math.max(e,0),this._frozenBottom!==e&&(this._frozenBottom=e,this._frozenCountChanged())}},{key:"mergeCompare",get:function(){return this._mergeCompare},set:function(e){this._mergeCompare!==e&&(this._mergeCompare=e,this.invalidateFor(K.ITEMS_CHANGE))}},{key:"useNullItemRenderer",get:function(){return this._useNullItemRenderer},set:function(e){this._useNullItemRenderer!==e&&(this._useNullItemRenderer=e,this.invalidateFor(K.ALL))}}]),i}().withDom('<div class="tachyon-group-body"></div>').withBehavior($e,rt),zt={"item-mouse-down":"down","item-click":"click","item-double-click":"doubleClick"},At=[9,13,27,37,38,39,40],Ft=function(){function n(e){h(this,n),this._grid=e,this._editedCell=null,this._lastEditCellPosition=null,this._boundOnDocumentKeyDown=this._onDocumentKeyDown.bind(this),this._boundOnDocumentMouseEvent=this._onDocumentMouseEvent.bind(this);var t=this._onGridItemEvent.bind(this);e.addEventListener("item-mouse-down",t),e.addEventListener("item-click",t),e.addEventListener("item-double-click",t),e.addEventListener("keydown",this._onGridKeyDown.bind(this))}return c(n,[{key:"isEditing",value:function(){return!!this._editedCell}},{key:"isCellEditable",value:function(e,t){if(!this._grid.editable||!this._dataGroup.isValidPosition(e,t))return!1;var n=this._dataGroup.getColumnAt(t);return n&&n.visible&&n.editable}},{key:"startEdit",value:function(e,t,n){if(this.isEditing()&&this._lastEditCellPosition.contains(t,e)||!this.isCellEditable(e,t))return!1;if(this.isEditing()&&!this.endEdit(n))return!1;if(!this._dispatchEditorEvent("item-edit-starting",!0,e,t))return!1;var i=this._findMergeCellPosition(e,t);return this._lastEditCellPosition=i,this._grid.scrollToCell(i.rowIndex,i.columnIndex,!0),this._grid.validateNow(),this._createEditor(i,n),this._dispatchEditorEvent("item-edit-start",!1,i.rowIndex,i.columnIndex),!0}},{key:"endEdit",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(this.isEditing()){var t=this._grid,n=this._editedCell,i=n.editor,o=this._lastEditCellPosition;if(i.getSaveValue instanceof Function)try{var r=o.rowIndex,s=o.columnIndex,l=n.item,a=n.column,u=w(l,a.dataFieldPath),h=i.getSaveValue();if(!this._dispatchEditorEvent("item-edit-ending",!0,r,s,u,h,e))return!1;t.collection.setValue(r,a.dataField,h),this._dispatchEditorEvent("item-edit-end",!1,r,s,u,h),this._destroyEditor()}catch(e){this.cancelEdit()}else this.cancelEdit();return t.invalidate(),t.flush(),t.focus(),!0}return!1}},{key:"cancelEdit",value:function(){return!!this.isEditing()&&(this._dispatchEditorEvent("item-edit-cancel",!1,this._lastEditCellPosition.rowIndex,this._lastEditCellPosition.columnIndex),this._destroyEditor(),this._grid.focus(),!0)}},{key:"_itemToFactory",value:function(e,t,n){var i=t.itemEditor||this._grid.itemEditor;return i instanceof Function&&(i=i(e,t,n)),Me.factory(i||Te)}},{key:"_dataCellToEditCell",value:function(e,t,n){return Object.assign(new Xe,e,{inputtedKey:t,trigger:n})}},{key:"_createEditor",value:function(e,t){var n=this._grid,i=this._dataGroup,o=i.getCell(e.rowIndex,e.columnIndex),r=o.item,s=o.column,l=this._getPrintableKey(t),a=this._dataCellToEditCell(o,l,t),u=new(this._itemToFactory(r,s,e))(n);_(u,"created",n);var h=u.htmlElement;if(h){le(h,"tachyon-editor"),h.parentElement!==n.htmlElement&&n.appendChild(h);var c=i.getCellLayoutByCellPosition(e);re(h,c.dx,c.dy+n.getHeaderHeight(),c.dw,c.dh)}_(a.editor=u,"prepare",n,a),u.focus instanceof Function&&u.focus(),this._editedCell=a,document.addEventListener("keydown",this._boundOnDocumentKeyDown,!0),document.addEventListener("mousedown",this._boundOnDocumentMouseEvent),document.addEventListener("mousewheel",this._boundOnDocumentMouseEvent)}},{key:"_destroyEditor",value:function(){var e=this._editedCell.editor;document.removeEventListener("keydown",this._boundOnDocumentKeyDown,!0),document.removeEventListener("mousedown",this._boundOnDocumentMouseEvent),document.removeEventListener("mousewheel",this._boundOnDocumentMouseEvent),e&&(_(e,"dispose"),this._grid.hookFreeElement instanceof Function&&this._grid.hookFreeElement(e),e.htmlElement&&this._grid.removeChild(e.htmlElement)),this._lastEditCellPosition=null,this._editedCell=null}},{key:"_findMergeCellPosition",value:function(e,t){var n=this._dataGroup.findMergeCellPosition(e,t);return n||(n=new S(e,t)),n}},{key:"_startNextEdit",value:function(n,i,o,r,s){var l=this;this._inStartNextEdit||(this._inStartNextEdit=!0,window.requestAnimationFrame(function(){for(var e,t;(e=l._findNextEditablePosition(n,i,o,r))&&(n=e.y,i=e.x,t=l.startEdit(n,i,s)),e&&!t;);l._inStartNextEdit=!1}))}},{key:"_findNextEditablePosition",value:function(e,t,n,i){var o=this._dataGroup.normalizedColumns.length,r=this._dataGroup.collection.length,s=n?-1:1,l=e,a=t;do{var u=this._findMergeCellPosition(l,a);if(i?(l=n?u.top:u.bottom,l+=s):(a=n?u.left:u.right,o<=(a+=s)?(l++,a=0):a<0&&(l--,a=o-1)),l<0||r<=l)return null}while(!this.isCellEditable(l,a));return l===e&&a===t?null:new I(a,l)}},{key:"_dispatchEditorEvent",value:function(e,t,n,i,o,r){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,l=this._editedCell;return this._grid.dispatchEvent(new CustomEvent(e,{bubbles:!1,cancelable:t,detail:{rowIndex:n,columnIndex:i,item:this._dataGroup.getItemAt(n),column:this._dataGroup.getColumnAt(i),renderer:l&&l.renderer||null,editor:l&&l.editor||null,oldValue:o,newValue:r,trigger:s}}))}},{key:"_getPrintableKey",value:function(e){var t=e&&(e.char||e.key);return 0<=this._grid.editOnKeys.indexOf(t)?t:null}},{key:"_onGridItemEvent",value:function(e){var t=e.detail.rowIndex,n=e.detail.columnIndex,i=this.isEditing();if(!i||!this._lastEditCellPosition.contains(n,t)){var o=this._dataGroup.getColumnAt(n),r=this._findMergeCellPosition(t,n),s=o.editOnEvents||this._grid.editOnEvents||[],l=zt[e.type];i&&!this.endEdit(e)||s.indexOf(l)<0||this.startEdit(r.rowIndex,r.columnIndex,e)}}},{key:"_onGridKeyDown",value:function(e){if(!this.isEditing()&&!e.defaultPrevented){var t=this._dataGroup.caretRowIndex,n=this._dataGroup.caretColumnIndex;if(!e.ctrlKey&&!e.altKey&&0<=t&&0<=n)if(this._getPrintableKey(e)||113===e.keyCode){var i=this._findMergeCellPosition(t,n);this.startEdit(i.rowIndex,i.columnIndex,e)&&e.preventDefault()}}}},{key:"_onDocumentKeyDown",value:function(e){if(!e.defaultPrevented){var t=e.keyCode,n=e.shiftKey;if(this.isEditing()&&0<=At.indexOf(t)){e.preventDefault();var i=this._lastEditCellPosition,o=i.rowIndex,r=i.columnIndex;27===t?this.cancelEdit():13===t?this.endEdit(e)&&this._startNextEdit(o,r,n,!0,e):9===t?this.endEdit(e)&&this._startNextEdit(o,r,n,!1,e):37===t?this.endEdit(e)&&this._grid.moveCaretLeft():38===t?this.endEdit(e)&&this._grid.moveCaretUp():39===t?this.endEdit(e)&&this._grid.moveCaretRight():40===t&&this.endEdit(e)&&this._grid.moveCaretDown()}}}},{key:"_onDocumentMouseEvent",value:function(e){if(!e.defaultPrevented){var t=this._editedCell.editor;if(t){var n=t.htmlElement;if(!(n instanceof Element&&n.contains(e.target))){var i=e.clientX,o=e.clientY,r=n.getBoundingClientRect();(i<r.left||i>r.right||o<r.top||o>r.bottom)&&this.endEdit(e)}}}}},{key:"_dataGroup",get:function(){return this._grid.dataGroup}},{key:"editedCell",get:function(){return this._editedCell}}]),n}();function Vt(e){return new Function("a","b","return a ".concat(e," b"))}function Bt(e,t,n){return!(!e||!t)&&(n&&(e=e.toLowerCase(),t=t.toLowerCase()),0<=e.indexOf(t))}var Wt=[{type:"equals",compare:Vt("==")},{type:"notEqual",compare:Vt("!=")},{type:"lessThan",compare:Vt("<")},{type:"lessThanOrEqual",compare:Vt("<=")},{type:"greaterThan",compare:Vt(">")},{type:"greaterThanOrEqual",compare:Vt(">=")},{type:"contains",compare:Bt},{type:"notContains",compare:function(e,t){return!Bt(e,t)}},{type:"startsWith",compare:function(e,t){return e&&t&&e.startsWith(t)}},{type:"endsWith",compare:function(e,t){return e&&t&&e.startsWith(t)}}];function Ut(t){return t=(t||"").toLowerCase(),Wt.find(function(e){return t===e.type.toLowerCase()})}function jt(e){return null!=e?""+e:""}var Kt=function(){function i(e,t){h(this,i),this.options=e,this._manager=t;var n=function(e){e||(e={});var i=[],o=[],t=function(e){var t=e.operator;if(t){var n=Ut(t);n&&(i.push(n.compare),o.push(e.value))}};return"from"in e&&t(e.from),"to"in e&&t(e.to),i.length<=0&&t(e),{conditions:i,values:o}}(e.condition);this._conditions=n.conditions||[],this._values=n.values||[]}return c(i,[{key:"getConditions",value:function(){return this._conditions}},{key:"setConditions",value:function(e){return this._conditions!==e&&(this._conditions=e||[],!0)}},{key:"getValues",value:function(){return this._values||[]}},{key:"setValues",value:function(e){return this._values!==e&&(this._values=e||[],!0)}},{key:"itemToValue",value:function(e){return w(e,this.dataField)}},{key:"compare",value:function(e){return!0}},{key:"compareOtherFilters",value:function(t){var n=this;return!this.manager.filters.some(function(e){return e!==n&&e.canCompare&&!e.compare(t)})}},{key:"refresh",value:function(){this.manager.refresh()}},{key:"manager",get:function(){return this._manager}},{key:"collection",get:function(){return this.options.collection}},{key:"dataField",get:function(){return this.options.dataField}},{key:"canCompare",get:function(){return null!=this._values}}]),i}(),Xt=function(e){f(o,Kt);var i=g(o);function o(e,t){var n;return h(this,o),(n=i.call(this,e,t)).filterValueSet=null,n}return c(o,[{key:"itemToValue",value:function(e){return jt(C(p(o.prototype),"itemToValue",this).call(this,e))}},{key:"getPossibleValues",value:function(){var n=this,e=this.collection;if(e&&!this._possibleValues){var i=new Set;e.forEach(function(e){var t=n.itemToValue(e);i.has(t)||i.add(t)}),this._possibleValues=Array.from(i)}return this._possibleValues}},{key:"setValues",value:function(e){if(!Array.isArray(e))throw new Error("value is not Array.");return!!C(p(o.prototype),"setValues",this).call(this,e)&&(this.filterValueSet=new Set(e),!0)}},{key:"compare",value:function(e){return this.filterValueSet&&this.filterValueSet.has(this.itemToValue(e))}},{key:"canCompare",get:function(){var e=this.getValues().length;return!(e<=0||(this._possibleValues||[]).length===e)&&C(p(o.prototype),"canCompare",this)}}]),o}();function Yt(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return!e||e(t,n,i)}var qt=function(e){f(i,Kt);var n=g(i);function i(e,t){return h(this,i),n.call(this,e,t)}return c(i,[{key:"setConditions",value:function(e){return e=e&&e.map(function(e){if(e instanceof Function)return e;var t=Ut(e.toLowerCase());return t&&t.compare}),C(p(i.prototype),"setConditions",this).call(this,e)}},{key:"compare",value:function(e){var t=this.itemToValue(e),n=!0;if(this.fromCondition&&this.fromValue&&(n=Yt(this.fromCondition,t,this.fromValue,!0)),this.toCondition&&this.toValue){var i=this.options.condition.operator;return!("and"===i&&!n)&&(!("and"===i||!n)||Yt(this.toCondition,t,this.toValue,!0))}return n}},{key:"canCompare",get:function(){return null!=this.fromCondition&&null!=this.fromValue||null!=this.toCondition&&null!=this.toValue}},{key:"fromCondition",get:function(){return this._conditions[0]}},{key:"toCondition",get:function(){return this._conditions[1]}},{key:"fromValue",get:function(){return this._values[0]}},{key:"toValue",get:function(){return this._values[1]}}]),i}(),Zt=function(e){f(i,qt);var n=g(i);function i(e,t){return h(this,i),n.call(this,e,t)}return c(i,[{key:"itemToValue",value:function(e){return t=C(p(i.prototype),"itemToValue",this).call(this,e),++t;var t}}]),i}(),Jt=function(e){f(i,qt);var n=g(i);function i(e,t){return h(this,i),n.call(this,e,t)}return c(i,[{key:"compare",value:function(e){return!0}}]),i}(),Qt=function(e){f(i,qt);var n=g(i);function i(e,t){return h(this,i),n.call(this,e,t)}return c(i,[{key:"itemToValue",value:function(e){return jt(C(p(i.prototype),"itemToValue",this).call(this,e))}},{key:"canCompare",get:function(){return!!(null!=this.fromCondition&&this.fromValue||null!=this.toCondition&&this.toValue)}}]),i}(),$t=function(e){f(r,Kt);var o=g(r);function r(e,t,n){var i;return h(this,r),(i=o.call(this,t,n)).callback=e,i}return c(r,[{key:"compare",value:function(e){return this.callback(e,this.options.column)}},{key:"canCompare",get:function(){return this.callback instanceof Function}}]),r}(),en=function(){function t(e){h(this,t),this.grid=e,this.filters=[],this.filterMap=new Map,e.addEventListener("collection-change",this.onCollectionChange.bind(this))}return c(t,[{key:"getFilter",value:function(e){return this.filterMap.get(e)}},{key:"createFilter",value:function(e){var t=e.filter;if(!t)return null;if(t instanceof Function)return new $t(t,{collection:this.grid.collection,column:e},this);var n,i=t.dataField||e.dataField;if(!i)return console.warn("`dataField` is not defined",t),null;switch(t.type){case"set":n=Xt;break;case"number":n=Zt;break;case"date":n=Jt;break;default:n=Qt}return new n(d(d({},t),{},{collection:this.grid.collection,column:e,dataField:i}),this)}},{key:"addFilter",value:function(e){this.filters.push(e)}},{key:"refresh",value:function(){var e=this.grid.collection,i=this.filters.filter(function(e){return e.canCompare}),t=null;if(0<i.length){t=function(e){return function(e){for(var t=0,n=i.length;t<n;t++)if(!i[t].compare(e))return!1;return!0}(e)}}return e.filterFunction!==t&&(e.filterFunction=t,e.refresh(),!0)}},{key:"reset",value:function(){var n=this;this.clear(),this.grid.normalizedColumns.forEach(function(e){var t=n.createFilter(e);t&&(n.addFilter(t),n.filterMap.set(e,t),n.refresh())})}},{key:"clear",value:function(){this.filters=[],this.filterMap=new Map}},{key:"onCollectionChange",value:function(e){"reset"===e.detail.kind&&this.reset()}},{key:"collection",get:function(){return this.grid.collection}}]),t}(),tn={constructor:function(){this._filterManager=new en(this)},get filterManager(){return this._filterManager}},nn=function(){function n(e,t){h(this,n),this._grid=t,this._name=e}return c(n,[{key:"created",value:function(e){}},{key:"updating",value:function(){}},{key:"update",value:function(){}},{key:"name",get:function(){return this._name}},{key:"grid",get:function(){return this._grid}}]),n}(),on={};function rn(e,t){var i,n,o,r=null;return e&&(r=on[e]=(i=e,n=t,m((o=function(e){f(n,nn);var t=g(n);function n(e){return h(this,n),t.call(this,i,e)}return n}()).prototype,n,!1),o)),r}var sn={get:function(e){return e?on[e]:null},add:rn,remove:function(e){e in on&&delete on[e]}},ln=function(){function i(e){var t=this;h(this,i),this.grid=e,this._addons=Object.keys(on).map(function(e){return on[e]}).map(function(e){return t._createAddon(e)});var n=this._onDataGroupRender.bind(this);e.addEventListener("render-updating",n),e.addEventListener("render-update",n)}return c(i,[{key:"getAddons",value:function(){return this._addons.slice(0)}},{key:"getAddon",value:function(t){return this._addons.find(function(e){return e.name===t})}},{key:"addAddon",value:function(e,t){if(e){if(this.getAddon(e))throw new Error("'".concat(e,"' has already been taken"));var n=rn(e,t);this._addons.push(this._createAddon(n))}}},{key:"_createAddon",value:function(e){var t=new e(this.grid);return _(t,"created",this.grid),t}},{key:"_onDataGroupRender",value:function(e){var t=this;switch(e.type){case"render-updating":this._addons.forEach(function(e){e.updating(t.grid)});break;case"render-update":this._addons.forEach(function(e){e.update(t.grid)})}}}]),i}(),an={};function un(e){return e?an[e]:null}var hn=Object.freeze({__proto__:null,get:un,add:function(e,t){e&&"css"in t&&"canvasStyle"in t&&(an[e]=t)},remove:function(e){e in an&&delete an[e]}}),cn=["header-double-click","header-down","header-up","header-click","header-drag","header-out","header-over"],dn=["separator-over","separator-out","separator-down","separator-drag","separator-up","separator-click","separator-double-click"],fn=[].concat(cn,dn),vn=["item-over","item-out","item-down","item-up","item-drag","item-click","item-double-click"].concat(["collection-change","column-collection-change","column-node-change","normalized-columns-change","selection-changing","selection-change","item-edit-starting","item-edit-start","item-edit-ending","item-edit-end","item-edit-cancel","render-updating","render-update"]),gn={headerRenderer:-200,mergeItemRenderer:-100,itemRenderer:-100,columns:100,items:200};function mn(e,t){var n=gn[e]||0,i=gn[t]||0;return n<i?-1:i<n?1:0}var _n=function(e){f(u,ue);var a=g(u);function u(){var t;h(this,u),(t=a.call(this)).editable=!1,t.editOnKeys=ce.editOnKeys,t.editOnEvents=["doubleClick"],t.selectOnDrag=!0,t.multiSortable=!1,t.pasteFromClipboard=!0,t._resizableColumns=!0,t._draggableColumns=!0,t._sortableColumns=!0,t._labelFunction=null,t._rowCount=-1,t._maxRowCount=-1,t._dragScrollId=-1,t._dragScrollDelta=null,t._sortColumns=[],t._dragColumnInfo=null,t._dropColumnInfo=null,t._dragCanceled=!1,t._theme=null,t._oldWidth=0,t._oldHeight=0,t._gridEditor=new Ft(v(t)),t._itemEditor=ce.itemEditor||Te,t._boundDoLayout=t.doLayout.bind(v(t)),t._defaultStyles=m({},ce.styles);var n=t._dataGroup=t.createDataGroup(),i=t._headerGroup=t.createHeaderGroup(),e=t._scroller=new ke(n);t.appendChild(i),t.appendChild(e);var o=t._sizeDetector=new he(t.root);o.addEventListener("size-change",function(e){t._onResize(e)}),o.start(500),t._addonHelper=new ln(v(t));var r=t._onHeaderEvents.bind(v(t));cn.forEach(function(e){return i.addEventListener(e,r)});var s=t._onHeaderSeparatorEvents.bind(v(t));dn.forEach(function(e){return i.addEventListener(e,s)});var l=t._redispatch.bind(v(t));return fn.forEach(function(e){return i.addEventListener(e,l)}),vn.forEach(function(e){return n.addEventListener(e,l)}),e.addEventListener("scroll",l),t.addEventListener("keydown",t._onKeyDown.bind(v(t))),n.addEventListener("item-down",t._onItemDown.bind(v(t))),t}return c(u,[{key:"itemToLabel",value:function(e,t){return this.dataGroup.itemToLabel(e,t)}},{key:"getAddons",value:function(){return this._addonHelper.getAddons()}},{key:"getAddon",value:function(e){return this._addonHelper.getAddon(e)}},{key:"addAddon",value:function(e,t){this._addonHelper.addAddon(e,t)}},{key:"addColumn",value:function(e,t){return!!this.columnCollection&&this.columnCollection.addNode(e,t)}},{key:"addColumnAt",value:function(e,t,n){return!!this.columnCollection&&this.columnCollection.addNodeAt(e,t,n)}},{key:"addColumns",value:function(e,t){return!!this.columnCollection&&this.columnCollection.addNodes(e,t)}},{key:"addColumnsAt",value:function(e,t,n){return!!this.columnCollection&&this.columnCollection.addNodesAt(e,t,n)}},{key:"removeColumn",value:function(e,t){return!!this.columnCollection&&this.columnCollection.removeNode(e,t)}},{key:"removeColumns",value:function(e,t){return!!this.columnCollection&&this.columnCollection.removeNodes(e,t)}},{key:"moveColumn",value:function(e,t,n){return!!this.columnCollection&&this.columnCollection.moveNode(e,t,n)}},{key:"getColumnX",value:function(e){return this.dataGroup.getColumnX(e)}},{key:"getColumnWidth",value:function(e){return this.dataGroup.getColumnWidth(e)}},{key:"getColumnLayout",value:function(e){return this.dataGroup.getColumnLayout(e)}},{key:"setColumnWidth",value:function(e,t){this.dataGroup.setColumnWidth(e,t)}},{key:"getColumnsWidth",value:function(e,t){return this.dataGroup.getColumnsWidth(e,t)}},{key:"getRowHeight",value:function(e){return this.dataGroup.getRowHeight(e)}},{key:"setRowHeight",value:function(e,t){return this.dataGroup.setRowHeight(e,t)}},{key:"getRowsHeight",value:function(e,t){return this.dataGroup.getRowsHeight(e,t)}},{key:"getCellStyle",value:function(e,t){for(var n=arguments.length,i=new Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return this.dataGroup.getCellStyle.apply(this.dataGroup,[e,t].concat(i))}},{key:"setColumnVisible",value:function(e,t){return this.dataGroup.setColumnVisible(e,t)}},{key:"getHeaderHeight",value:function(){return this._headerGroup.headerHeight}},{key:"getMergeCells",value:function(){return this.dataGroup.getMergeCellPositions()}},{key:"addMergeCells",value:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){e instanceof S||(e=S.create(e)),t.dataGroup.addMergeCellPosition(e)}),this.invalidate()}},{key:"addMergeCell",value:function(e){e instanceof S||(e=S.create(e)),this.dataGroup.addMergeCellPosition(e),this.invalidate()}},{key:"removeMergeCell",value:function(e){e instanceof S||(e=S.create(e)),this.dataGroup.removeMergeCellPosition(e),this.invalidate()}},{key:"removeMergeCells",value:function(){this.dataGroup.removeMergeCellPositions(),this.invalidate()}},{key:"getSortColumns",value:function(){return this._sortColumns.slice(0)}},{key:"sortByColumns",value:function(e){var l=this;if(this.collection&&e){var n=[],i=[];this.sortableColumns&&e.forEach(function(e){var r,s,t;e.sortable&&(i.push(e),n.push({descending:e.sortDescending,sortFunction:(r=e,r.sortCompare instanceof Function?(s=r.sortCompare,function(e,t){return s(e,t,r)}):(t=r.sortCompare,s="number"===t?de:fe,function(e,t){var n=r.sortCompare,i=r.isSortOriginal?r.itemToValue(e):l.itemToLabel(e,r),o=r.isSortOriginal?r.itemToValue(t):l.itemToLabel(t,r);return"number"===n?(i=+i,o=+o):"string"===n&&(i=null==i?"":""+i,o=null==o?"":""+o),s(i,o)}))}))});var t=this._sortColumns||[];t.forEach(function(e){i.indexOf(e)<0&&(e.sortDescending=!1)}),this._sortColumns=i,(0<t.length||0<i.length)&&(this.collection.sort(n),this.collection.refresh())}}},{key:"isCellEditable",value:function(e,t){return this._gridEditor.isCellEditable(e,t)}},{key:"startEdit",value:function(e,t){return this._gridEditor.startEdit(e,t)}},{key:"endEdit",value:function(){return this._gridEditor.endEdit()}},{key:"cancelEdit",value:function(){return this._gridEditor.cancelEdit()}},{key:"isEditing",value:function(){return this._gridEditor.isEditing()}},{key:"getEditedCell",value:function(){return this._gridEditor.editedCell}},{key:"analysisMergeAll",value:function(){this.dataGroup.analysisMergeAll()}},{key:"createHeaderGroup",value:function(){return new qe(this)}},{key:"createDataGroup",value:function(){return new Tt(this)}},{key:"createCollection",value:function(e){return new Ce(e)}},{key:"focus",value:function(){this.htmlElement.focus()}},{key:"moveCaretUp",value:function(){return this._internalMoveCaret(this.caretRowIndex-1,this.caretColumnIndex)}},{key:"moveCaretDown",value:function(){return this._internalMoveCaret(this.caretRowIndex+1,this.caretColumnIndex)}},{key:"moveCaretLeft",value:function(){return this._internalMoveCaret(this.caretRowIndex,this.getPreviousVisibleColumnIndex(this.caretColumnIndex))}},{key:"moveCaretRight",value:function(){return this._internalMoveCaret(this.caretRowIndex,this.getNextVisibleColumnIndex(this.caretColumnIndex))}},{key:"scrollToCell",value:function(e,t,n){this.dataGroup.scrollToCell(e,t,n)}},{key:"doLayout",value:function(){var e=this._headerGroup,t=this._scroller;this.dataGroup;e.doLayout(!0);var n=e.root.offsetHeight,i=t.hasVerticalScroll,o=t.hasHorizontalScroll;t.root.style.height="calc(100% - ".concat(n,"px)");var r=t.root.offsetHeight;t.doLayout(!0),r===t.root.offsetHeight&&i===t.hasVerticalScroll&&o===t.hasHorizontalScroll||t.doLayout(),this._oldWidth=this.root.offsetWidth,this._oldHeight=this.root.offsetHeight}},{key:"lockDisplay",value:function(){this.dataGroup.lockDisplay(),this.headerGroup.lockDisplay()}},{key:"unlockDisplay",value:function(){this.dataGroup.unlockDisplay(),this.headerGroup.unlockDisplay()}},{key:"validateNow",value:function(){this.dataGroup.validateNow(),this.headerGroup.validateNow()}},{key:"invalidate",value:function(e){this.dataGroup.invalidate(e),this.headerGroup.invalidate(e)}},{key:"flush",value:function(){this.dataGroup.validateNow(),this.headerGroup.validateNow()}},{key:"applyTheme",value:function(){var e=un(this.theme);e&&(e.css&&le(this.root,e.css),this._defaultStyles=m({},ce.styles,e.canvasStyle||{}),this.invalidate())}},{key:"releaseTheme",value:function(){var e=un(this.theme);e&&(e.css&&ae(this.root,e.css),this._defaultStyles=m({},ce.styles),this._theme&&(this._theme=null),this.invalidate())}},{key:"getPreviousVisibleColumnIndex",value:function(e){for(var t=this.normalizedColumns,n=e-1;0<=n;n--){if(t[n].visible)return n}return-1}},{key:"getNextVisibleColumnIndex",value:function(e){for(var t=this.normalizedColumns,n=e+1,i=t.length;n<i;n++){if(t[n].visible)return n}return-1}},{key:"clearHeaderRenderers",value:function(){this.headerGroup.clearHeaderRenderers(),this.headerGroup.invalidate()}},{key:"clearItemRenderers",value:function(){this.dataGroup.clearItemRenderers(),this.dataGroup.invalidate()}},{key:"destroy",value:function(){this._sizeDetector.stop(),this.headerGroup.destroy(),this.dataGroup.destroy(),this.dataGroup.collection=null,this.dataGroup.columnCollection=null}},{key:"_getFirstVisibleRowIndex",value:function(){var e=this.dataGroup.getVisibleRowIndices();return e&&0<e.length?e[this.dataGroup.getVisibleFrozenIndexRect().top]:-1}},{key:"_styleChanged",value:function(){this.invalidate(K.ALL)}},{key:"_getLastVisibleRowIndex",value:function(){var e=this.dataGroup.getVisibleRowIndices();if(e&&0<e.length){var t=this.dataGroup.getVisibleFrozenIndexRect();return e[e.length-t.bottom-1]}return-1}},{key:"_internalMoveCaret",value:function(e,t,n){return 0<=e&&0<=t&&e<this.collection.length&&(this.caretRowIndex!==e||this.caretColumnIndex!==t)&&(n?this.dataGroup.updateSelection(e,t,!0):this.dataGroup.updateSelection(e,t,!1,!1),this.scrollToCell(e,t,!1,!1),!0)}},{key:"_adjustCellNavigation",value:function(e){var t=e.keyCode,n=e.shiftKey,i=(e.ctrlKey,this.dataGroup),o=i.isCellSelectionMode,r=i.getVisibleFrozenIndexRect(),s=this.caretRowIndex,l=this.caretColumnIndex,a=this.normalizedColumns.length,u=this.collection.length,h=i.findMergeCellPosition(s,l)||new S(s,l);switch(t){case 37:0<h.left&&(l=this.getPreviousVisibleColumnIndex(h.left));break;case 39:h.right+1<a&&(l=this.getNextVisibleColumnIndex(h.right));break;case 38:0<h.top&&(s=h.top-1);break;case 40:h.bottom+1<u&&(s=h.bottom+1);break;case 33:var c=this._getFirstVisibleRowIndex();s=s>u-r.bottom?u-r.bottom:c<s?c:(this.scrollTop-=this.scrollTop+i.clientHeight-(i.getRowY(s)+i.getRowHeight(s)),this._getFirstVisibleRowIndex());break;case 34:var d=this._getLastVisibleRowIndex();s=s<r.top&&s<u?r.top:s<d?d:(this.scrollTop=i.getRowY(s),this._getLastVisibleRowIndex());break;case 35:s=u-1,l=o?this.getPreviousVisibleColumnIndex(a):0;break;case 36:s=0,l=o?this.getNextVisibleColumnIndex(-1):0}this._internalMoveCaret(s,l,n)}},{key:"_calculateDragScrollDelta",value:function(e){var t=this.dataGroup,n=t.getVisibleFrozenSizeRect(),i=this.scrollLeft,o=this.scrollTop,r=new I;return e.x<i+n.left?r.x=-10:e.x>i+t.clientWidth-n.right&&(r.x=10),e.y<o+n.top?r.y=-10:e.y>o+t.clientHeight-n.bottom&&(r.y=10),r}},{key:"_startDragScrolling",value:function(e,i){var o=this;if(this._dragScrollDelta=e,this._dragScrollId<0){!function e(){var t=o.scrollLeft,n=o.scrollTop;o.scrollLeft+=o._dragScrollDelta.x,o.scrollTop+=o._dragScrollDelta.y,o.scrollLeft===t&&o.scrollTop===n||i(),o._dragScrollId=window.requestAnimationFrame(e)}()}}},{key:"_stopDragScrolling",value:function(){0<this._dragScrollId&&(window.cancelAnimationFrame(this._dragScrollId),this._dragScrollId=-1)}},{key:"_showOverlay",value:function(){if(!this._overlayGroup){var e=document.createElement("div");le(e,"tachyon-group-overlay"),this.appendChild(e),this._overlayGroup=e}}},{key:"_hideOverlay",value:function(){this._overlayGroup&&(this.removeChild(this._overlayGroup),this._overlayGroup=null)}},{key:"_showHeaderDropIndicator",value:function(e){if(this._overlayGroup){var t=this.dataGroup,n=this._dropHeaderIndicator;n?n.removeAttribute("hidden"):((n=this._dropHeaderIndicator=document.createElement("div")).style.position="absolute",n.style.zIndex="9999",le(n,"tachyon-header-drag"),oe(n,10,t.clientHeight),this._overlayGroup.appendChild(n));var i=null;if(e>=this.normalizedColumns.length)i=Math.round(Math.min(t.clientWidth,t.contentWidth)-5);else{var o=t.getColumnLayout(e);o&&(i=Math.round(o.dx-5))}null!=i?ie(n,i,this._headerGroup.clientHeight):this._hideHeaderDropIndicator()}}},{key:"_hideHeaderDropIndicator",value:function(e){var t=this._dropHeaderIndicator;t&&(e?(t.parentElement&&t.parentElement.removeChild(t),this._dropHeaderIndicator=null):t.setAttribute("hidden","hidden"))}},{key:"_startColumnDragDrop",value:function(e){var t=e.detail,n=t.column,i=this._headerGroup,o=i._createRenderer(n),r=o.htmlElement,s=new We("renderer"),l=i.getHeaderLayout(n);return this._overlayGroup.appendChild(s.root),s.setSize(l.width,l.height),s.updateLayout(0,0,l.width,l.height,l.width,l.height),s.begin(),r&&(s.addOverlayElement(r),le(r,"header-cell"),le(r,"header-cell-dragging"),oe(r,l.width,l.height)),o.prepare&&o.prepare(this,{renderer:o,item:n,column:n,label:n.headerText}),s.end(),{dragElement:s,renderer:o,column:n,columnPoint:new I(l.dx,l.dy),clientPoint:new I(t.trigger.clientX,t.trigger.clientY)}}},{key:"_updateColumnDragDrop",value:function(e){var t=e.detail,n=t.trigger,i=t.column,o=this.dataGroup,r=this._dragColumnInfo,s=r.columnPoint.x+n.clientX-r.clientPoint.x;ie(r.dragElement,s,r.columnPoint.y);var l=o._mouseEventToContent(n),a=Math.min(o.getColumnIndexByDistance(l.x),this.normalizedColumns.length-1),u=o.getColumnAt(a),h=o.getColumnWidth(a)/2<l.x-o.getColumnX(a),c=a;return h&&(c=a>=this.normalizedColumns.length-1?this.normalizedColumns.length:this.getNextVisibleColumnIndex(a)),function(e,t,n){if(e.level>=t.level)return e.parent===t.parent;for(var i=t,o=t.parent;o;){if(e.level-1===o.level&&e.parent===o)return!0;var r=o.children,s=r?r.length:0,l=0<s?r.indexOf(i):-1,a=void 0,u=void 0,h=void 0;for(a=0;a<s;a++)if((u=r[h=n?s-a-1:a]).visible){if(h!==l||e.level===u.level)return!1;break}o=(i=o).parent}return!0}(i,u,h)||(c=-1),0<=c?this._showHeaderDropIndicator(c):this._hideHeaderDropIndicator(),0<=c?{overLeafColumn:u,moveIndex:c,isNext:h}:null}},{key:"_cancelColumnDragDrop",value:function(){this._destroyColumnDragDrop(),this._dragCanceled=!0}},{key:"_destroyColumnDragDrop",value:function(){this._dragColumnInfo=null,this._dropColumnInfo=null,this._dragCanceled=!1,this._hideHeaderDropIndicator(!0),this._hideOverlay(),this._stopDragScrolling()}},{key:"_dispatchSortEvent",value:function(e,t,n){return this.dispatchEvent(new CustomEvent(e,{detail:{column:t,trigger:n}}))}},{key:"_redispatch",value:function(e){!this.dispatchEvent(new CustomEvent(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,detail:e.detail}))&&e.preventDefault()}},{key:"_onResize",value:function(e){this.root.offsetWidth===this._oldWidth&&this.root.offsetHeight===this._oldHeight||this.doLayout()}},{key:"_onHeaderEvents",value:function(e){var t=this,n=e.detail.column,i=e.detail.trigger;switch(e.type){case"header-drag":if(this.draggableColumns&&n.draggable&&!this._dragCanceled)if(this._showOverlay(),this._stopDragScrolling(),this._dragColumnInfo){var o=this.dataGroup._mouseEventToContent(i),r=this._calculateDragScrollDelta(o);r.y=0,this._dropColumnInfo=this._updateColumnDragDrop(e),this._startDragScrolling(r,function(){t._dropColumnInfo=t._updateColumnDragDrop(e)})}else this._dragColumnInfo=this._startColumnDragDrop(e),this._dropColumnInfo=this._updateColumnDragDrop(e);break;case"header-up":if(this.draggableColumns){if(this._dropColumnInfo){for(var s=this._dropColumnInfo.isNext,l=this._dragColumnInfo.column,a=l.parent,u=a?a.children:this.columns,h=null,c=this._dropColumnInfo.overLeafColumn;c;){if(a===c.parent){h=c;break}c=c.parent}if(h&&h!==l){var d=u.indexOf(l),f=Math.max(0,u.indexOf(h)+(s?1:0));d!==f&&(d<f&&(f-=1),this.moveColumn(l,a,f)&&(this.validateNow(),this.dispatchEvent(new CustomEvent("header-drop",{cancelable:!0,detail:{column:l,parent:a,toParent:a,toIndex:f,trigger:e}}))))}}this._destroyColumnDragDrop()}break;case"header-click":if(!this.isHeaderDragging&&this.sortableColumns&&n.sortable&&0<=this.normalizedColumns.indexOf(n)&&this._dispatchSortEvent("sort-changing",n)){var v,g=i.shiftKey||i.ctrlKey,m=0<=this._sortColumns.indexOf(n);g&&this.multiSortable?(v=this._sortColumns.slice(0),m||v.push(n)):v=[n];var _=n.sortDescending;m&&(n.sortDescending=!n.sortDescending),_&&v.splice(v.indexOf(n),1),this.sortByColumns(v),this._dispatchSortEvent("sort-change",n)}}}},{key:"_onHeaderSeparatorEvents",value:function(e){var t=this._headerGroup,n=e.detail.column,i=e.detail.trigger;if(this.resizableColumns&&n.resizable)switch(e.type){case"separator-over":t.style.cursor="col-resize";break;case"separator-out":t.style.cursor="";break;case"separator-down":this._showOverlay(),this._resizeColumn=n,this._resizeColumnWidth=this.dataGroup.getColumnWidth(n.index),this._resizeAnchorPoint=new I(i.clientX,i.clientY);break;case"separator-drag":this.setColumnWidth(n.index,Math.max(this._resizeColumnWidth+i.clientX-this._resizeAnchorPoint.x,n.minWidth));break;case"separator-up":this._hideOverlay(),this._resizeColumn=null,this._resizeColumnWidth=-1,this._resizeAnchorPoint=null}}},{key:"_onItemDown",value:function(e){var a=this;if(this.selectOnDrag&&this.dataGroup.isMultipleSelectionMode){var u,h=this.dataGroup,c=e.detail.rowIndex,d=e.detail.columnIndex,n=c,i=d,f=!1,v=function(e,t){n===e&&i===t||(h.updateSelection(e,t,!0),n=e,i=t)},t=function e(t){var n=t.detail,i=n.rowIndex,o=n.columnIndex,r=n.trigger;if(u=r,f){var s=h._mouseEventToContent(u),l=a._calculateDragScrollDelta(s);l&&0<l.length?a._startDragScrolling(l,function(){var e=h._mouseEventToContent(u),t=h.getRowIndexByDistance(e.y),n=h.getColumnIndexByDistance(e.x);v(t,n)}):a._stopDragScrolling()}else a.dispatchEvent(new CustomEvent("selection-drag-start",{cancelable:!0,detail:{cell:new S(c,d),trigger:t}})),f=!0;v(i,o),"item-up"===t.type&&(a._stopDragScrolling(),h.removeEventListener("item-drag",e),h.removeEventListener("item-up",e),a.dispatchEvent(new CustomEvent("selection-drag-end",{cancelable:!0,detail:{cell:new S(c,d,i,o),trigger:t}})))};h.addEventListener("item-drag",t),h.addEventListener("item-up",t)}}},{key:"_onKeyDown",value:function(e){var v=this;if(!e.defaultPrevented&&!this.isEditing())if(27===e.keyCode&&this.isHeaderDragging)this._cancelColumnDragDrop();else{if(e.ctrlKey&&this.selectedCell)switch(e.keyCode){case 67:var t=this.dataGroup.getSingleCell();return void(t&&(o=function(e,t){var n,i=e.dataGroup,o=e.collection;n=(n=i.isCellSelectionMode?i.normalizedColumns.slice(t.columnIndex,t.endColumnIndex+1):i.normalizedColumns).filter(function(e){return e.visible});for(var r=[],s=t.rowIndex,l=n.length;s<=t.endRowIndex;s++){for(var a=o.get(s),u=[],h=0;h<l;h++)u[h]=i.itemToLabel(a,n[h]);r.push(u)}var c=r.reduce(function(e,t){return e+=t.join("\t")+"\n"},"");return c.substr(0,c.length-"\n".length)}(this,t),r=document.activeElement,s=ve(),document.body.appendChild(s),s.value=o,s.select(),s.offsetWidth,new Promise(function(e){setTimeout(function(){document.body.removeChild(s),r.focus(),e(o)},100)})));case 86:return void(this.editable&&this.pasteFromClipboard&&!function(e){if(e instanceof Node){var t=e.nodeName.toLowerCase();return 1===e.nodeType&&("textarea"===t||"input"===t&&/^(?:text|email|number|search|tel|url|password)$/i.test(e.type))||e.isContentEditable}return!1}(e.target)&&(n=document.activeElement,i=ve(),document.body.appendChild(i),i.select(),i.offsetWidth,new Promise(function(t){setTimeout(function(){var e=i.value;document.body.removeChild(i),n.focus(),t(e)},100)})).then(function(e){for(var t=function(e){for(var t=e.split("\n"),n=t.length,i=[],o=0;o<n;o++)i[o]=t[o].split("\t");return 0<n&&1===i[n-1].length&&!i[n-1][0]&&i.pop(),i}(e),n=t.length,i=v.normalizedColumns,o=v.collection,r=v.caretRowIndex,s=v.caretColumnIndex,l=0;l<n;l++)for(var a=l+r,u=s,h=t[l],c=0,d=h.length;c<d&&0<=u;c++){var f=i[u];f.editable&&o.setValue(a,f.dataFieldPath,h[c]),u=v.getNextVisibleColumnIndex(u)}v.invalidate()}))}var n,i,o,r,s;this.collection&&0<this.collection.length&&this._adjustCellNavigation(e)}}},{key:"defaultStyles",get:function(){return this._defaultStyles}},{key:"headerGroup",get:function(){return this._headerGroup}},{key:"dataGroup",get:function(){return this._dataGroup}},{key:"selector",get:function(){return this.dataGroup.selector}},{key:"collection",get:function(){return this.dataGroup.collection}},{key:"columnCollection",get:function(){return this.dataGroup.columnCollection}},{key:"items",get:function(){return this.collection&&this.collection.source},set:function(e){!e||Array.isArray(e)?this.items!==e&&(this.dataGroup.collection=this.createCollection(e),this.doLayout()):console.warn("`items` must be an array.",e)}},{key:"columns",get:function(){return this.columnCollection&&this.columnCollection.source},set:function(e){this.columns!==e&&(this.dataGroup.columnCollection=new ct(e),this.doLayout())}},{key:"normalizedColumns",get:function(){return this.dataGroup.normalizedColumns}},{key:"labelFunction",get:function(){return this._labelFunction},set:function(e){this._labelFunction!==e&&(this._labelFunction=e,this.dataGroup.invalidate())}},{key:"headerRenderer",get:function(){return this._headerGroup.headerRenderer},set:function(e){this._headerGroup.headerRenderer=e}},{key:"itemRenderer",get:function(){return this.dataGroup.itemRenderer},set:function(e){this.dataGroup.itemRenderer=e}},{key:"mergeItemRenderer",get:function(){return this.dataGroup.mergeItemRenderer},set:function(e){this.dataGroup.mergeItemRenderer=e}},{key:"nullItemRenderer",get:function(){return this.dataGroup.nullItemRenderer},set:function(e){this.dataGroup.nullItemRenderer=e}},{key:"useNullItemRenderer",get:function(){return this.dataGroup.useNullItemRenderer},set:function(e){this.dataGroup.useNullItemRenderer=e}},{key:"itemEditor",get:function(){return this._itemEditor||ce.defaultItemEditor},set:function(e){this._itemEditor=e}},{key:"maxScrollLeft",get:function(){return this._scroller.maxScrollLeft}},{key:"maxScrollTop",get:function(){return this._scroller.maxScrollTop}},{key:"scrollLeft",get:function(){return this.dataGroup.scrollLeft||0},set:function(e){this.dataGroup.scrollLeft=e}},{key:"scrollTop",get:function(){return this.dataGroup.scrollTop||0},set:function(e){this.dataGroup.scrollTop=e}},{key:"autoMerge",get:function(){return this.dataGroup.autoMerge},set:function(e){this.dataGroup.autoMerge=e}},{key:"rowHeight",get:function(){return this.dataGroup.rowHeight},set:function(e){this.dataGroup.rowHeight=e}},{key:"headerRowHeight",get:function(){return this._headerGroup.headerRowHeight},set:function(e){this._headerGroup.headerRowHeight=e}},{key:"autoRowHeight",get:function(){return this.dataGroup.autoRowHeight},set:function(e){this.dataGroup.autoRowHeight=e}},{key:"maxRowCount",get:function(){return this.dataGroup.maxRowCount},set:function(e){this.dataGroup.maxRowCount=+e}},{key:"rowCount",get:function(){return this.dataGroup.rowCount},set:function(e){this.rowCount!==e&&(this.dataGroup.rowCount=+e,this.doLayout())}},{key:"frozenLeft",get:function(){return this.dataGroup.frozenLeft},set:function(e){this.dataGroup.frozenLeft=e}},{key:"frozenRight",get:function(){return this.dataGroup.frozenRight},set:function(e){this.dataGroup.frozenRight=e}},{key:"frozenTop",get:function(){return this.dataGroup.frozenTop},set:function(e){this.dataGroup.frozenTop=e}},{key:"frozenBottom",get:function(){return this.dataGroup.frozenBottom},set:function(e){this.dataGroup.frozenBottom=e}},{key:"mergeCompare",get:function(){return this.dataGroup.mergeCompare},set:function(e){this.dataGroup.mergeCompare=e}},{key:"sortableColumns",get:function(){return this._sortableColumns},set:function(e){this._sortableColumns!==e&&((this._sortableColumns=e)||this.sortByColumns(null))}},{key:"resizableColumns",get:function(){return this._resizableColumns},set:function(e){this._resizableColumns!==e&&(this._resizableColumns=e)}},{key:"draggableColumns",get:function(){return this._draggableColumns},set:function(e){this._draggableColumns!==e&&(this._draggableColumns=e)}},{key:"isHeaderDragging",get:function(){return null!=this._dragColumnInfo}},{key:"hasVerticalScroll",get:function(){return this._scroller.hasVerticalScroll}},{key:"hasHorizontalScroll",get:function(){return this._scroller.hasHorizontalScroll}},{key:"hookFreeElement",get:function(){return this._hookFreeElement},set:function(e){this._hookFreeElement!==e&&(this._hookFreeElement=this.dataGroup.hookFreeElement=this.headerGroup.hookFreeElement=e)}},{key:"selectionMode",get:function(){return this.dataGroup.selectionMode||""},set:function(e){this.selectionMode!==e&&(this.dataGroup.clearSelection(),this.dataGroup.selectionMode=e,this.invalidate())}},{key:"selectedIndex",get:function(){return this.dataGroup.selectedIndex},set:function(e){this.dataGroup.selectedIndex=e}},{key:"selectedItem",get:function(){return this.dataGroup.selectedItem},set:function(e){this.dataGroup.selectedItem=e}},{key:"selectedIndices",get:function(){return this.dataGroup.selectedIndices},set:function(e){this.dataGroup.selectedIndices=e}},{key:"selectedItems",get:function(){return this.dataGroup.selectedItems},set:function(e){this.dataGroup.selectedItems=e}},{key:"selectedCell",get:function(){return this.dataGroup.selectedCell},set:function(e){this.dataGroup.selectedCell=e}},{key:"selectedCells",get:function(){return this.dataGroup.selectedCells},set:function(e){this.dataGroup.selectedCells=e}},{key:"caretRowIndex",get:function(){return this.dataGroup.caretRowIndex},set:function(e){this.dataGroup.caretRowIndex=e}},{key:"caretColumnIndex",get:function(){return this.dataGroup.caretColumnIndex},set:function(e){this.dataGroup.caretColumnIndex=e}},{key:"theme",get:function(){return this._theme},set:function(e){this._theme!==e&&(this.releaseTheme(),(this._theme=e)&&this.applyTheme())}}],[{key:"create",value:function(e,n){var i=new this,t=null;if(e instanceof HTMLElement?t=e:"string"==typeof e&&(t=document.querySelector(e)),t)return t.appendChild(i.root),Object.keys(n).sort(mn).forEach(function(e){var t=n[e];"options"===e?m(i.dataGroup.options,t):"addons"===e?t.keys.forEach(function(e){i.addAddon(e,t[e])}):e in i&&("columns"===e&&Array.isArray(t)&&(t=t.map(function(e){return e instanceof Q?e:Q.create(e)})),i[e]=t)}),i;throw Error("Invalid container. "+e)}}]),u}().withDom('<div class="tachyon-grid" tabindex="-1"></div>').withBehavior(j,tn),yn=["node-change"],pn=function(e){f(r,Tt);var n=g(r);function r(e){var t;return h(this,r),(t=n.call(this,e))._boundTreeNodeListener=t._onTreeNodeChange.bind(v(t)),t._crossDimension=[],t._maxNodeLevel=[],t._treeColumns=[],t._autoExpandLevel=0,t}return c(r,[{key:"_itemToTemplate",value:function(e,t,n){if(n.isCrossed)return De;var i=C(p(r.prototype),"_itemToTemplate",this).call(this,e,t,n);return t instanceof ee&&!t.boxMode&&i===Pe?He:i}},{key:"_resetCrossCells",value:function(){var t=this;if(this.collection&&this.columnCollection){var e=this._treeColumns=this.columnCollection.find(function(e){return e instanceof ee&&e.boxMode});(this._maxNodeLevel=0)<e.length&&(this._maxNodeLevel=this.collection.getNodeDepth(null)-1),this._crossDimension=[],e.forEach(function(e){t._createChildColumns(e,t._maxNodeLevel)})}}},{key:"_createCrossCellPosition",value:function(e,t,n,i,o){var r=i+this.collection.getNodeLevel(n),s=i+e,l=this.collection.getDisplayableChildren(n),a=new Ze(o,r,o,s);return 0<l.length&&(a.crossCellPositions=[new S(o,r,o+l.length,r,!0)]),a}},{key:"_createChildColumns",value:function(e,t){var n=this.grid.columnCollection,i=n.getChildren(e);e.width;if(e.boxMode){var o=i.slice(t+1);0<o.length&&n.removeNodes(e,o);for(var r=e.indent,s=[],l=0;l<=t;l++){var a=i[l];a||((a=new $(e)).minWidth=r,s.push(a));var u=r;l===t&&(u=Math.max(e.width-r*t,r)||r),a.width=u}0<s.length&&n.addNodes(e,s)}else n.removeNodes(e,i)}},{key:"_addCrossCells",value:function(n,e){var l=this;if(this._treeColumns.length){var t=e.length,a=this.normalizedColumns,u={};0<this._crossDimension.length&&Array.prototype.splice.apply(this._crossDimension,[n,0].concat(new Array(t)));var i=function(e){e.crossCellPositions.forEach(function(e){n>=e.rowIndex&&n<e.endRowIndex?e.height+=t:n<e.rowIndex&&(e.y+=t)})};this._crossDimension.forEach(function(e){return e&&e.forEach(i)});var o=function(e){var t=l.collection.get(e);for(var n in l._treeColumns){var i=l._treeColumns[n],o=u[n];void 0===o&&(o=u[n]=a.indexOf(i.children[0]));var r=l._createCrossCellPosition(l._maxNodeLevel,i,t,o,e);l.addMergeCellPosition(r);var s=l._crossDimension[e];s||(s=l._crossDimension[e]=[]),s[o]=r}};this.collection.getAncestorNodes(e[0]).forEach(function(e){return o(l.collection.indexOf(e))}),e.forEach(function(e,t){return o(n+t)})}}},{key:"_removeCrossCells",value:function(t,e){var n=e.length;this._crossDimension.splice(t,n);var i=function(e){e.crossCellPositions=e.crossCellPositions.filter(function(e){return t>=e.rowIndex&&t<=e.endRowIndex?(e.height-=Math.min(n,e.endRowIndex-t+1),0<e.height):(t<e.rowIndex&&(e.y-=n),!0)})};this._crossDimension.forEach(function(e){return e.forEach(i)})}},{key:"_onColumnCollectionChange",value:function(e){var t=e.detail.kind,n="reset"===t||"refresh"===t;this.collection&&n?(this._resetCrossCells(),C(p(r.prototype),"_onColumnCollectionChange",this).call(this,e),this._addCrossCells(0,this.collection.toArray())):C(p(r.prototype),"_onColumnCollectionChange",this).call(this,e)}},{key:"_onCollectionChange",value:function(e){var t=this;if(!this._isBlockCollectionChange){var n=this.collection,i=e.detail,o=i.kind;switch("reset"===o&&0<this.autoExpandLevel&&(this._isBlockCollectionChange=!0,n.openNodes(n.find(function(e){return n.getNodeLevel(e)<t.autoExpandLevel})),this._isBlockCollectionChange=!1),C(p(r.prototype),"_onCollectionChange",this).call(this,e,!1),o){case"reset":case"refresh":this._resetCrossCells(),this._addCrossCells(0,this.collection.toArray());break;case"add":this._addCrossCells(i.index,i.items);break;case"remove":this._removeCrossCells(i.index,i.items)}this.dispatchEvent(new CustomEvent(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,detail:e.detail}))}}},{key:"_onTreeNodeChange",value:function(e){var t=e.type,n=e.cancelable,i=e.detail,o=new CustomEvent(t,{cancelable:n,detail:i});switch(this.dispatchEvent(o),o.defaultPrevented&&e.preventDefault(),i.kind){case"expand":case"collapse":case"add":case"remove":case"move":this.invalidate()}}},{key:"autoExpandLevel",get:function(){return this._autoExpandLevel},set:function(e){this._autoExpandLevel=e}},{key:"collection",get:function(){return C(p(r.prototype),"collection",this)},set:function(e){var t=this;this.collection&&yn.forEach(function(e){return t.collection.removeEventListener(e,t._boundTreeNodeListener)}),function(e,t,n,i,o){if(!u(e,t,n,i||e)&&o)throw new Error("failed to set property")}(p(r.prototype),"collection",e,this,!0),this.collection&&yn.forEach(function(e){return t.collection.addEventListener(e,t._boundTreeNodeListener)})}}]),r}(),Cn=function(e){f(o,_n);var i=g(o);function o(){var t;h(this,o),t=i.call(this);var n=function(e){return t._redispatch(e)};return yn.forEach(function(e){return t.dataGroup.addEventListener(e,n)}),t}return c(o,[{key:"createDataGroup",value:function(){return new pn(this)}},{key:"createCollection",value:function(e){return new ht(e)}},{key:"getParentNode",value:function(e){return this.collection&&this.collection.getParentNode(e)}},{key:"getChildren",value:function(e){return this.collection&&this.collection.getChildren(e)}},{key:"getDisplayableChildren",value:function(e){return this.collection&&this.collection.getDisplayableChildren(e)}},{key:"hasChildren",value:function(e){return this.collection&&this.collection.hasChildren(e)}},{key:"addNode",value:function(e,t){return this.collection&&this.collection.addNode(e,t)}},{key:"addNodeAt",value:function(e,t,n){return this.collection&&this.collection.addNodeAt(e,t,n)}},{key:"addNodes",value:function(e,t){return this.collection&&this.collection.addNodes(e,t)}},{key:"addNodesAt",value:function(e,t,n){return this.collection&&this.collection.addNodesAt(e,t,n)}},{key:"removeNode",value:function(e,t){return this.collection&&this.collection.removeNode(e,t)}},{key:"contains",value:function(e){return this.collection&&this.collection.contains(e)}},{key:"isOpenNode",value:function(e){return this.collection&&this.collection.isOpenNode(e)}},{key:"isDisplayableNode",value:function(e){return this.collection&&this.collection.isDisplayableNode(e)}},{key:"openNode",value:function(e){return this.collection&&this.collection.openNode(e)}},{key:"closeNode",value:function(e){return this.collection&&this.collection.closeNode(e)}},{key:"openNodes",value:function(e){return this.collection&&this.collection.openNodes(e)}},{key:"getOpenedNodes",value:function(){return this.collection&&this.collection.getOpenedNodes()}},{key:"getNodeLevel",value:function(e){return this.collection&&this.collection.getNodeLevel(e)}},{key:"find",value:function(e,t,n){return this.collection&&this.collection.find(e,t,n)}},{key:"findOne",value:function(e,t,n){return this.collection&&this.collection.findOne(e,t,n)}},{key:"expandAll",value:function(){this.collection&&this.collection.expandAll()}},{key:"collapseAll",value:function(){this.collection&&this.collection.collapseAll()}},{key:"toggleNode",value:function(e){this.isOpenNode(e)?this.closeNode(e):this.openNode(e)}},{key:"_onCollectionChange",value:function(e){var t=this;if("reset"===e.detail.kind&&0<this.autoExpandLevel){var n=function(e){"refresh"===e.detail.kind&&e.stopPropagation()};this.addEventListener("collection-change",n,!0),this.openNodes(this.find(function(e){return t.getNodeLevel(e)<t.autoExpandLevel})),this.removeEventListener("collection-change",n,!0)}}},{key:"autoExpandLevel",get:function(){return this.dataGroup.autoExpandLevel},set:function(e){this.dataGroup.autoExpandLevel=e}}]),o}();function kn(e){e&&m(ce,e)}return Object.freeze(m(kn,{component:{GridColumn:Q,TreeGridColumn:ee,CellPosition:S,DataGrid:_n,TreeGrid:Cn,Renderer:{defaultCanvasItemRenderer:Pe,defaultDomItemRenderer:Oe,defaultHeaderRenderer:Ge,defaultItemEditor:Te,defaultTreeItemRenderer:He}},createCellPosition:S.create.bind(S),createColumn:Q.create.bind(Q),createTreeColumn:ee.create.bind(ee),createColumns:function(e){return e.map(function(e){return e instanceof Q?e:Q.create(e)})},createGrid:_n.create.bind(_n),createTreeGrid:Cn.create.bind(Cn),isDataGrid:function(e){return e instanceof _n},isTreeGrid:function(e){return e instanceof Cn},helper:Se,theme:hn,formatter:J,addon:sn,version:"1.0.0"})),kn});
